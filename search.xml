<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[ä»ŽVue3.0æµ…è°ˆå‰ç«¯æ¡†æž¶çš„å‘å±•è¶‹åŠ¿]]></title>
    <url>%2F2019%2F09%2F01%2Fvue-3.0%2F</url>
    <content type="text"><![CDATA[3.0è®¾è®¡ç›®æ ‡ æ›´å° æ›´å¿« åŠ å¼ºTypeScriptæ”¯æŒ åŠ å¼ºAPIè®¾è®¡ä¸€è‡´æ€§ æé«˜è‡ªèº«å¯ç»´æŠ¤æ€§ å¼€æ”¾æ›´å¤šåº•å±‚åŠŸèƒ½ å¦‚ä½•æ›´å¿«ï¼ŸObject.defineProperty -&gt; ProxyObject.definePropertyåœ¨æ”¹å˜å¯¹è±¡å±žæ€§è¿™ä¸€æ“ä½œä¸Šæ˜¯ç›¸å¯¹æ˜‚è´µçš„ï¼Œå› ä¸ºjså¼•æ“Žåœ¨ç¼–è¯‘é˜¶æ®µæ˜¯éœ€è¦å¯¹ä»£ç åšä¼˜åŒ–çš„ï¼Œè¿™ä¸ªå¯¹è±¡è¶Šç¨³å®šï¼Œå¯ä¼˜åŒ–ç©ºé—´å°±è¶Šå¤§ã€‚Object.definePropertyæ—¢ç„¶å¯ä»¥éšæ„åœ°ä¿®æ”¹å¯¹è±¡å±žæ€§ï¼Œé‚£ä¹ˆä»£ç çš„å¯ä¼˜åŒ–æ€§å°†å¤§å¤§é™ä½Žã€‚è€ŒProxyå¹¶ä¸æ˜¯ç®€å•åœ°ä¿®æ”¹åŽŸæ¥çš„å¯¹è±¡ï¼Œä»…ä»…æ˜¯åœ¨å…¶ä¹‹ä¸Šåšäº†ä¸€å±‚ä»£ç†ï¼šæ‰€æœ‰å¯¹è¯¥å¯¹è±¡çš„è®¿é—®å’Œæ“ä½œéƒ½éœ€è¦é€šè¿‡è¿™å±‚proxyã€‚å› æ­¤ï¼ŒProxyæ¯”Object.definePropertyæ€§èƒ½æ›´ä¼˜ã€‚ å½“ç„¶ï¼ŒIE11ä»ç„¶ä¸æ”¯æŒProxyï¼ŒVueçš„åšæ³•æ˜¯åœ¨ä¸æ”¯æŒProxyçš„æµè§ˆå™¨ä¸­é™çº§ä½¿ç”¨Object.definePropertyï¼Œå› æ­¤Vue3.0ä»ç„¶æ”¯æŒIEï¼Œåªæ˜¯å¦‚æžœè¦å…¼å®¹IEçš„è¯å°±æ— æ³•äº«å—æ–°è¯­æ³•å¸¦æ¥çš„å¥½å¤„äº†ã€‚ Virtual Dom é‡æž„3.0çš„vdomä½¿ç”¨äº†TypeScriptè¿›è¡Œé‡æž„ï¼Œç»„ä»¶å¯åŠ¨é€Ÿåº¦æ¯”2.xæé«˜äº†æŽ¥è¿‘ä¸€å€ ç¼–è¯‘æ—¶ä¼˜åŒ–Sloté»˜è®¤ç¼–è¯‘ä¸ºå‡½æ•°ä½¿å¾—çˆ¶å­ç»„ä»¶ä¹‹é—´æ›´æ–°æ—¶ä¸å­˜åœ¨å¼ºè€¦åˆçš„å…³ç³» Monomorphic vnode factoryé‡æž„ç”Ÿæˆvnodeçš„å·¥åŽ‚å‡½æ•°ï¼Œä½¿å…¶å‡½æ•°å‚æ•°æ›´åŠ ä¸€è‡´åŒ– Compiler-generated flags for vnode/children typesç¼–è¯‘æ—¶å¢žåŠ vnodeåŠå…¶childrençš„ç±»åž‹ä¿¡æ¯ ä»¥ä¸Šçš„ç¼–è¯‘æ—¶ä¼˜åŒ–ï¼Œå¯ä»¥è®©3.0çš„runtimeå˜å¾—æ›´å¿« ä¼ ç»Ÿvdomçš„æ€§èƒ½ç“¶é¢ˆä»¥å‰æˆ‘ç¡®å®žæ˜¯å¯¹vdomå­˜åœ¨ä¸€äº›è¯¯è§£ï¼Œè®¤ä¸ºå®ƒèƒ½å¤Ÿæé«˜åº”ç”¨çš„è¿è¡Œæ•ˆçŽ‡ã€‚ç„¶è€Œå®žé™…ä¸Šå´éžå¦‚æ­¤ï¼Œå®ƒæ˜¯ä¸ºäº†å°†å¼€å‘è€…ä»Žæ‰‹åŠ¨æ“ä½œdomä¸­è§£æ”¾å‡ºæ¥ï¼ˆå¹¶ä¸”å®ƒæ˜¯å¹³å°æ— å…³çš„ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„åº”ç”¨è·‘åœ¨éžæµè§ˆå™¨ç«¯ï¼Œæ¯”å¦‚ï¼šrn/weex/mpvue/nodejsç­‰ï¼‰ã€‚ vdomèµ‹äºˆäº†æ›´å¼ºçš„è¡¨è¾¾åŠ›ï¼Œä½†æ˜¯æ¢æ¥çš„ä»£ä»·æ˜¯æ€§èƒ½é—®é¢˜ï¼Œæ²¡é”™ï¼Œvdomåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹è®©å¼€å‘è€…åœ¨æ— éœ€æ“ä½œdomçš„åŒæ—¶ç»™äºˆäº†åº”ç”¨è¿˜ä¸é”™çš„æ€§èƒ½ï¼Œä½†åœ¨ä¸€äº›å¯¹æ€§èƒ½è¦æ±‚æžé«˜çš„åœºæ™¯ï¼Œå®ƒä¼šæ‹–æ…¢æˆ‘ä»¬çš„åº”ç”¨ï¼Œæ¯”å¦‚atomç¼–è¾‘å™¨ï¼Œç”±äºŽä½¿ç”¨äº†reacté‡æž„åŽé¢‘é¢‘å‡ºçŽ°æ€§èƒ½é—®é¢˜ï¼Œå¦‚ä»Šå·²è¢«å½»åº•æ”¾å¼ƒã€‚å†æ¯”å¦‚vscodeï¼Œå®ƒå’Œatomä¸€æ ·ä¹Ÿæ˜¯åŸºäºŽelectronçš„ï¼Œä½†ä¸ºäº†æ€§èƒ½åªèƒ½å®Œå…¨æ‰‹åŠ¨åŽ»æ“ä½œdomï¼Œè¿™æ ·åœ¨ç‰¹æ®Šåœºæ™¯å¯ä»¥åšåˆ°é’ˆå¯¹æ€§åœ°æžè‡´ä¼˜åŒ–ï¼Œè¿™æ˜¯è™šæ‹Ÿdomåšä¸åˆ°çš„ã€‚ ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Œç©¶å…¶åŽŸå› ï¼Œå°±ä¸å¾—ä¸æåˆ°diffäº†ï¼ˆå…³äºŽdiffæœ‰ç¯‡æ–‡ç« è®²çš„å¾ˆæ¸…æ¥šï¼šä¸å¯æ€è®®çš„ react diffï¼‰ã€‚åœ¨vueæˆ–reacté‡Œé¢ï¼Œå°½ç®¡èƒ½å¤Ÿä¿è¯ç»„ä»¶ç²’åº¦çš„æ›´æ–°ï¼Œä½†æ˜¯åœ¨å•ä¸ªç»„ä»¶å†…éƒ¨å´ä¾ç„¶è¦åŽ»éåŽ†ç»„ä»¶çš„æ•´ä¸ªvdomæ ‘ã€‚è¿™æ ·çœ‹æ¥ï¼Œç»„ä»¶ç²’åº¦çš„æ›´æ–°ä»ç„¶æ˜¾å¾—æœ‰äº›ç²—ç³™ï¼Œä¸¾ä¸ªä¾‹å­ï¼ˆvueï¼‰:123456789&lt;template&gt; &lt;div id="content"&gt; &lt;p class="text"&gt;aha&lt;/p&gt; &lt;p class="text"&gt;aha&lt;/p&gt; &lt;p class="text"&gt;aha&lt;/p&gt; &lt;p class="text"&gt;&#123;&#123; msg &#125;&#125;&lt;/p&gt; &lt;p class="text"&gt;aha&lt;/p&gt; &lt;/div&gt;&lt;/template&gt; åœ¨è¿™ä¸ªæ¨¡ç‰ˆé‡Œï¼Œåªæœ‰ä¸€å¤„æ˜¯åŠ¨æ€å¯æ”¹å˜çš„ï¼Œå°½ç®¡diffåªæ¯”è¾ƒåŒçº§çš„èŠ‚ç‚¹ï¼Œä½†å¦‚æžœè¿˜æ˜¯åŽ»éåŽ†æ•´ä¸ªæ¨¡ç‰ˆå¯¹åº”çš„vdomæ ‘ï¼Œé‚£å°±æ˜¯æµªè´¹çš„ã€‚ ä¸ºä»€ä¹ˆvdomè¦ç”¨è¿™ç§ä¸é«˜æ•ˆçš„ç®—æ³•ï¼Ÿé‚£æ˜¯å› ä¸ºvdomæœ€åˆå¹¶ä¸æ˜¯ä»Žæ¨¡ç‰ˆç¼–è¯‘è€Œæ¥ï¼Œè€Œæ˜¯jsxã€‚è€Œæˆ‘ä»¬éƒ½çŸ¥é“jsxæˆ–è€…render functionæ˜¯å®Œå…¨åŠ¨æ€çš„ï¼Œè¿™å°±å¯¼è‡´åœ¨ç¼–è¯‘æ—¶å¯ä»¥ç”¨äºŽä¼˜åŒ–çš„ä¿¡æ¯å¾ˆå°‘ï¼Œæ¯”å¦‚ä¸Šé¢æ¨¡ç‰ˆå¯¹åº”çš„render function:1234567891011function render() &#123; const children = [] for (let i = 0; i &lt; 5; i++) &#123; children.push('p', &#123; class: 'text' &#125;, i === 3 ? this.msg : 'aha') &#125; return h('div', &#123; id: 'content' &#125;, children)&#125; ä½ å¾ˆéš¾åƒæ¨¡ç‰ˆä¸€æ ·ï¼Œåœ¨ç¼–è¯‘æ—¶åŽ»æå–é™æ€ä¿¡æ¯ã€‚ reactçš„è§£å†³æ–¹æ¡ˆæ˜¯time slicingæ—¶é—´åˆ†ç‰‡: React åœ¨æ¸²æŸ“ï¼ˆrenderï¼‰çš„æ—¶å€™ï¼Œä¸ä¼šé˜»å¡žçŽ°åœ¨çš„çº¿ç¨‹ å¦‚æžœä½ çš„è®¾å¤‡è¶³å¤Ÿå¿«ï¼Œä½ ä¼šæ„Ÿè§‰æ¸²æŸ“æ˜¯åŒæ­¥çš„ å¦‚æžœä½ è®¾å¤‡éžå¸¸æ…¢ï¼Œä½ ä¼šæ„Ÿè§‰è¿˜ç®—æ˜¯çµæ•çš„ è™½ç„¶æ˜¯å¼‚æ­¥æ¸²æŸ“ï¼Œä½†æ˜¯ä½ å°†ä¼šçœ‹åˆ°å®Œæ•´çš„æ¸²æŸ“ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç»„ä»¶ä¸€è¡Œè¡Œçš„æ¸²æŸ“å‡ºæ¥ ç®€å•æ¥è¯´å°±æ˜¯æˆ‘çš„åº”ç”¨åœ¨æ›´æ–°æ—¶å¯èƒ½ä¼šè¶…è¿‡16msï¼Œä½†æ˜¯æˆ‘æ¯éš”å¤§çº¦16mséƒ½ä¼šåŽ»æŠŠæŽ§åˆ¶æƒäº¤ç»™CPUè€Œä¸ä¼šå±è”½ç”¨æˆ·çš„æ“ä½œã€‚å¯¹reactè€Œè¨€ï¼Œè¿™ç®—æ˜¯ä¸é”™è§£å†³æ–¹æ¡ˆã€‚ä½†æ˜¯å¯¹äºŽvueæˆ–è€…svelteè€Œè¨€ï¼Œæ˜¯æœ‰èƒ½åŠ›æŠŠruntimeåšçš„è¶³å¤Ÿè½»é‡çš„ï¼Œåªè¦æ›´æ–°åšçš„è¶³å¤Ÿå¿«ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦æ—¶é—´åˆ†ç‰‡äº†ã€‚ svelteè¿‘æ¥å‡ºçŽ°çš„ä¸€ä¸ªæ–°çš„æ¡†æž¶svelteï¼Œå•å°±å†™æ³•è€Œè¨€å¾ˆåƒvueçš„templateï¼Œä½†æ˜¯æˆ‘è®¤ä¸ºå®ƒçš„å‡ºçŽ°å¹¶ä¸æ˜¯ä¸ºäº†è·Ÿä¸‰å¤§æ¡†æž¶æŠ¢å¸‚åœºï¼Œè€Œæ˜¯æƒ³åœ¨æ›´åŠ ç»†åˆ†çš„é¢†åŸŸæ€å‡ºä¸€æ¡å‡ºè·¯ï¼Œé‚£å°±æ˜¯å°†complieråšåˆ°æžè‡´ï¼šä½ åªèƒ½ä½¿ç”¨æ¨¡ç‰ˆã€‚åœ¨ svelteé‡Œé¢ï¼Œæ²¡æœ‰vdomï¼Œæ²¡æœ‰jsxç­‰ã€‚å®ƒå°†æ¨¡ç‰ˆç›´æŽ¥ç¼–è¯‘æˆæœ€ç»ˆä»£ç ï¼Œåœ¨æ›´æ–°æ—¶æ•ˆçŽ‡æžé«˜ã€‚å½“ç„¶è¿™æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼Œåªèƒ½ä½¿ç”¨æ¨¡ç‰ˆåœ¨æŸäº›åœºæ™¯æ˜¾å¾—ä¸å¤Ÿçµæ´»ã€‚è€Œä¸”å¯¹äºŽç›¸åŒçš„åŠŸèƒ½ï¼Œç¼–è¯‘å‡ºæ¥çš„ä»£ç é‡å¤§æ¦‚æ˜¯vueçš„5å€å·¦å³ã€‚ Function-based API3.0é‡‡ç”¨äº†ä¸€å¥—åŸºäºŽå‡½æ•°å¼çš„apiï¼Œæ¥çœ‹ä¸€ä¸ªç®€å•çš„demoï¼š123456789101112131415161718192021222324252627282930313233343536&lt;template&gt; &lt;div&gt; &lt;span&gt;count is &#123;&#123; count &#125;&#125;&lt;/span&gt; &lt;span&gt;plusOne is &#123;&#123; plusOne &#125;&#125;&lt;/span&gt; &lt;button @click="increment"&gt;count++&lt;/button&gt; &lt;/div&gt;&lt;/template&gt;&lt;script&gt;import &#123; value, computed, watch, onMounted &#125; from 'vue'export default &#123; setup() &#123; // reactive state const count = value(0) // computed state const plusOne = computed(() =&gt; count.value + 1) // method const increment = () =&gt; &#123; count.value++ &#125; // watch watch(() =&gt; count.value * 2, val =&gt; &#123; console.log(`count * 2 is $&#123;val&#125;`) &#125;) // lifecycle onMounted(() =&gt; &#123; console.log(`mounted`) &#125;) // expose bindings on render context return &#123; count, plusOne, increment &#125; &#125;&#125;&lt;/script&gt; å…³äºŽä¸ºä»€ä¹ˆé‡‡ç”¨å‡½æ•°å¼çš„apiï¼Œä¸»è¦æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼š æ›´å¥½çš„Typescriptç±»åž‹æŽ¨å¯¼æ”¯æŒTypescriptå¯¹å‡½æ•°çš„å‚æ•°å’Œè¿”å›žå€¼çš„æ”¯æŒæ˜¯éžå¸¸å®Œå–„çš„ï¼Œä½ ç”šè‡³ä¸ç”¨åŽ»å†™ç±»åž‹å£°æ˜Žå°±å¯ä»¥èŽ·å¾—å®Œå–„çš„ç±»åž‹æŽ¨å¯¼ã€‚ æ›´å¼ºçš„Tree-shakingèƒ½åŠ›çœ‹å‰é¢çš„demoå¯ä»¥å‘çŽ°ï¼Œ3.0çš„apiéƒ½æ˜¯ä»Žvueé‡Œimportè€Œæ¥ï¼Œè€Œtree-shakingçš„å‰æå°±æ˜¯es moduleï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æžœä½ ä¸åŽ»ç”¨è¿™äº›apiï¼Œå®ƒä»¬éƒ½ä¸ä¼šè¢«æ‰“è¿›ä½ çš„bundleé‡Œé¢ï¼Œå‡å°äº†bundleçš„ä½“ç§¯ã€‚ æ›´å®¹æ˜“è¢«åŽ‹ç¼©çš„ä»£ç å¦‚æžœä½ çœ‹è¿‡webpackæˆ–è€…rollupç­‰æ‰“åŒ…å·¥å…·åŽ‹ç¼©åŽçš„ä»£ç ï¼Œä½ ä¼šå‘çŽ°å‡½æ•°é‡Œçš„å˜é‡ä¼šè¢«æ›¿æ¢ä¸ºå•ä¸ªå­—ç¬¦ï¼ˆç±»ä¼¼a,b,c,_ç­‰ï¼‰ï¼Œè€Œå¯¹äºŽå¯¹è±¡è€Œè¨€ï¼Œå®ƒçš„keyä¸€èˆ¬æ˜¯ä¸èƒ½è¢«åŽ‹ç¼©æˆ–è€…è¯´åŽ‹ç¼©åŽä¸å®‰å…¨ã€‚ æ›´çµæ´»çš„é€»è¾‘å¤ç”¨èƒ½åŠ›3.0å®žçŽ°é€»è¾‘å¤ç”¨çš„æ–¹å¼æ˜¯hooksï¼Œåœ¨è¯´hooksä¹‹å‰å…ˆè¯´è¯´åŽŸæœ‰çš„é€»è¾‘å¤ç”¨æ–¹å¼çš„ç¼ºé™· Mixinçš„ç¼ºç‚¹åœ¨3.0ä¹‹å‰ï¼Œvueçš„é€»è¾‘å¤ç”¨ä¸»è¦å°±æ˜¯mixinsï¼Œä»¥ä¾¦å¬é¼ æ ‡ä½ç½®ä¸ºä¾‹ï¼š1234567891011121314151617181920const mousePosMixin = &#123; data() &#123; return &#123; x: 0, y: 0 &#125; &#125;, mounted() &#123; window.addEventListener('mousemove', this.update) &#125;, destroyed() &#123; window.removeEventListener('mousemove', this.update) &#125;, methods: &#123; update(e) &#123; this.x = e.pageX this.y = e.pageY &#125; &#125;&#125; å½“mixinsçš„æ•°é‡é€æ¸å¢žåŠ ï¼Œæˆ‘ä»¬å¸¸å¸¸ä¼šæœ‰è¿™æ ·çš„ç–‘æƒ‘ï¼š å‘½åç©ºé—´å†²çª æ¨¡ç‰ˆæ•°æ®æ¥æºä¸æ¸…æ™° è¿™æ—¶æˆ‘ä»¬å¾€å¾€å®¹æ˜“è¿·å¤±åœ¨å„ä¸ªå˜é‡ä¸­ï¼Œæžä¸æ¸…æ¥šè¿™ä¸ªå˜é‡åˆ°åº•ä»Žä½•è€Œæ¥ã€‚ Higher-order Componentsçš„ç¼ºç‚¹é«˜é˜¶ç»„ä»¶åœ¨reacté‡Œé¢æ¯”è¾ƒå¸¸ç”¨ï¼Œåœ¨vueé‡Œé¢ç”¨çš„æ¯”è¾ƒå°‘ï¼š1234const Demo = withMousePosition(&#123; props: ['x', 'y'], template: `&lt;div&gt;Mouse position: x &#123;&#123;x&#125;&#125; / y &#123;&#123;y&#125;&#125;&lt;/div&gt;`&#125;) ä½œä¸ºMixinçš„æ›¿ä»£å“ï¼Œå®ƒå¹¶ä¸èƒ½å¾ˆå¥½åœ°è§£å†³é—®é¢˜å´åˆå¸¦æ¥äº†æ–°çš„é—®é¢˜ï¼š propså‘½åç©ºé—´å†²çª propsæ¥æºä¸æ¸…æ™° é¢å¤–çš„ç»„ä»¶å®žä¾‹æ€§èƒ½æ¶ˆè€— æ˜¯çš„ï¼Œå½“é«˜é˜¶ç»„ä»¶åµŒå¥—è¶Šå¤šï¼Œæ€§èƒ½æ¶ˆè€—ä¹Ÿå°±è¶Šå¤š Hooksçš„ä¼˜ç‚¹å°†å‰é¢ä¾¦å¬é¼ æ ‡ä½ç½®çš„demoç”¨hooksé‡å†™ï¼š12345678910111213141516171819202122232425function useMouse() &#123; const x = value(0) const y = value(0) const update = e =&gt; &#123; x.value = e.pageX y.value = e.pageY &#125; onMounted(() =&gt; &#123; window.addEventListener('mousemove', update) &#125;) onUnmounted(() =&gt; &#123; window.removeEventListener('mousemove', update) &#125;) return &#123; x, y &#125;&#125;// in consuming componentconst Component = &#123; setup() &#123; const &#123; x, y &#125; = useMouse() const &#123; z &#125; = useOtherLogic() return &#123; x, y, z &#125; &#125;, template: `&lt;div&gt;&#123;&#123; x &#125;&#125; &#123;&#123; y &#125;&#125; &#123;&#123; z &#125;&#125;&lt;/div&gt;`&#125; è¿™æ ·ä¸€æ¥è§£å†³äº†ä¹‹å‰æ‰€æœ‰æ–¹æ¡ˆçš„ç¼ºé™·ï¼š æ²¡æœ‰å‘½åç©ºé—´å†²çªï¼šå®Œå…¨å¯ä»¥åœ¨è§£æž„ä½¿ç”¨æ—¶æŠŠx,yè¿›è¡Œé‡å‘½å æ•°æ®æ¥æºæ¸…æ™°ï¼šä½ å¾ˆæ¸…æ¥šx,yæ˜¯ä»Žå“ªä¸ªhookè€Œæ¥ æ²¡æœ‰é¢å¤–çš„ç»„ä»¶æ€§èƒ½æ¶ˆè€—ï¼šç”¨å‡½æ•°æ‰¿è½½é€»è¾‘ ä¹ä¸€çœ‹ä¸Ž React Hooks å¾ˆåƒï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªåŒºåˆ«ï¼š useMouse å‡½æ•°å†…æ”¹å˜ xã€y åŽï¼Œä¸ä¼šé‡æ–°è§¦å‘ setup æ‰§è¡Œ x y æ‹¿åˆ°çš„éƒ½æ˜¯ Wrapper è€Œä¸æ˜¯åŽŸå§‹å€¼ï¼Œä¸”è¿™ä¸ªå€¼ä¼šåŠ¨æ€å˜åŒ–ã€‚ æ€»ç»“ç›®å‰äº†è§£åˆ°çš„å°±æ˜¯è¿™ä¹ˆå¤šï¼ŒåŽç»­å†æ›´æ–°]]></content>
      <categories>
        <category>Vue</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å—ä¸äº†äº†ï¼Œæˆ‘è¦æ‰‹æ’•webpack]]></title>
    <url>%2F2019%2F08%2F30%2Feasy-pack%2F</url>
    <content type="text"><![CDATA[æœ¬æ–‡å…¶å®žæ˜¯ä¸€ä¸ªæ ‡é¢˜å…šï¼Œç”±äºŽæˆ‘æœ¬èº«å¯¹webpackçš„æŽŒæ¡ä¹Ÿæœ‰é™ï¼Œå› æ­¤è¿™ç¯‡æ–‡ç« çš„ç›®çš„ä¹Ÿä»…ä»…æ˜¯å¯¹webpackæ‰“åŒ…åŽŸç†çš„åˆæŽ¢ï¼Œä¸æ¶‰åŠloaderå’Œpluginçš„ç›¸å…³çŸ¥è¯†ã€‚æˆ‘ä»Žä¸€ä¸ªç®€å•çš„æ‰“åŒ…ç¤ºä¾‹è¯´èµ·ã€‚ æ‰“åŒ…ç¤ºä¾‹ä¸ºäº†æ¼”ç¤ºæ‰“åŒ…çš„åŽŸç†ï¼Œç®€å•æä¾›äº†ä»¥ä¸‹ç¤ºä¾‹ï¼š1234src - a.js // æ¨¡å—a,å¼•ç”¨äº†æ¨¡å—b - b.js // æ¨¡å—b - index.js // æ‰“åŒ…çš„å…¥å£ï¼Œå¼•ç”¨äº†æ¨¡å—a 123// b.jsexport const b = 'webpack'; 1234567// a.jsimport &#123; b &#125; from './b.js'const a = `Hello, $&#123;b&#125;`export default a 12345// index.jsimport a from './a.js'console.log(a) æ‰“åŒ…åŽŸç†webpackåœ¨æ‰“åŒ…æ—¶éœ€è¦ä¸ºå…¶æä¾›ä¸€ä¸ªå…¥å£æ–‡ä»¶ï¼Œç„¶åŽæ ¹æ®è¿™ä¸ªå…¥å£æ–‡ä»¶åŽ»åˆ†æžä¾èµ–ï¼ŒåŽ»åŒºåˆ†ä¸åŒçš„èµ„æºï¼Œå¹¶å°†ä¸åŒèµ„æºäº¤ç»™å¯¹åº”çš„loaderå¤„ç†ï¼ˆå‚è€ƒï¼šç¼–å†™ä¸€ä¸ªloaderï¼‰ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­webpackä¼šå¹¿æ’­è®¸å¤šäº‹ä»¶, å¯ä»¥åœ¨æ’ä»¶ä¸­ç›‘å¬è¿™äº›äº‹ä»¶æ¥æ”¹å˜webpackçš„æž„å»ºæµç¨‹ï¼ˆå‚è€ƒï¼šç¼–å†™ä¸€ä¸ªæ’ä»¶ï¼‰ ä»Žå…¥å£åˆ†æžæƒ³è¦å®žçŽ°ä¸€ä¸ªæ‰“åŒ…å·¥å…·ï¼Œæš‚æ—¶æŠ›å¼€loaderå’Œpluginè¿™äº›æ¦‚å¿µï¼Œå…ˆä»Žå…¥å£æ–‡ä»¶ç€æ‰‹åˆ†æžã€‚æ–°å»ºpack.js:123456789const fs = require('fs')const analyser = file =&gt; &#123; const content = fs.readFileSync(file, 'utf-8') console.log(content)&#125;analyser('./src/index.js') æ‰§è¡Œnode pack.jsï¼ŒæŽ§åˆ¶å°è¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š123import a from './a.js'console.log(a) å¯ä»¥å‘çŽ°å…¥å£æ–‡ä»¶ä¾èµ–äº†a.js, æ˜¾ç„¶æŽ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯åŽ»èŽ·å–a.jsçš„å†…å®¹ï¼Œå†åŽ»åˆ†æžå…¶ä¾èµ–ï¼Œä¸€ç›´åˆ°æœ€åº•å±‚çš„ä¾èµ–ä¸ºæ­¢ï¼Œæœ€ç»ˆå½¢æˆä¾èµ–æ ‘ã€‚ @babel/parserå½“ç„¶å‰é¢æ‹¿åˆ°çš„é™æ€å­—ç¬¦ä¸²æ²¡æ³•å¾ˆå¥½åœ°ç”¨æ¥åˆ†æžä¾èµ–ï¼Œéœ€è¦ä¸€ä¸ªå·¥å…·ï¼š@babel/parserï¼Œå®ƒç”¨æ¥å°†ä»£ç (js|jsx|flow|ts)è½¬åŒ–æˆast, ç”¨æ³•å¦‚ä¸‹ï¼š12345678const analyser = file =&gt; &#123; const content = fs.readFileSync(file, 'utf-8') const ast = require('@babel/parser').parse(content, &#123; sourceType: 'module' &#125;) console.log(ast)&#125; æ‰§è¡Œnode pack.jsï¼ŒæŽ§åˆ¶å°è¾“å‡ºä»¥ä¸‹ä¿¡æ¯ï¼š12345678910111213141516171819Node &#123; type: &apos;File&apos;, start: 0, end: 38, loc: SourceLocation &#123; start: Position &#123; line: 1, column: 0 &#125;, end: Position &#123; line: 3, column: 14 &#125; &#125;, program: Node &#123; type: &apos;Program&apos;, start: 0, end: 38, loc: SourceLocation &#123; start: [Position], end: [Position] &#125;, sourceType: &apos;module&apos;, interpreter: null, body: [ [Node], [Node] ], directives: [] &#125;, comments: [] &#125; ä¸Šé¢programè¡¨ç¤ºå½“å‰è¿è¡Œçš„ç¨‹åºï¼Œå…¶bodyä¸‹çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯index.jså¯¹åº”çš„astï¼Œæ‰“å°å‡ºæ¥çœ‹ä¸‹ï¼š 12345678910111213141516171819202122232425262728# ast.program.body[ Node &#123; type: &apos;ImportDeclaration&apos;, start: 0, end: 22, loc: SourceLocation &#123; start: [Position], end: [Position] &#125;, specifiers: [ [Node] ], source: Node &#123; type: &apos;StringLiteral&apos;, start: 14, end: 22, loc: [SourceLocation], extra: [Object], value: &apos;./a.js&apos; &#125; &#125;, Node &#123; type: &apos;ExpressionStatement&apos;, start: 24, end: 38, loc: SourceLocation &#123; start: [Position], end: [Position] &#125;, expression: Node &#123; type: &apos;CallExpression&apos;, start: 24, end: 38, loc: [SourceLocation], callee: [Node], arguments: [Array] &#125; &#125; ] æ²¡é”™ï¼ŒImportDeclarationå¯¹åº”import a from &#39;./a.js&#39;ï¼ŒExpressionStatementå¯¹åº”console.log(a)ã€‚æŽ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯éåŽ†å‡ºè¿™äº›ä¾èµ–ï¼Œä¹Ÿå°±æ˜¯ImportDeclarationã€‚ é‚£æ€Žä¹ˆåšå‘¢ï¼Ÿéš¾é“æˆ‘ä»¬æ‰‹åŠ¨éåŽ†å—ï¼Ÿbabelä¸ºæˆ‘ä»¬æä¾›äº†å¦å¤–ä¸€ä¸ªå·¥å…·ï¼š@babel/traverse @babel/traverseå®ƒä¸“é—¨ç”¨äºŽéåŽ†astï¼Œç”¨æ³•å¦‚ä¸‹ï¼š1234567const traverse = require('@babel/traverse').defaulttraverse(ast, &#123; ImportDeclaration(&#123; node &#125;) &#123; console.log(node) &#125;&#125;) å…¶ä¸­çš„optionsä¼ å…¥asté‡Œçš„typeï¼Œå¹¶ä¸”æ˜¯å›žè°ƒå‡½æ•°ï¼Œæ„æ€æ˜¯ï¼šé‡åˆ°typeä¸ºImportDeclarationçš„èŠ‚ç‚¹å°±åŽ»æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œæ‰“å°å‡ºæ¥çœ‹ä¸‹ï¼š1234567891011121314151617181920212223Node &#123; type: &apos;ImportDeclaration&apos;, start: 0, end: 22, loc: SourceLocation &#123; start: Position &#123; line: 1, column: 0 &#125;, end: Position &#123; line: 1, column: 22 &#125; &#125;, specifiers: [ Node &#123; type: &apos;ImportDefaultSpecifier&apos;, start: 7, end: 8, loc: [SourceLocation], local: [Node] &#125; ], source: Node &#123; type: &apos;StringLiteral&apos;, start: 14, end: 22, loc: SourceLocation &#123; start: [Position], end: [Position] &#125;, extra: &#123; rawValue: &apos;./a.js&apos;, raw: &apos;\&apos;./a.js\&apos;&apos; &#125;, value: &apos;./a.js&apos; &#125; &#125; ç¡®å®žåªæœ‰type: ImportDeclarationçš„èŠ‚ç‚¹ï¼Œå…¶ä¸‹çš„source.valueå°±æ˜¯å…¥å£æ–‡ä»¶çš„ä¾èµ–äº†ï¼ŒæŽ¥ä¸‹æ¥æˆ‘ä»¬å°†è¿™äº›ä¾èµ–ä»¥é”®ä¸ºç›¸å¯¹è·¯å¾„å€¼ä¸ºç»å¯¹è·¯å¾„ï¼Œå­˜åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œé¢ï¼š12345678const dependencies = &#123;&#125;traverse(ast, &#123; ImportDeclaration(&#123; node &#125;) &#123; const dirname = path.dirname(file) // src dependencies[node.source.value] = './' + path.join(dirname, node.source.value) // ./src/a.js &#125;&#125;) è¿™æ—¶å…¥å£çš„çš„dependencieså°±æ˜¯è¿™æ ·ï¼š1&#123; &apos;./a.js&apos;: &apos;./src/a.js&apos; &#125; ä¾èµ–å…³ç³»ç¡®å®šå¥½äº†ï¼ŒæŽ¥ä¸‹æ¥å°†astè½¬åŒ–ä¸ºæµè§ˆå™¨ç«¯å¯ä»¥æ‰§è¡Œçš„ä»£ç ï¼Œåˆ©ç”¨babelæä¾›çš„@babel/coreæ¥åšã€‚ @babel/core è¯·å…ˆå®‰è£…çŽ¯å¢ƒé¢„è®¾@babel/preset-env å®ƒæä¾›äº†è®¸å¤šæ–¹æ³•ï¼Œè¿™é‡Œä½¿ç”¨transformFromAst:123const &#123; code &#125; = babel.transformFromAst(ast, content, &#123; presets: ["@babel/preset-env"]&#125;) æ‰“å°codeæ¥çœ‹ä¸‹ï¼š1234567"use strict";var _a = _interopRequireDefault(require("./a.js"));function _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; "default": obj &#125;; &#125;console.log(_a["default"]); æœ€åŽåœ¨analyserå‡½æ•°çš„ç»“å°¾ï¼Œè¿”å›žä¸€ä¸ªå¯¹è±¡ï¼Œåˆ°è¿™é‡Œçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031const fs = require('fs')const path = require('path')const babel = require('@babel/core')const traverse = require('@babel/traverse').defaultconst analyser = file =&gt; &#123; const content = fs.readFileSync(file, 'utf-8') const ast = require('@babel/parser').parse(content, &#123; sourceType: 'module' &#125;) const dependencies = &#123;&#125; traverse(ast, &#123; ImportDeclaration(&#123; node &#125;) &#123; const dirname = path.dirname(file) dependencies[node.source.value] = './' + path.join(dirname, node.source.value) &#125; &#125;) const &#123; code &#125; = babel.transformFromAst(ast, content, &#123; presets: ["@babel/preset-env"] &#125;) return &#123; file, dependencies, code &#125;&#125;const module = analyser('./src/index.js') æž„å»ºä¾èµ–æ ‘ä¸Šé¢åªæ˜¯åˆ†æžäº†å…¥å£æ–‡ä»¶ï¼Œè¿˜éœ€è¦é€’å½’æ‹¿åˆ°æ‰€æœ‰çš„ä¾èµ–å½¢æˆä¾èµ–æ ‘ï¼Œä»£ç å¦‚ä¸‹ï¼š1234567891011121314151617181920212223242526const genDependenciesGraph = entry =&gt; &#123; const entryModule = analyser(entry) const graphArray = [ entryModule ] for(let i = 0; i &lt; graphArray.length; i++) &#123; const &#123; dependencies &#125; = graphArray[i] if(dependencies) &#123; for(let j in dependencies) &#123; graphArray.push(moduleAnalyser(dependencies[j])) &#125; &#125; &#125; const graph = &#123;&#125; graphArray.forEach(item =&gt; &#123; graph[item.file] = &#123; dependencies: item.dependencies, code: item.code &#125; &#125;) return graph&#125;const graph = genDependenciesGraph(&apos;./src/index.js&apos;) æœ€ç»ˆçœ‹ä¸‹æ‹¿åˆ°çš„ä¾èµ–æ ‘graph:123456789101112&#123; &apos;./src/index.js&apos;: &#123; dependencies: &#123; &apos;./a.js&apos;: &apos;./src/a.js&apos; &#125;, code: &apos;&quot;use strict&quot;;\n\nvar _a = _interopRequireDefault(require(&quot;./a.js&quot;));\n\nfunction _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; &quot;default&quot;: obj &#125;; &#125;\n\nconsole.log(_a[&quot;default&quot;]);&apos; &#125;, &apos;./src/a.js&apos;: &#123; dependencies: &#123; &apos;./b.js&apos;: &apos;./src/b.js&apos; &#125;, code: &apos;&quot;use strict&quot;;\n\nObject.defineProperty(exports, &quot;__esModule&quot;, &#123;\n value: true\n&#125;);\nexports[&quot;default&quot;] = void 0;\n\nvar _b = require(&quot;./b.js&quot;);\n\nvar a = &quot;Hello, &quot;.concat(_b.b);\nvar _default = a;\nexports[&quot;default&quot;] = _default;&apos; &#125;, &apos;./src/b.js&apos;: &#123; dependencies: &#123;&#125;, code: &apos;&quot;use strict&quot;;\n\nObject.defineProperty(exports, &quot;__esModule&quot;, &#123;\n value: true\n&#125;);\nexports.b = void 0;\nvar b = \&apos;hello\&apos;;\nexports.b = b;&apos; &#125; &#125; graphé‡Œçš„codeç›®å‰æ˜¯ä¸èƒ½ç›´æŽ¥è·‘åœ¨æµè§ˆå™¨çš„ï¼Œå› ä¸ºæµè§ˆå™¨é‡Œæ²¡æœ‰requireå‡½æ•°å’Œexportså¯¹è±¡ï¼ŒåŽé¢åœ¨ç”Ÿæˆå¯æ‰§è¡Œä»£ç æ—¶éœ€è¦åŽ»æ‰‹åŠ¨æž„é€ è¿™ä¿©å…„å¼Ÿã€‚ webpackæ‰“åŒ…åŽä»£ç åˆ†æžè¿™é‡Œä¸å¦¨å…ˆçœ‹ä¸‹webpack`@4.39.3æ‰“åŒ…åŽçš„ä»£ç æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæ–°å»ºwebpack.config.js`:12345678910const path = require('path')module.exports = &#123; mode: 'development', entry: './src/index.js', output: &#123; path: path.join(__dirname, './dist'), filename: '[name].js' &#125;&#125; ç»ˆç«¯æ‰§è¡Œnpx webpackï¼Œåœ¨distç›®å½•ä¸‹ç”Ÿæˆmain.jsï¼Œçœ‹ä¸‹æ‰“åŒ…å†…å®¹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125/******/ (function(modules) &#123; // webpackBootstrap/******/ // The module cache/******/ var installedModules = &#123;&#125;;/******//******/ // The require function/******/ function __webpack_require__(moduleId) &#123;/******//******/ // Check if module is in cache/******/ if(installedModules[moduleId]) &#123;/******/ return installedModules[moduleId].exports;/******/ &#125;/******/ // Create a new module (and put it into the cache)/******/ var module = installedModules[moduleId] = &#123;/******/ i: moduleId,/******/ l: false,/******/ exports: &#123;&#125;/******/ &#125;;/******//******/ // Execute the module function/******/ modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);/******//******/ // Flag the module as loaded/******/ module.l = true;/******//******/ // Return the exports of the module/******/ return module.exports;/******/ &#125;/******//******//******/ // expose the modules object (__webpack_modules__)/******/ __webpack_require__.m = modules;/******//******/ // expose the module cache/******/ __webpack_require__.c = installedModules;/******//******/ // define getter function for harmony exports/******/ __webpack_require__.d = function(exports, name, getter) &#123;/******/ if(!__webpack_require__.o(exports, name)) &#123;/******/ Object.defineProperty(exports, name, &#123; enumerable: true, get: getter &#125;);/******/ &#125;/******/ &#125;;/******//******/ // define __esModule on exports/******/ __webpack_require__.r = function(exports) &#123;/******/ if(typeof Symbol !== 'undefined' &amp;&amp; Symbol.toStringTag) &#123;/******/ Object.defineProperty(exports, Symbol.toStringTag, &#123; value: 'Module' &#125;);/******/ &#125;/******/ Object.defineProperty(exports, '__esModule', &#123; value: true &#125;);/******/ &#125;;/******//******/ // create a fake namespace object/******/ // mode &amp; 1: value is a module id, require it/******/ // mode &amp; 2: merge all properties of value into the ns/******/ // mode &amp; 4: return value when already ns object/******/ // mode &amp; 8|1: behave like require/******/ __webpack_require__.t = function(value, mode) &#123;/******/ if(mode &amp; 1) value = __webpack_require__(value);/******/ if(mode &amp; 8) return value;/******/ if((mode &amp; 4) &amp;&amp; typeof value === 'object' &amp;&amp; value &amp;&amp; value.__esModule) return value;/******/ var ns = Object.create(null);/******/ __webpack_require__.r(ns);/******/ Object.defineProperty(ns, 'default', &#123; enumerable: true, value: value &#125;);/******/ if(mode &amp; 2 &amp;&amp; typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) &#123; return value[key]; &#125;.bind(null, key));/******/ return ns;/******/ &#125;;/******//******/ // getDefaultExport function for compatibility with non-harmony modules/******/ __webpack_require__.n = function(module) &#123;/******/ var getter = module &amp;&amp; module.__esModule ?/******/ function getDefault() &#123; return module['default']; &#125; :/******/ function getModuleExports() &#123; return module; &#125;;/******/ __webpack_require__.d(getter, 'a', getter);/******/ return getter;/******/ &#125;;/******//******/ // Object.prototype.hasOwnProperty.call/******/ __webpack_require__.o = function(object, property) &#123; return Object.prototype.hasOwnProperty.call(object, property); &#125;;/******//******/ // __webpack_public_path__/******/ __webpack_require__.p = "";/******//******//******/ // Load entry module and return exports/******/ return __webpack_require__(__webpack_require__.s = "./src/index.js");/******/ &#125;)/************************************************************************//******/ (&#123;/***/ "./src/a.js":/*!******************!*\ !*** ./src/a.js ***! \******************//*! exports provided: default *//***/ (function(module, __webpack_exports__, __webpack_require__) &#123;"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _b_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./b.js */ \"./src/b.js\");\n\n\nconst a = `Hello, $&#123;_b_js__WEBPACK_IMPORTED_MODULE_0__[\"b\"]&#125;`\n\n/* harmony default export */ __webpack_exports__[\"default\"] = (a);\n\n//# sourceURL=webpack:///./src/a.js?");/***/ &#125;),/***/ "./src/b.js":/*!******************!*\ !*** ./src/b.js ***! \******************//*! exports provided: b *//***/ (function(module, __webpack_exports__, __webpack_require__) &#123;"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, \"b\", function() &#123; return b; &#125;);\nconst b = 'hello';\n\n//# sourceURL=webpack:///./src/b.js?");/***/ &#125;),/***/ "./src/index.js":/*!**********************!*\ !*** ./src/index.js ***! \**********************//*! no exports provided *//***/ (function(module, __webpack_exports__, __webpack_require__) &#123;"use strict";eval("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var _a_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./a.js */ \"./src/a.js\");\n\n\nconsole.log(_a_js__WEBPACK_IMPORTED_MODULE_0__[\"default\"])\n\n//# sourceURL=webpack:///./src/index.js?");/***/ &#125;)/******/ &#125;); å…¶å®žå°±æ˜¯ä¸€ä¸ªè‡ªæ‰§è¡Œå‡½æ•°ï¼š1234567891011121314151617181920212223242526(function(modules)&#123; // The module cache var installedModules = &#123;&#125;; // The require function function __webpack_require__(moduleId) &#123; // ... &#125; __webpack_require__.m = modules; __webpack_require__.c = installedModules; __webpack_require__.d = function(exports, name, getter) &#123;&#125;; __webpack_require__.r = function(exports) &#123;&#125;; // ... return __webpack_require__(__webpack_require__.s = "./src/index.js"); &#125;)(&#123; "./src/a.js": (function(module, __webpack_exports__, __webpack_require__) &#123; eval(...) &#125;), "./src/b.js": (function(module, __webpack_exports__, __webpack_require__) &#123; eval(...) &#125;), "./src/index.js": (function(module, __webpack_exports__, __webpack_require__) &#123; eval(...) &#125;)&#125;) çœ‹ä¸‹__webpack_require__åšäº†ä»€ä¹ˆï¼š1234567891011121314151617181920function __webpack_require__(moduleId) &#123; // Check if module is in cache if(installedModules[moduleId]) &#123; return installedModules[moduleId].exports; &#125; // Create a new module (and put it into the cache) var module = installedModules[moduleId] = &#123; i: moduleId, l: false, exports: &#123;&#125; &#125;; // Execute the module function // è¿™é‡Œçš„module.exports = &#123;&#125; modules[moduleId].call(module.exports, module, module.exports, __webpack_require__); // Flag the module as loaded module.l = true; // Return the exports of the module // modules[moduleId].callçš„æ—¶å€™module.exportsä¼šè¢«ä¿®æ”¹ return module.exports;&#125; é¦–å…ˆçœ‹è¿™ä¸ªæ¨¡å—æ˜¯å¦æ³¨å†Œè¿‡ï¼Œå¦‚æžœæœ‰åˆ™ç›´æŽ¥è¿”å›žè¿™ä¸ªæ¨¡å— æ‰§è¡Œmodules[moduleId].call()ï¼Œè¿™ä¸€æ­¥ä¼šä¿®æ”¹module.exports è®¾ç½®module.l = trueï¼Œæ ‡è¯†å·²æ³¨å†Œ è¿”å›žmodule.exportsï¼Œä¹Ÿå°±æ˜¯å°†è¿™ä¸ªæ¨¡å—çš„æ‰§è¡Œç»“æžœä¼ ç»™ä¸‹ä¸€ä¸ªæ¨¡å— ç”Ÿæˆå¯æ‰§è¡Œä»£ç å‰é¢æ‹¿åˆ°äº†ä¾èµ–æ ‘ï¼Œè¿™ä¸€æ­¥è¦æ ¹æ®ä¾èµ–æ ‘ç”Ÿæˆå¯åœ¨æµè§ˆå™¨ç«¯æ‰§è¡Œçš„æœ€ç»ˆä»£ç ã€‚å¢žåŠ ä¸€ä¸ªå‡½æ•°genCodeï¼š1234567891011121314151617181920212223const genCode = entry =&gt; &#123; const graph = JSON.stringify(genDependenciesGraph(entry)) return ` (function(graph)&#123; // æž„é€ requireå‡½æ•° function require(module) &#123; // æ‰“åŒ…åŽä»£ç é‡Œrequire('ç›¸å¯¹è·¯å¾„')ï¼Œè¿™é‡Œéœ€è¦è½¬ä¸ºç»å¯¹è·¯å¾„æ‰èƒ½æ‰¾åˆ°æ¨¡å— function localRequire(relativePath) &#123; return require(graph[module].dependencies[relativePath]); &#125; // åˆ¶é€ exports let exports = &#123;&#125;; (function(require, exports, code)&#123; eval(code) &#125;)(localRequire, exports, graph[module].code) return exports; &#125; require('$&#123;entry&#125;') &#125;)($&#123;graph&#125;) `&#125;const code = genCode('./src/index.js') æˆ‘ä»¬çœ‹ä¸‹æœ€ç»ˆçš„code:12345678910111213(function(graph)&#123; function require(module) &#123; function localRequire(relativePath) &#123; return require(graph[module].dependencies[relativePath]); &#125; let exports = &#123;&#125;; (function(require, exports, code)&#123; eval(code) &#125;)(localRequire, exports, graph[module].code) return exports; &#125; require('./src/index.js')&#125;)(&#123;"./src/index.js":&#123;"dependencies":&#123;"./a.js":"./src/a.js"&#125;,"code":"\"use strict\";\n\nvar _a = _interopRequireDefault(require(\"./a.js\"));\n\nfunction _interopRequireDefault(obj) &#123; return obj &amp;&amp; obj.__esModule ? obj : &#123; \"default\": obj &#125;; &#125;\n\nconsole.log(_a[\"default\"]);"&#125;,"./src/a.js":&#123;"dependencies":&#123;"./b.js":"./src/b.js"&#125;,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", &#123;\n value: true\n&#125;);\nexports[\"default\"] = void 0;\n\nvar _b = require(\"./b.js\");\n\nvar a = \"Hello, \".concat(_b.b);\nvar _default = a;\nexports[\"default\"] = _default;"&#125;,"./src/b.js":&#123;"dependencies":&#123;&#125;,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", &#123;\n value: true\n&#125;);\nexports.b = void 0;\nvar b = 'hello';\nexports.b = b;"&#125;&#125;) å¤åˆ¶è¿™æ®µä»£ç ï¼Œæ”¾åˆ°æµè§ˆå™¨æŽ§åˆ¶å°ï¼ŒæˆåŠŸè¾“å‡ºHello, webpackï¼Œå’Œä¹‹å‰ç”¨webpackæ‰“åŒ…çš„è¾“å‡ºç»“æžœä¸€è‡´ï¼Œåˆ°è¿™é‡Œï¼Œç®—æ˜¯å®Œæˆäº†webpackæœ€åŸºç¡€çš„åŠŸèƒ½ã€‚]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>webpack4</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ¢ç´¢ç»„ä»¶åº“çš„æœ€ä½³å®žè·µ]]></title>
    <url>%2F2019%2F08%2F22%2Fvue-component-library%2F</url>
    <content type="text"><![CDATA[ä¿—è¯è¯´ï¼šå†™ä¸ªç»„ä»¶åº“ç®€å•ï¼Œå†™å¥½ç»„ä»¶åº“å¾ˆéš¾ æœ¬æ–‡äº‰å–ä¸åšæ ‡é¢˜å…šã€‚ ç›®æ ‡ 90%+æµ‹è¯•è¦†ç›–çŽ‡ ä¸ä½¿ç”¨template å°½å¯èƒ½å°çš„æ‰“åŒ…ä½“ç§¯ æ”¯æŒæŒ‰éœ€åŠ è½½ æ”¯æŒä¸»é¢˜å®šåˆ¶ æ”¯æŒVSCode Vetur ä¸åˆ»æ„å †ç ŒåŠŸèƒ½ ä»¥ä¸Šä¾¿æ˜¯æˆ‘å¯¹è¯¥ç»„ä»¶åº“çš„æœŸæœ›ï¼Œå¸¦ç€ä»¥ä¸Šéœ€æ±‚ï¼Œå¼€å§‹ç€æ‰‹åˆ†æž ç›®æ ‡æ‹†è§£1. 80%+æµ‹è¯•è¦†ç›–çŽ‡å¯¹äºŽUIç»„ä»¶è€Œè¨€ï¼Œè¿‡åˆ†æœ€æ±‚æµ‹è¯•è¦†ç›–çŽ‡æ„ä¹‰ä¸å¤§ï¼Œæ‰€ä»¥æˆ‘å°†90%å½“ä½œæµ‹è¯•è¾¾æ ‡çº¿ã€‚æµ‹è¯•å·¥å…·çš„è¯æœ‰è®¸å¤šå¯ä¾›é€‰æ‹©ï¼šjestã€ mochaã€karmaç­‰ï¼Œæˆ‘ä½¿ç”¨jestï¼Œç›¸å¯¹å…¶ä»–æµ‹è¯•æ¡†æž¶ï¼Œå®ƒçš„ä¸€å¤§ç‰¹ç‚¹å°±æ˜¯å†…ç½®äº†å¸¸ç”¨çš„æµ‹è¯•å·¥å…·ï¼Œæ¯”å¦‚è‡ªå¸¦æ–­è¨€ã€æµ‹è¯•è¦†ç›–çŽ‡å·¥å…·ï¼Œå®žçŽ°äº†å¼€ç®±å³ç”¨ã€‚ 2.ä¸ä½¿ç”¨templateç›¸è¾ƒäºŽtemplateï¼Œjsxåœ¨ç¼–å†™å¤æ‚åŸºç¡€ç»„ä»¶æ—¶å¾€å¾€æ›´å…·ä¼˜åŠ¿ï¼Œä¸ä½¿ç”¨templateä¸æ˜¯å› ä¸ºå®ƒä¸å¥½ï¼ˆç¼–å†™ä¸šåŠ¡ç»„ä»¶æ—¶æ›´æŽ¨èä½¿ç”¨templateï¼‰ï¼Œè€Œæ˜¯æˆ‘ä¸å¸Œæœ›åœ¨åŒä¸€ä¸ªç»„ä»¶åº“é‡ŒåŒæ—¶ä½¿ç”¨jsxå’Œtemplate, ç®€åŒ–ç»„ä»¶çš„ç¼–è¯‘ä¸Žæž„å»ºæµç¨‹è¿™ä¸€ç‚¹å¾ˆå…³é”®ã€‚ 3.å°½å¯èƒ½å°çš„æ‰“åŒ…ä½“ç§¯æˆ‘ä½¿ç”¨webpackè¿›è¡Œæ‰“åŒ…ï¼Œå› æ­¤éœ€è¦ä»Žwebpacké…ç½®ç€æ‰‹åˆ†æžã€‚å¯¹äºŽä½¿ç”¨templateç¼–å†™çš„vueç»„ä»¶ï¼Œæœ€æ™®é€šçš„ç¼–è¯‘æ–¹å¼å°±æ˜¯webpack + vue-loaderï¼Œè¿™æ ·åšçš„é—®é¢˜åœ¨äºŽå®¹æ˜“å¼•å…¥å¤§é‡å†—ä½™ä»£ç ï¼Œæ¯”å¦‚ï¼šwebpackå†…ç½®çš„æ¨¡å—åŒ–ä»£ç ã€vue-loader å†…ç½®çš„ normalize å‡½æ•°ã€é‡å¤å¼•å…¥çš„ babel helper ç­‰ç­‰ï¼Œè€Œæˆ‘ä¸å¸Œæœ›åœ¨ç»„ä»¶çš„ç¼–è¯‘ç»“æžœä¸­å¼•å…¥è¿™äº›å†—ä½™ä»£ç ï¼Œé‚£ä¹ˆè¿™ç§æƒ…å†µæœ€å¥½ä½¿ç”¨æ¯”vue-loaderæ›´åº•å±‚çš„ä¸€ä¸ªå·¥å…·: vue-template-compiler, é€šè¿‡å®ƒç»“åˆbabelæ¥ç¼–è¯‘å¯ä»¥å¾—åˆ°æ¯”è¾ƒç†æƒ³çš„æ•ˆæžœã€‚ å½“ç„¶æˆ‘æ²¡æœ‰ä½¿ç”¨æ¨¡ç‰ˆï¼Œè€Œæ˜¯tsxï¼Œæƒ…å†µå°±å˜å¾—æ›´åŠ ç®€å•äº†, åªéœ€è¦ç”¨babelå°†tsxç¼–è¯‘æˆjsä¸å°±è¡Œäº†å—ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯babelï¼Œéœ€è¦ä½¿ç”¨@babel/plugin-transform-runtimeé¿å…é‡å¤å¼•å…¥helperå‡½æ•°(A plugin that enables the re-use of Babelâ€™s injected helper code to save on codesize) å¯¹äºŽrollupï¼Œä¸€èˆ¬åœ¨æ‰“åŒ…çº¯jsåº“æ—¶ä¼˜åŠ¿æ›´å¤§ï¼Œæ‰€ä»¥è¿˜æ²¡æœ‰å°è¯•ç”¨å®ƒæ¥æ‰“åŒ…ç»„ä»¶åº“ã€‚è€Œä¸”æˆ‘çœ‹ä¸»æµç»„ä»¶åº“ä¹Ÿéƒ½æ˜¯ç”¨webpackæ‰“åŒ…ï¼Œå› æ­¤è·Ÿç€ä¸»æµæ¥æ²¡é”™ã€‚ 4.æ”¯æŒæŒ‰éœ€åŠ è½½è¿™ä¸ªæ˜¯ç»„ä»¶åº“çš„åŸºæœ¬åŠŸèƒ½ï¼Œä¸€èˆ¬é€šè¿‡é…ç½®babel-plugin-import æ¥åšï¼Œå®ƒä¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°† import çš„å†™æ³•è‡ªåŠ¨è½¬æ¢ä¸ºæŒ‰éœ€å¼•å…¥çš„æ–¹å¼ã€‚å½“ç„¶ï¼Œä¸é—²éº»çƒ¦æ‰‹åŠ¨å¼•å…¥æ‰€éœ€ç»„ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ å¦‚æžœä½ çš„é¡¹ç›®åŸºäºŽTypescript,é‚£ä¹ˆç”¨ts-import-pluginä»£æ›¿ 5.ä¸»é¢˜å®šåˆ¶æˆ‘å¸Œæœ›å¯ä»¥å¯¹ç»„ä»¶æ ·å¼åšå…¨å±€ä¿®æ”¹ï¼Œè€Œä¸æ˜¯åœ¨ä½¿ç”¨æ—¶åŽ»è¦†ç›–ç»„ä»¶å†…éƒ¨ç±»ï¼Œè¿™å—å¯ä»¥é€šè¿‡lesså’Œless-loaderé…åˆbabel-plugin-importæ¥åš å¦‚æžœæ˜¯ä½¿ç”¨.vueçš„ç»„ä»¶å¼€å‘æ–¹å¼ï¼Œä¸€èˆ¬éœ€è¦å°†æ ·å¼å•ç‹¬æŠ½å‡ºæ¥è€Œä¸æ˜¯å†™åœ¨ä¸­ï¼Œå¦åˆ™éœ€è¦ç”¨åˆ°åŽç¼–è¯‘ã€‚ï¼ˆå‚è€ƒcube-uiï¼‰ 6.æ”¯æŒVSCode Veturæˆ‘å¸Œæœ›åœ¨VSCodeä¸­ä½¿ç”¨è¯¥ç»„ä»¶æ—¶ä¼šæœ‰è‡ªåŠ¨æç¤ºï¼Œè¿™å—å¯ä»¥å€ŸåŠ©ç¬¬ä¸‰æ–¹æ’ä»¶ç”Ÿæˆå¯¹åº”çš„vetur jsonæ–‡ä»¶ã€‚ æœŸæœ›ç»„ä»¶ç›®å½•ç»“æž„ç»„ä»¶ç»Ÿä¸€æ”¾åœ¨src/componentsç›®å½•ä¸‹ç®¡ç†ï¼Œæ¯ä¸ªç»„ä»¶çš„ç»“æž„å¤§è‡´å¦‚ä¸‹ï¼š12345678910111213button - demo // ç»„ä»¶demo - __test__ // å•å…ƒæµ‹è¯• - index.less - index.tsx - README.mdå…¶å®ƒç»„ä»¶ - demo // ç»„ä»¶demo - __test__ // å•å…ƒæµ‹è¯• - index.less - index.tsx - README.md... æœŸæœ›æ‰“åŒ…ç»“æžœæŒ‰ç…§ç›®å‰ä¸»æµçš„åšæ³•ï¼Œè¾“å‡º3ç§æ ¼å¼çš„ä»£ç ï¼šES Moduleã€commonjsã€UMD æ‰€è°“UMDï¼ˆUniversal Module Definitionï¼‰æŒ‡çš„æ˜¯ï¼š å…ˆåˆ¤æ–­æ˜¯å¦æ”¯æŒNode.jsæ¨¡å—æ ¼å¼ï¼ˆexportsæ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨Node.jsæ¨¡å—æ ¼å¼ã€‚ å†åˆ¤æ–­æ˜¯å¦æ”¯æŒAMDï¼ˆdefineæ˜¯å¦å­˜åœ¨ï¼‰ï¼Œå­˜åœ¨åˆ™ä½¿ç”¨AMDæ–¹å¼åŠ è½½æ¨¡å—ã€‚ å‰ä¸¤ä¸ªéƒ½ä¸å­˜åœ¨ï¼Œåˆ™å°†æ¨¡å—å…¬å¼€åˆ°å…¨å±€ï¼ˆwindowæˆ–globalï¼‰ã€‚ åœ¨package.jsonä¸­ï¼Œè®¾ç½®è¿™2ç§æ¨¡å—çš„å…¥å£ï¼š1234&#123; "main": "lib/index.js", // cjs "module": "es/index.js", // esm&#125; è‡³äºŽUMDæ ¼å¼çš„ä»£ç ï¼Œæˆ‘ä¼šåœ¨æœ€åŽé€šè¿‡webpackæ‰“åŒ…ç”Ÿæˆxpre.jså’Œxpre.min.jså¹¶æ”¾åˆ°CDNä¸Š æœŸæœ›ä½¿ç”¨æ–¹å¼ä¸€ã€æŒ‰éœ€å¼•å…¥ï¼ˆæŽ¨èï¼‰12import &#123; Button &#125; from 'xpre';Vue.use(Button) äºŒã€å…¨éƒ¨å¼•å…¥ï¼ˆä¸æŽ¨èï¼‰12import Xpre from 'xpre';Vue.use(Xpre) ä¸‰ã€CDNå¼•å…¥ é€šå¸¸ä¸ä¼šä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œä½†æŸäº›æ—¶å€™è¿˜æ˜¯æœ‰å¿…è¦çš„ 12&lt;link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xpre@0.x/lib/index.css"&gt;&lt;script src="https://cdn.jsdelivr.net/npm/xpre@0.x/lib/xpre.min.js"&gt;&lt;/script&gt; æ ¹æ®æœŸæœ›è¾“å…¥ä¸Žè¾“å‡ºæž„å»ºè„šæœ¬æœ‰äº†è¾“å…¥ï¼ˆæœŸæœ›ç»„ä»¶ç›®å½•ç»“æž„ï¼‰å’Œè¾“å‡ºï¼ˆæœŸæœ›æ‰“åŒ…ç»“æžœï¼‰ï¼Œä»¥åŠä½¿ç”¨æ–¹å¼ï¼Œå°±å¯ä»¥ç€æ‰‹ç¼–å†™æž„å»ºè„šæœ¬äº†ã€‚ 1.æˆ‘æœŸæœ›ä½¿ç”¨Vue.use(Xpre)çš„æ–¹å¼æ³¨å†Œç»„ä»¶ï¼Œé‚£ä¹ˆXpreå¿…é¡»å®žçŽ°install æ–¹æ³•ï¼Œå…¥å£index.tsæ–‡ä»¶å¤§æ¦‚è¿™æ ·ï¼š 1234567891011121314151617181920212223242526272829import &#123; VueConstructor &#125; from 'vue/types';import Button from './components/button';// ...const components: any[] = [ Button ...];const install = (Vue: VueConstructor) =&gt; &#123; components.forEach(Component =&gt; &#123; Vue.use(Component); &#125;);&#125;;// æµè§ˆå™¨çŽ¯å¢ƒif (typeof window !== 'undefined' &amp;&amp; window.Vue) &#123; install(window.Vue);&#125;// import &#123; Button &#125; from 'xpre'export &#123; install, Button&#125;// import Xpre from 'xpre'export default &#123; install&#125; ç”±æ­¤å¯è§ï¼Œæ¯ä¸ªç»„ä»¶å†…éƒ¨å¦‚:Buttonï¼Œä¹Ÿéƒ½éœ€è¦å®žçŽ°installæ–¹æ³•ã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œå†™ä¸€ä¸ªè‡ªåŠ¨æž„å»ºindex.tsçš„è„šæœ¬ï¼Œä»¥å…æ¯æ¬¡æ–°å¢žç»„ä»¶çš„æ—¶å€™æ‰‹åŠ¨ä¿®æ”¹index.tsã€‚ æž„å»ºè„šæœ¬ç»Ÿä¸€åœ¨buildç›®å½•ä¸‹ç®¡ç†ï¼Œæ–°å»ºbuild/build-entry.js, å®ƒéœ€è¦åŽ»éåŽ†src/componentsç›®å½•æ¥ç”Ÿæˆindex.ts:1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253const fs = require('fs-extra');const path = require('path');const uppercamelize = require('uppercamelcase');const Components = require('./get-components')();const packageJson = require('../package.json');const version = process.env.VERSION || packageJson.version;const tips = `/* eslint-disable */`;function buildEntry() &#123; const importList = Components.map(name =&gt; `import $&#123;uppercamelize(name)&#125; from './components/$&#123;name&#125;';`); const exportList = Components.map(name =&gt; `$&#123;uppercamelize(name)&#125;`); const content = `$&#123;tips&#125;import &#123; VueConstructor &#125; from 'vue/types';$&#123;importList.join('\n')&#125;declare global &#123; interface Window &#123; Vue?: VueConstructor; &#125;&#125;const components: any[] = [ $&#123;exportList.join(',\n ')&#125;];const install = (Vue: VueConstructor) =&gt; &#123; components.forEach(Component =&gt; &#123; Vue.use(Component); &#125;);&#125;;/* istanbul ignore if */if (typeof window !== 'undefined' &amp;&amp; window.Vue) &#123; install(window.Vue);&#125;export &#123; install, $&#123;exportList.join(',\n ')&#125;&#125;;export default &#123; install&#125;;`; // è¾“å‡ºå†…å®¹åˆ°index.ts fs.writeFileSync(path.join(__dirname, '../src/index.ts'), content);&#125;buildEntry(); 2.å¤„ç†äº†å…¥å£æ–‡ä»¶ï¼ŒæŽ¥ä¸‹æ¥éœ€è¦ç¼–è¯‘ç»„ä»¶äº† æ–°å»ºbuild/build-components.js, å®ƒéœ€è¦é€’å½’åœ°åŽ»ç¼–è¯‘srcç›®å½•ä¸‹çš„æ‰€æœ‰js|ts|tsxæ–‡ä»¶ï¼Œå¹¶æœ€ç»ˆç”Ÿæˆeså’Œlibä¸¤ä¸ªç¼–è¯‘åŽçš„ç›®å½•ï¼Œä½¿ç”¨babelæ¥è¿›è¡Œç¼–è¯‘ï¼š1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859const fs = require('fs-extra');const path = require('path');const babel = require('@babel/core');const esDir = path.join(__dirname, '../es');const libDir = path.join(__dirname, '../lib');const srcDir = path.join(__dirname, '../src');const babelConfig = &#123; configFile: path.join(__dirname, '../babel.config.js')&#125;;const scriptRegExp = /\.(js|ts|tsx)$/;const isDir = dir =&gt; fs.lstatSync(dir).isDirectory();const isCode = path =&gt; !/(demo|test|\.md)$/.test(path);const isScript = path =&gt; scriptRegExp.test(path);// åˆ†åˆ«ç¼–è¯‘es/libä¸¤ä¸ªç›®å½•function compile(dir) &#123; const files = fs.readdirSync(dir); files.forEach(file =&gt; &#123; const filePath = path.join(dir, file); // é™¤äº†js|ts|tsxæ–‡ä»¶ä¸€å¾‹ä¸ç®¡ if (!isCode(file)) &#123; return fs.removeSync(filePath); &#125; // é€’å½’ç¼–è¯‘ if (isDir(filePath)) &#123; return compile(filePath); &#125; // compile if (isScript(file)) &#123; // æ ¹æ®å®šä¹‰çš„babelè§„åˆ™ç”Ÿæˆcode // ç§»é™¤åŽŸæ–‡ä»¶ï¼ˆjs|ts|tsxï¼‰ // ç”Ÿæˆæ–°æ–‡ä»¶ï¼ˆjsï¼‰ const &#123; code &#125; = babel.transformFileSync(filePath, babelConfig); fs.removeSync(filePath); fs.outputFileSync(filePath.replace(scriptRegExp, '.js'), code); &#125; &#125;);&#125;// clear dirfs.emptyDirSync(esDir);fs.emptyDirSync(libDir);// compile es dirfs.copySync(srcDir, esDir);compile(esDir);// compile lib dir// è®¾ç½®çŽ¯å¢ƒå˜é‡ï¼Œåœ¨babel.config.jsé‡Œä¼šæ ¹æ®è¯¥çŽ¯å¢ƒå˜é‡è¾“å‡ºä¸åŒçš„æ¨¡å—process.env.BABEL_MODULE = 'commonjs';fs.copySync(srcDir, libDir);compile(libDir); ä¸Šé¢çš„æž„å»ºè„šæœ¬æ˜¯æ ¹æ®babel.config.jsçš„é…ç½®è€Œæ¥ï¼Œé‚£ä¹ˆå®ƒå¤§æ¦‚éœ€è¦å¦‚ä¸‹é…ç½®ï¼š12345678910111213141516171819202122232425262728293031323334353637383940module.exports = function () &#123; const &#123; BABEL_MODULE, NODE_ENV &#125; = process.env; const useESModules = BABEL_MODULE !== 'commonjs' &amp;&amp; NODE_ENV !== 'test'; return &#123; presets: [ [ '@babel/preset-env', // çŽ¯å¢ƒé¢„è®¾ &#123; // é»˜è®¤ä¸ºfalseï¼Œè®¾ç½®ä¸ºtrueå¯å‡å°‘ç¼–è¯‘åŽä»£ç é‡ loose: true, // "amd" | "umd" | "systemjs" | "commonjs" | "cjs" | "auto" | false, defaults to "auto" // è¡¨ç¤ºES6è¯­æ³•çš„ç¼–è¯‘ç›®æ ‡ï¼Œfalseè¡¨ç¤ºä¸è½¬æ¢ï¼Œcommonjsç­‰åŒäºŽcjs modules: useESModules ? false : 'cjs' &#125; ], [ // Configurable preset for Vue JSX plugins '@vue/babel-preset-jsx', &#123; functional: false &#125; ], // è§£æž.ts '@babel/preset-typescript' ], plugins: [ [ '@babel/plugin-transform-runtime', &#123; corejs: false, helpers: true, regenerator: false, useESModules &#125; ], '@babel/plugin-transform-object-assign' ] &#125;;&#125;; é™¤äº†é…ç½®ä¸€äº›presetså’Œpluginså¤–ï¼Œè¿˜éœ€è¦æ ¹æ®çŽ¯å¢ƒå˜é‡æ”¹å˜æ‰“åŒ…çš„æ¨¡å—æ ¼å¼ã€‚è¿™é‡Œçš„æ’ä»¶@babel/plugin-transform-runtimeå‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œæ³¨æ„regenerator: falseè¿™ä¸ªé€‰é¡¹ï¼Œè¡¨ç¤ºä¸é‡å¤ç”Ÿæˆhelperå‡½æ•°ï¼Œå¦åˆ™æ‰“åŒ…åŽä¼šå¤šå‡ºè®¸å¤šå†—ä½™ä»£ç  3.æŽ¥ä¸‹æ¥éœ€è¦ç¼–è¯‘ç»„ä»¶æ ·å¼ï¼Œå°†.lessæ–‡ä»¶ç»è¿‡ä¸€ç³»åˆ—ç¼–è¯‘è½¬åŒ–æˆæœ€ç»ˆçš„.css éœ€è¦ç”¨åˆ°çš„å·¥å…·å¤§è‡´å¦‚ä¸‹ï¼š12345// build/build-style.js const less = require('less'); // less -&gt; cssconst postcss = require('postcss'); // å¯¹cssè¿›è¡ŒåŽå¤„ç†const csso = require('csso'); // cssåŽ‹ç¼©ä¼˜åŒ– 4.æŽ¥ä¸‹éœ€è¦æ ¹æ®ç”Ÿæˆçš„æ ·å¼ç”Ÿæˆç»„ä»¶çš„styleå…¥å£ï¼Œè¿™å—éœ€è¦æ³¨æ„çš„æ˜¯ç”Ÿæˆæ ·å¼ç›®å½•çš„ç»“æž„ï¼Œå› ä¸ºæˆ‘éœ€è¦ç»„ä»¶åœ¨ä½¿ç”¨æ—¶èƒ½å¤Ÿç»“åˆbabel-plugin-importæ¥åšæ ·å¼çš„æŒ‰éœ€åŠ è½½å’Œä¸»é¢˜å®šåˆ¶ é€šè¿‡babel-plugin-importçš„ç¤ºä¾‹è¯´æ˜Žï¼š12345678910// &#123; "libraryName": "antd", style: true &#125;import &#123; Button &#125; from 'antd';ReactDOM.render(&lt;Button&gt;xxxx&lt;/Button&gt;); â†“ â†“ â†“ â†“ â†“ â†“var _button = require('antd/lib/button');require('antd/lib/button/style');ReactDOM.render(&lt;_button&gt;xxxx&lt;/_button&gt;); å¯ä»¥å‘çŽ°ï¼Œå…¶å®žé€šè¿‡è®¾ç½®style: trueï¼Œåœ¨æŒ‰éœ€å¼•å…¥ç»„ä»¶Buttonæ—¶å°±èƒ½è‡ªåŠ¨å¸®æˆ‘ä»¬å¼•å…¥å¯¹åº”çš„æ ·å¼ï¼Œå› æ­¤ä½•ä¸æ¨¡ä»¿antdï¼Œåœ¨å¯¹åº”ç»„ä»¶ä¸‹ç”Ÿæˆstyle.js:1require('xxx.css') å½“ç„¶è¿™æ ·ä¸å¤Ÿï¼Œå› ä¸ºå‰é¢æˆ‘è¯´è¿‡è¦åšä¸»é¢˜å®šåˆ¶ï¼Œæˆ‘è¿˜éœ€è¦ç”Ÿæˆä¸€ä¸ªless.jsï¼š1require('xxx.less') åˆ°è¿™é‡Œæœ€ç»ˆçš„ç¼–è¯‘ç”Ÿæˆçš„ç»„ä»¶æ ·å¼ç»“æž„åº”è¯¥æ˜¯è¿™æ ·ï¼š123style - index.js // ç”¨äºŽç»“åˆbabel-plugin-importåšç»„ä»¶æ ·å¼çš„è‡ªåŠ¨æŒ‰éœ€åŠ è½½ - less.js // ç”¨äºŽç»“åˆbabel-plugin-importåšä¸»é¢˜å®šåˆ¶ 5.å®Œæˆäº†å‰é¢çš„å·¥ä½œï¼Œä¸»é¢˜å®šåˆ¶å¯ä»¥å‚è€ƒä»¥ä¸‹é…ç½® åœ¨é…ç½®babel-plugin-importçš„æ—¶å€™å¯ä»¥è¿™æ ·åšï¼š12345678910// babel.config.jsmodule.exports = &#123; plugins: [ ["import", &#123; "libraryName": "xpre", "libraryDirectory": "es/components", "style": name =&gt; `$&#123;name&#125;/style/less` &#125;] ]&#125; ç„¶åŽæ ¹æ®lessæä¾›çš„modifyVarsä¿®æ”¹lesså˜é‡è¾¾åˆ°ç›®çš„ï¼š123456789101112131415161718module.exports = &#123; rules: [ &#123; test: /\.less$/, use: [ &#123; loader: 'less-loader', options: &#123; modifyVars: &#123; red: 'red', blue: 'blue' &#125; &#125; &#125; ] &#125; ]&#125;; åˆ†æžåˆ°è¿™é‡Œå°±å¯ä»¥å†™æž„å»ºæ ·å¼å…¥å£çš„è„šæœ¬äº†ï¼Œè¿™å—åšèµ·æ¥ä¼šéº»çƒ¦äº›ï¼Œéœ€è¦æ ¹æ®æ ·å¼çš„ä¾èµ–å…³ç³»åŽ»ç¡®å®šæ ·å¼å…¥å£ä¾èµ–çš„æ ·å¼æ–‡ä»¶ã€‚ 5.æ ¹æ®ç”Ÿæˆçš„es/index.jsæ‰“åŒ…ç”Ÿæˆumdæ ¼å¼ä»£ç  å¯¹åº”çš„webpacké…ç½®å°±ç®€å•è®¸å¤šäº†ï¼š12345678910111213141516171819202122232425module.exports = Object.assign(config, &#123; mode: 'production', entry: &#123; xpre: './es/index.js' &#125;, output: &#123; path: path.join(__dirname, '../lib'), library: 'xpre', libraryTarget: 'umd', filename: isMinify ? '[name].min.js' : '[name].js' &#125;, // é˜²æ­¢å°†vueæ‰“åˆ°bundleä¸­ externals: &#123; vue: &#123; root: 'Vue', commonjs: 'vue', commonjs2: 'vue', amd: 'vue' &#125; &#125;, performance: false, optimization: &#123; minimize: isMinify &#125;&#125;); è¿™ä¸€æ­¥åŽä¼šåœ¨libç›®å½•ä¸‹ç”Ÿæˆxpre.jså’Œxpre.min.js åˆ°è¿™é‡Œï¼Œç»„ä»¶çš„ç¼–è¯‘å·¥ä½œå°±æ­£å¼ç»“æŸäº†ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘åŽ»äº†è§£äº†å¤§é‡çš„ç»„ä»¶åº“çš„ç¼–è¯‘æµç¨‹ï¼Œè™½è¯´ç™¾èŠ±é½æ”¾ï¼Œä½†æ€»çš„åŽŸç†ç›¸é€šï¼Œè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰äººå¸¦çš„è¯è¿˜æ˜¯éœ€è¦è¸©è®¸å¤šå‘çš„ã€‚æŽ¥ä¸‹æ¥å¯ä»¥æ­£å¼å¼€å§‹å†™ç»„ä»¶äº†ã€‚é¢˜å¤–è¯â€”â€”å…³äºŽç»„ä»¶åº“å‘½åä¹‹å‰æˆ‘ç»™ç»„ä»¶åº“çš„å‘½åæ˜¯å¸¦scopeçš„ï¼Œæ¯”å¦‚ï¼š@scope/xxx, åŽæ¥æˆ‘å‘çŽ°é€šè¿‡ä»¥ä¸‹æ–¹å¼æ— æ³•å¼•å…¥ç»„ä»¶åº“ï¼š12345import Xpre from '@scope/xxx'// Xpre is not defined// è¿™ç§æƒ…å†µéœ€è¦æ‰‹åŠ¨æŒ‡å®šè·¯å¾„æ‰èƒ½æ­£ç¡®å¯¼å…¥ï¼Œå¦‚ä¸‹ï¼šimport Xpre from '@scope/xxx/lib' è¿™ä¸ªè¯¡å¼‚çš„bugï¼Œæˆ‘ç›®å‰ä¹Ÿæ‰¾ä¸åˆ°åŽŸå› ï¼Œç´¢æ€§é‡æ–°å‘½åï¼ŒåŽ»æŽ‰scopeå°±å¥½äº†ã€‚å› æ­¤ç»„ä»¶åº“çš„åŒ…åæœ€å¥½ä¸è¦å¸¦ä¸Šscope]]></content>
      <categories>
        <category>ç»„ä»¶åº“</category>
      </categories>
      <tags>
        <tag>webpack4</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä»Ž0å®žçŽ°call()/apply()/bind()]]></title>
    <url>%2F2019%2F06%2F05%2Fbind%2F</url>
    <content type="text"><![CDATA[call()/apply()åœ¨å·¥ä½œä¸­æœ‰ç€è¯¸å¤šçš„åº”ç”¨ï¼Œæœ¬ç€çŸ¥å…¶ç„¶çŸ¥å…¶æ‰€ä»¥ç„¶çš„åŽŸåˆ™ï¼ŒçŽ°åœ¨æˆ‘ä»¬ä»Ž0æ¥å®žçŽ°call/apply/bindã€‚å…¶å®žä¹Ÿå¾ˆç®€å•ï¼Œæ€è·¯å¾ˆé‡è¦ã€‚ call()æƒ³è¦å®žçŽ°callï¼Œæˆ‘ä»¬å¾—å…ˆäº†è§£å…¶æ ¸å¿ƒåŽŸç†ï¼šæ”¹å˜å‡½æ•°ä½“å†…çš„thisæŒ‡å‘(æŸ¥çœ‹MDNå®˜æ–¹è§£é‡Š)ã€‚å› æ­¤ä»Žä¸€ä¸‹å‡ ç‚¹å…¥æ‰‹ï¼š å°†å‡½æ•°è®¾ç½®ä¸ºå¯¹è±¡çš„å±žæ€§fn æ‹¿åˆ°argumentsä¼ ç»™fnå¹¶æ‰§è¡Œ åˆ é™¤fnï¼Œè¿˜åŽŸå¯¹è±¡ 1234567891011121314151617181920if(typeof Function.prototype.mycall !== 'function') &#123; Function.prototype.mycall = function(obj) &#123; let args; if(Object.prototype.toString.call(obj) !== '[object Object]') &#123; obj = window; // if in node: obj = global; &#125; args = [...arguments].slice(1); // èŽ·å–å‚æ•° obj.fn = this; // å°†å‡½æ•°è®¾ç½®ä¸ºå¯¹è±¡çš„å±žæ€§fn obj.fn(...args); // ä¼ å…¥å‚æ•°å¹¶æ‰§è¡Œfn delete obj.fn; // åˆ é™¤å±žæ€§fn &#125;&#125;var value = 'global value';var bar = &#123; value: 'local value' &#125;;function foo(a, b) &#123; console.log(a, b) console.log(this.value)&#125;foo.mycall(bar, 1, 2) //1ï¼Œ2ï¼Œ'local value'foo.mycall(null, 1, 2) // 1, 2, 'global value' apply()é‚£ä¹ˆå¯¹äºŽapplyï¼Œé™¤äº†å‚æ•°çš„ä¼ é€’å½¢å¼ä¸åŒå¤–ï¼ŒåŽŸç†åŒcallï¼š 123456789101112if(typeof Function.prototype.myapply !== 'function') &#123; Function.prototype.myapply = function(obj) &#123; if(Object.prototype.toString.call(obj) !== '[object Object]') &#123; obj = window; &#125; obj.fn = this; obj.fn(...arguments[1]); // å› ä¸ºç¬¬äºŒä¸ªå‚æ•°æ˜¯arrayï¼Œç›´æŽ¥èŽ·å–ç¬¬äºŒä¸ªå‚æ•°å¹¶ä¼ å…¥fnè°ƒç”¨ delete obj.fn; &#125;&#125; bind() bind()æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨è°ƒç”¨æ—¶è®¾ç½®thiså…³é”®å­—ä¸ºæä¾›çš„å€¼ã€‚å¹¶åœ¨è°ƒç”¨æ–°å‡½æ•°æ—¶å°†ç»™å®šå‚æ•°åˆ—è¡¨ä½œä¸ºåŽŸå‡½æ•°çš„å‚æ•°åºåˆ—çš„å‰è‹¥å¹²é¡¹ MDNç¤ºä¾‹ï¼š123456789101112131415var module = &#123; x: 42, getX: function() &#123; return this.x; &#125;&#125;var unboundGetX = module.getX;console.log(unboundGetX()); // The function gets invoked at the global scope// expected output: undefinedvar boundGetX = unboundGetX.bind(module);console.log(boundGetX());// expected output: 42// this equal to unboundGetX.call(module) ç®€å•å®žçŽ°çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨mybind()å†…è¿”å›žä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œè¯¥å‡½æ•°å†…éƒ¨é€šè¿‡call()æ¥æ”¹å˜thisæŒ‡å‘ï¼Œä»Žè€Œæ¨¡æ‹Ÿå‡ºbind()æ–¹æ³• 12345678if(typeof Function.prototype.mybind !== '[object Object]') &#123; Function.prototype.mybind = function(obj) &#123; let fn = this; return function() &#123; return fn.call(obj); &#125; &#125;&#125;]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[Javascriptå‡½æ•°æŸ¯é‡ŒåŒ–]]></title>
    <url>%2F2019%2F05%2F31%2Fcurry%2F</url>
    <content type="text"><![CDATA[Function Applyåœ¨ä¸€äº›å­˜ç²¹çš„å‡½æ•°å¼ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå‡½æ•°å¹¶ä¸æ˜¯è¢«æè¿°ä¸ºcalledæˆ–invokedï¼Œè€Œæ˜¯æè¿°ä¸ºappliedã€‚åœ¨jsé‡Œé¢ï¼Œé€šè¿‡Function.prototype.apply()å¯ä»¥å®žçŽ°Function Applyã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå‡½æ•°åº”ç”¨çš„ä¾‹å­ï¼š 1234567function say(s) &#123; return "Hello" + s;&#125;//è°ƒç”¨å‡½æ•°say("world");//åº”ç”¨å‡½æ•°say.apply(null, ["world"]) åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œinvokingå’Œapplyingå¯ä»¥å¾—åˆ°ç›¸åŒçš„ç»“æžœã€‚apply()æŽ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå°†è¦ç»‘å®šåˆ°è¯¥å‡½æ•°ä½“å†…thisçš„ä¸€ä¸ªå¯¹è±¡ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ã€‚å¦‚æžœç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç©ºï¼Œé‚£ä¹ˆthisæŒ‡å‘å…¨å±€ã€‚ é™¤äº†apply()ä»¥å¤–ï¼Œè¿˜æœ‰call()æ–¹æ³•ï¼Œå®ƒä»…ä»…åªæ˜¯apply()çš„è¯­æ³•ç³–ã€‚å½“å‡½æ•°ä»…æœ‰ä¸€ä¸ªå‚æ•°æ—¶ï¼ŒæŽ¨èä½¿ç”¨callä»£æ›¿applyï¼Œå› ä¸ºå¯ä»¥é¿å…åˆ›å»ºåªæœ‰ä¸€ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œå‡å°å†…å­˜å¼€é”€ã€‚ ä¸ºäº†è¾¾åˆ°æœ€ä½³æ–°èƒ½ï¼ŒNodeçš„Eventæ¨¡å—å°±åœ¨ä¸‰ä¸ªå‚æ•°ä»¥ä¸‹ç”¨callå¦åˆ™ç”¨apply ï¼ˆæˆ‘å†™äº†ä¸€ç¯‡æ–‡ç« ï¼Œå¦‚ä½•ä»Ž0å®žçŽ°call/apply/bindæ–¹æ³•ï¼‰ CurrycurryåŒ–å°±æ˜¯å°†å®Œå…¨åº”ç”¨å‡½æ•°å˜ä¸ºéƒ¨åˆ†åº”ç”¨å‡½æ•°çš„è¿‡ç¨‹ï¼ˆç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡æ”¹å˜ä¼ é€’ç»™å‡½æ•°å‚æ•°çš„ä¸ªæ•°æ¥è¾¾åˆ°æ”¹å˜å‡½æ•°è¿”å›žç»“æžœï¼‰ å…ˆä¸¾ä¸ªç®€å•ç‚¹çš„ðŸŒ°ï¼š 12345678910111213function add(x, y) &#123; //éƒ¨åˆ†åº”ç”¨ if(typeof y === "undefined") &#123; return function(y) &#123; return x + y &#125; &#125; //å®Œå…¨åº”ç”¨ return x + y&#125;add(1)(2) // 3ï¼ˆéƒ¨åˆ†åº”ç”¨ï¼‰add(1, 2) // 3ï¼ˆå®Œå…¨åº”ç”¨ï¼‰ ä¸Šé¢çš„ä»£ç æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼šå¦‚æžœåŒæ—¶ä¼ é€’xå’Œyï¼Œä¼šèµ°ç›´æŽ¥return x+yï¼›ä½†å¦‚æžœåªä¼ ä¸€ä¸ªxï¼Œé‚£ä¼šè¿”å›žä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œå¹¶å°†ä¹‹å‰ä¼ é€’çš„xä¿å­˜èµ·æ¥ä¾›ä¸‹æ¬¡å‡½æ•°åº”ç”¨ ç„¶åŽå®žçŽ°ä¸€ä¸ªé€šç”¨çš„curryå‡½æ•°ï¼š12345678910111213141516function curry(fn) &#123; const slice = Array.prototype.slice; let savedArgs = slice.call(arguments, 1);//å‰”é™¤ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆfnï¼‰, å°†ç±»æ•°ç»„å¯¹è±¡è½¬åŒ–ä¸ºæ•°ç»„ return function() &#123; let newArgs = slice.call(arguments); let args = [...savedArgs, ...newArgs]; return fn.apply(null, rags); &#125;&#125;//å®šä¹‰ä¸€ä¸ªæ™®é€šå‡½æ•°function add(x, y, z) &#123; return x + y + z&#125;//curryåŒ–curry(add, 1)(2, 3) // 6 ä½•æ—¶ä½¿ç”¨CurryåŒ–å½“æ­£åœ¨è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°ï¼Œå¹¶ä¸”ä¼ é€’çš„å‚æ•°å¤§å¤šéƒ½æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°å¯èƒ½æ˜¯ç”¨äºŽcurryåŒ–çš„ä¸€ä¸ªå¾ˆå¥½çš„å€™é€‰å‚æ•°ã€‚å¯ä»¥é€šè¿‡å°†ä¸€ä¸ªå‡½æ•°é›†åˆéƒ¨åˆ†åº”ç”¨åˆ°å‡½æ•°ä¸­ï¼Œä»Žè€ŒåŠ¨æ€åˆ›å»ºä¸€ä¸ªæ–°å‡½æ•°ã€‚ ä¸¾ä¸ªç®€å•çš„ðŸŒ°ï¼š12345678910111213141516171819202122function curry(func, args = []) &#123; let arity = func.length; return function (..._args) &#123; _args.unshift(...args); if(_args.length &lt; arity) &#123; return curry.call(null, func, _args); &#125; return func(..._args); &#125;&#125;function checkFun(reg, str) &#123; return reg.test(str);&#125;let check = curry(checkFun);let checkPhone = check(/^1[34578]\d&#123;9&#125;$/);console.log(checkPhone('13997603799')) //truelet checkEmail = check(/^(\w)+(\.\w+)*@(\w)+((\.\w+)+)$/);console.log(checkEmail('839862975@qq.com')) //true åœ¨vueæºç é‡Œé¢ä¹Ÿæœ‰å¤§é‡å‡½æ•°curryåŒ–çš„åº”ç”¨ã€‚æ¯”å¦‚vueåœ¨å°†VNodeè¿›è¡Œpatchç”ŸæˆçœŸå®žDOMçš„è¿‡ç¨‹ä¸­ï¼Œä¸ºäº†æŠ¹å¹³å¹³å°å·®å¼‚ï¼ˆwebå’Œweexï¼‰ï¼Œå°†å¹³å°å·®å¼‚åŒ–çš„å‚æ•°æå‰å›ºåŒ–ï¼Œè¿™æ ·ä¸ç”¨æ¯æ¬¡è°ƒç”¨patchæ–¹æ³•çš„æ—¶å€™éƒ½ä¼ é€’nodeOpså’Œmodulesäº† nodeOps è¡¨ç¤ºå¯¹ â€œå¹³å° DOMâ€ çš„ä¸€äº›æ“ä½œæ–¹æ³•ï¼Œmodules è¡¨ç¤ºå¹³å°çš„ä¸€äº›æ¨¡å—ï¼Œå®ƒä»¬ä¼šåœ¨æ•´ä¸ª patch è¿‡ç¨‹çš„ä¸åŒé˜¶æ®µæ‰§è¡Œç›¸åº”çš„é’©å­å‡½æ•°1234567891011//plantforms/web/runtime/patch.jsimport * as nodeOps from 'web/runtime/node-ops'import &#123; createPatchFunction &#125; from 'core/vdom/patch'import baseModules from 'core/vdom/modules/index'import platformModules from 'web/runtime/modules/index'// the directive module should be applied last, after all// built-in modules have been applied.const modules = platformModules.concat(baseModules)export const patch: Function = createPatchFunction(&#123; nodeOps, modules &#125;)]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
  </entry>
  <entry>
    <title><![CDATA[å†™ä¸€ä¸ªwebpack pluginå§]]></title>
    <url>%2F2019%2F05%2F24%2Fwebpack-plugin%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯pluginï¼Ÿwebpackåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå¹¿æ’­è®¸å¤šäº‹ä»¶ï¼Œpluginå¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œä»¥åœ¨ä¸€å®šçš„æ—¶æœºåŽ»æ‰§è¡Œä¸€äº›äº‹æƒ…åŽ»æ”¹å˜è¾“å‡ºç»“æžœã€‚ copyright-webpack-pluginå…ˆå†™ä¸ªç®€å•çš„pluginï¼Œæœ‰ä¸ªç›´è§‚çš„å°è±¡åŽå†å…·ä½“ä»‹ç»ç›¸å…³å†…å®¹ã€‚ è¿™ä¸ªpluginä¼šåœ¨webpackæ‰“åŒ…è¾“å‡ºèµ„æºåˆ°ç›®æ ‡æ–‡ä»¶å¤¹ä¹‹å‰ç”Ÿæˆä¸€ä¸ªcopyright.txtæ–‡ä»¶ 1234567891011121314151617181920212223// plugins/copyright-webpack-plugin.jsclass CopyrightWebpackPlugin &#123; constructor(options) &#123; this.content = options.content &#125; apply(compiler) &#123; compiler.hooks.compile.tap('CopyrightWebpackPlugin', (compilation) =&gt; &#123; console.log('compile') &#125;) compiler.hooks.emit.tapAsync('CopyrightWebpackPlugin', (compilation, cb) =&gt; &#123; // compilation: æœ¬æ¬¡æ‰“åŒ…çš„å†…å®¹ // compilation.assetsï¼š æœ¬æ¬¡æ‰“åŒ…ç”Ÿæˆçš„æ–‡ä»¶ // debugger compilation.assets['copyright.txt'] = &#123; source: () =&gt; this.content, size: () =&gt; this.content.length &#125; cb() &#125;) &#125;&#125;module.exports = CopyrightWebpackPlugin ä½¿ç”¨ï¼š12345678910// webpack.config.jsconst CopyrightWebpackPlugin = require(&apos;./plugins/copyright-webpack-plugin&apos;)module.exports = &#123; plugins: [ new CopyrightWebpackPlugin(&#123; content: &apos;Copyright by xietian&apos; &#125;) ]&#125; Webpack å¯åŠ¨åŽï¼Œåœ¨è¯»å–é…ç½®çš„è¿‡ç¨‹ä¸­ä¼šå…ˆæ‰§è¡Œ new CopyrightWebpackPlugin(optionsï¼‰ï¼Œåˆå§‹åŒ– CopyrightWebpackPlugin å¹¶èŽ·å¾—å…¶å®žä¾‹ã€‚ åœ¨åˆå§‹åŒ– compiler å¯¹è±¡åŽï¼Œå†è°ƒç”¨ CopyrightWebpackPlugin.apply (compilerï¼‰ä¸ºæ’ä»¶å®žä¾‹ä¼ å…¥ compiler å¯¹è±¡ã€‚ æ’ä»¶å®žä¾‹åœ¨èŽ·å–åˆ° compiler å¯¹è±¡åŽï¼Œå°±å¯ä»¥é€šè¿‡ compiler.hooks.eventName.tapï¼ˆæ’ä»¶åç§°ï¼Œå›žè°ƒå‡½æ•°ï¼‰ç›‘å¬åˆ° Webpack å¹¿æ’­çš„äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ compiler å¯¹è±¡åŽ»æ“ä½œ Webpack compilerå’Œcompilationåœ¨å¼€å‘ Plugin æ—¶æœ€å¸¸ç”¨çš„ä¸¤ä¸ªå¯¹è±¡å°±æ˜¯ Compiler å’Œ Compilation ï¼Œå®ƒä»¬æ˜¯ Plugin å’Œ Webpackä¹‹é—´çš„æ¡¥æ¢ã€‚Compiler å’Œ Compilation çš„å«ä¹‰å¦‚ä¸‹: Compiler å¯¹è±¡åŒ…å«äº† Webpack çŽ¯å¢ƒçš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼ŒåŒ…å« options loaders pluginsç­‰ä¿¡æ¯ã€‚è¿™ä¸ªå¯¹è±¡åœ¨Webpackå¯åŠ¨æ—¶è¢«å®žä¾‹åŒ–ï¼Œå®ƒæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¯ä»¥ç®€å•åœ°å°†å®ƒç†è§£ä¸º Webpack å®žä¾‹ Compilation å¯¹è±¡åŒ…å«äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ç­‰ã€‚å½“ Webpackä»¥å¼€å‘æ¨¡å¼è¿è¡Œæ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œä¾¿æœ‰ä¸€æ¬¡æ–°çš„ Compilationåˆ›å»ºã€‚Compilation å¯¹è±¡ä¹Ÿæä¾›äº†å¾ˆå¤šäº‹ä»¶å›žè°ƒä¾›æ’ä»¶è¿›è¡Œæ‰©å±•ã€‚é€šè¿‡ Compilationä¹Ÿèƒ½è¯»å–åˆ° Compiler å¯¹è±¡ã€‚ Compiler å’Œ Compilationéƒ½ç»§æ‰¿è‡ªTapable ++Compiler Compilation çš„åŒºåˆ«åœ¨äºŽï¼š Compiler ä»£è¡¨äº†æ•´ä¸ª Webpack ä»Žå¯åŠ¨åˆ°å…³é—­çš„ç”Ÿå‘½å‘¨æœŸï¼Œè€Œ Compilation åªä»£è¡¨ä¸€æ¬¡æ–°çš„ç¼–è¯‘++ã€‚ Plugin APIè¿™é‡Œåªä»‹ç»ä¸€äº›å¸¸ç”¨çš„Plugin ApI è¯»å–è¾“å‡ºèµ„æºã€ä»£ç å—ã€æ¨¡å—åŠå…¶ä¾èµ–emit hookè¡¨ç¤ºèµ„æºç¼–è¯‘å®Œæ¯•ï¼Œç”Ÿæˆèµ„æºåˆ° output ç›®å½•ä¹‹å‰ï¼Œåœ¨è¿™é‡Œå¯ä»¥ä¿®æ”¹è¾“å‡ºå†…å®¹12345678910111213141516171819class Plugin &#123; apply(compiler) &#123; compiler.hooks.emit.tapAsync('Plugin', (compilation, cb) =&gt; &#123; // compilation.chunksæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œç”¨äºŽå­˜æ”¾æ‰€æœ‰ä»£ç å— cimpilation.chunks.forEach(chunk =&gt; &#123; // ä¸€ä¸ªä»£ç å—ç”±å¤šä¸ªæ¨¡å—ç»„æˆï¼Œchunk.forEachModuleéåŽ†å…¶ä¸­çš„æ¨¡å— chunk.forEachModule(module =&gt; &#123; // module.fileDependenciesæ˜¯ä¸€ä¸ªæ•°ç»„, å­˜æ”¾å½“å‰æ¨¡å—çš„æ‰€æœ‰ä¾èµ–çš„æ–‡ä»¶è·¯å¾„ module.fileDependencies.forEach(filePath =&gt; &#123;&#125;) &#125;) // Webpackä¼šæ ¹æ®Chunkç”Ÿæˆè¾“å‡ºçš„æ–‡ä»¶èµ„æºï¼Œæ¯ä¸ª Chunk éƒ½å¯¹åº” ä¸€ä¸ªåŠä»¥ä¸Šçš„è¾“å‡ºæ–‡ä»¶, ä¾‹å¦‚åœ¨ Chunk ä¸­åŒ…å« css æ¨¡å—å¹¶ä¸”ä½¿ç”¨äº† ExtractTextPlugin æ—¶ï¼Œè¯¥ Chunk å°±ä¼šç”Ÿæˆ js/cssä¸¤ä¸ªæ–‡ä»¶ &#125;) &#125;) &#125;&#125; ç›‘å¬æ–‡ä»¶å˜åŒ–Webpack ä¼šä»Žé…ç½®çš„å…¥å£æ¨¡å—å‡ºå‘ï¼Œä¾æ¬¡æ‰¾å‡ºæ‰€æœ‰ä¾èµ–æ¨¡å—ï¼Œ å½“å…¥å£æ¨¡å—æˆ–è€…å…¶ä¾èµ–çš„æ¨¡å—å‘ç”Ÿå˜åŒ–æ—¶ å°±ä¼šè§¦å‘ä¸€æ¬¡æ–°çš„ Compilation watchRun hook: ä¸€ä¸ªæ–°çš„ç¼–è¯‘(compilation)è§¦å‘ä¹‹åŽï¼Œæ‰§è¡Œä¸€ä¸ªæ’ä»¶ï¼Œä½†æ˜¯æ˜¯åœ¨å®žé™…ç¼–è¯‘å¼€å§‹ä¹‹å‰ å¾…ç»­â€¦]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>webpack4</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å†™ä¸€ä¸ªwebpack loaderå§]]></title>
    <url>%2F2019%2F05%2F23%2Floader%2F</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯loaderï¼ŸLoaderå¯ä»¥ç†è§£ä¸ºæ¨¡å—è½¬æ¢å™¨ï¼Œä½œç”¨æ˜¯å°†åŽŸå†…å®¹æŒ‰ç…§ä¸€å®šçš„è§„åˆ™ç”Ÿæˆæ–°å†…å®¹ ä»¥å¤„ç†.scssæ–‡ä»¶ä¸ºä¾‹ï¼š å°†.scssæ–‡ä»¶äº¤ç»™scss-loaderå¤„ç†ï¼Œè½¬åŒ–ä¸º.cssæ–‡ä»¶ å°†.cssæ–‡ä»¶äº¤ç»™css-loaderå¤„ç†ï¼Œæ‰¾å‡ºå…¶ä¸­ä¾èµ–çš„èµ„æºï¼ŒåŽ‹ç¼©cssç­‰ å°†css-loaderè¾“å‡ºçš„cssäº¤ç»™style-loaderå¤„ç†ï¼Œè½¬æ¢æˆé€šè¿‡è„šæœ¬åŠ è½½çš„jsä»£ç  å¯¹åº”webpacké…ç½®å¦‚ä¸‹ï¼š12345678910111213141516171819module.exports = &#123; module: &#123; rules: [ &#123; test: /\.scss/, use: [ &#123; loader: 'style-loader' &#125;, &#123; loader: 'css-loader', options: &#123; minimize: true &#125; &#125;, &#123; loader: 'scss-loader' &#125; ] &#125; ] &#125;&#125; ç”±æ­¤å¯ä»¥å‘çŽ°loaderçš„è´£ä»»æ˜¯å•ä¸€çš„ï¼šä¸€ä¸ªloaderåªè´Ÿè´£åšä¸€ä»¶äº‹æƒ…ï¼Œé€šè¿‡é“¾å¼è°ƒç”¨çš„æ–¹å¼æ¥è¾¾åˆ°æˆ‘ä»¬å¤„ç†æ–‡ä»¶çš„ç›®çš„ã€‚æˆ‘ä»¬è‡ªå·±åœ¨ç¼–å†™loaderçš„æ—¶å€™ä¹Ÿéœ€è¦éµå¾ªè¿™ä¸€åŽŸåˆ™ã€‚ loaderçš„æœ¬è´¨webpackè¿è¡ŒäºŽnode.jsä¹‹ä¸Šï¼Œä¸€ä¸ªloaderæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªnode.jsæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—é€šè¿‡module.exportså¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼ŒåŽŸå†…å®¹ä¸ºè¯¥å‡½æ•°çš„å‚æ•°ï¼Œé€šè¿‡å¤„ç†åŽè¿”å›žæ–°å†…å®¹ loader API loader APIç”¨äºŽwebpackå’Œloaderä¹‹é—´è¿›è¡Œé€šä¿¡ï¼ˆloader API æ–‡æ¡£ï¼‰ æŽ¥ä¸‹æ¥æˆ‘ä¼šå¯¹å¸¸ç”¨çš„loader apiè¿›è¡Œè§£é‡Š 1. èŽ·å–loaderçš„options1234567const loaderUtils = require('loader-utils')module.exports = function(source) &#123; // ä»¥ä¸Šé¢çš„css-loaderä¸ºä¾‹, // è¿™é‡Œçš„options: &#123; minimize: true &#125; const options = loaderUtils.getOptions(this) return source&#125; 2. è¿”å›žå…¶å®ƒç»“æžœä¸Šé¢çš„ä¾‹å­æœªå°†å†…å®¹å¤„ç†å°±è¿”å›žäº†ï¼Œåœ¨æŸäº›æ—¶å€™æˆ‘ä»¬å¯èƒ½éœ€è¦è¿”å›žä¸€äº›é¢å¤–çš„ä¿¡æ¯ï¼Œæ¯”å¦‚sourceMapã€‚ ä»¥babel-loaderè½¬åŒ–es6è¯­æ³•ä¸ºä¾‹ï¼Œå®ƒè¿˜éœ€è¦è¾“å‡ºè½¬åŒ–æˆes5è¯­æ³•åŽå¯¹åº”çš„sourceMapï¼Œä»¥ä¾¿äºŽè°ƒè¯•ä»£ç ï¼š123module.exports = function(source) &#123; this.callback(null, source, sourceMap)&#125; æ²¡é”™ï¼Œè¿™é‡Œçš„å…³é”®å°±æ˜¯callback apiï¼Œå®ƒçš„è¯¦ç»†ä½¿ç”¨å¦‚ä¸‹ï¼š123456this.callback( err: Error | null, content: string | Buffer, sourceMap?: SourceMap, meta?: any); å…³äºŽsourceMapï¼š ä¸€èˆ¬åªåœ¨å¼€å‘çŽ¯å¢ƒä¸‹ç”Ÿæˆï¼Œå› ä¸ºç”ŸæˆsourceMapååˆ†è€—æ—¶ï¼Œç”Ÿäº§çŽ¯å¢ƒå…³é—­sourceMapä»¥åŠ é€Ÿæž„å»ºé€Ÿåº¦ã€‚this.sourceMapAPIå‘Šè¯‰loaderåœ¨å½“å‰æž„å»ºçŽ¯å¢ƒæ˜¯å¦éœ€è¦sourceMapã€‚å¦‚æžœæˆ‘ä»¬ç¼–å†™çš„loaderä¼šç”ŸæˆSourcMapï¼Œè¯·é“­è®°è¿™ä¸€ç‚¹ 3. åŒæ­¥ä¸Žå¼‚æ­¥å‰é¢çš„ç¤ºä¾‹éƒ½æ˜¯åŒæ­¥çš„ï¼Œå¦‚æžœæˆ‘ä»¬è¦åœ¨loaderä¸­è¿›è¡Œå¼‚æ­¥æ“ä½œï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨this.asyncAPI123456module.exports = function(source) &#123; const callback = this.async() settimeout(() =&gt; &#123; callback(null, source, sourceMap) &#125;)&#125; 4. å¤„ç†äºŒè¿›åˆ¶æ•°æ®åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ Webpack ä¼ ç»™ Loader çš„åŽŸå†…å®¹éƒ½æ˜¯ UTF-8 æ ¼å¼ç¼–ç çš„å­—ç¬¦ä¸²ã€‚ä½†åœ¨æŸäº›åœºæ™¯ä¸‹ Loader ä¸ä¼šå¤„ç†æ–‡æœ¬æ–‡ä»¶ï¼Œè€Œä¼šå¤„ç†äºŒè¿›åˆ¶æ–‡ä»¶å¦‚ file-loader ï¼Œè¿™æ—¶å°±éœ€è¦ Wepackä¸ºLoaderä¼ å…¥äºŒè¿›åˆ¶æ ¼å¼çš„æ•°æ®ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦è¿™æ ·ç¼–å†™ Loader:123456module.exports = function(source) &#123; console.log(source instanceof Buffer) // true&#125;// è¿™è¡Œä»£ç ä½¿loaderèŽ·å–çš„sourceä¸ºäºŒè¿›åˆ¶æ•°æ®module.exports.raw = true æš‚æ—¶åªä»‹ç»è¿™å‡ ä¸ªapiï¼ŒæŸ¥çœ‹å®˜æ–¹æ–‡æ¡£äº†è§£æ›´å¤šå§ã€‚ æœ¬åœ°loaderçš„ä½¿ç”¨åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æœ¬åœ°åŠ è½½loaderè€Œä¸æ˜¯æŠŠloaderä¼ åˆ°npmå†ä½¿ç”¨ã€‚å¦‚ä½•åšåˆ°ä»¥loader: &#39;xxx-loader&#39;çš„å½¢å¼ä½¿ç”¨è€Œä¸æ˜¯loader: path.resolve(__dirname, &#39;./loaders/xxx-loader&#39;)ï¼Œè¿™æ—¶å€™å°±éœ€è¦resolveLoaderé€‰é¡¹äº†ï¼Œå®ƒå‘Šè¯‰webpackæ€Žä¹ˆåŽ»æŸ¥æ‰¾loaderï¼š123456module.exports = &#123; resolveLoader: &#123; // åœ¨å“ªé‡ŒæŸ¥æ‰¾loaderï¼Œæœ‰å…ˆåŽé¡ºåº modules: ['node_modules', './loaders'] &#125;&#125; å½“ç„¶ï¼Œé™¤äº†ä¸Šé¢çš„æ–¹å¼ï¼Œé€šè¿‡npm linkå°†æœ¬åœ°loaderç›®å½•å»ºç«‹ä¸€ä¸ªè½¯è¿žæŽ¥åˆ°node_modulesï¼Œä¹Ÿå¯ä»¥è¾¾åˆ°ç›¸åŒçš„ç›®çš„ã€‚ ä»¥markerdown2vue-loaderä¸ºä¾‹ markerdown2vue-loaderæ˜¯æˆ‘å†™çš„ä¸€ä¸ªç®€å•çš„loaderï¼Œç”¨äºŽå°†markdownè½¬ä¸ºvueï¼Œå½“æˆ‘ä»¬æƒ³ç”¨markdownæ¥ç”Ÿæˆç½‘ç«™æ—¶ç‰¹åˆ«æœ‰ç”¨ã€‚äº‹å®žä¸Šï¼Œæˆ‘çš„ç»„ä»¶åº“æ–‡æ¡£å°±æ˜¯è¿™ä¹ˆå¹²çš„ã€‚ æ€è·¯ å°†.mdè½¬åŒ–ä¸ºå¯¹åº”çš„domç»“æž„ï¼ˆæ¯”å¦‚## -&gt; h2ã€### -&gt; h3ç­‰ç­‰ï¼‰,è¿™æ—¶å€™å¾—åˆ°çš„domç»“æž„ååˆ†æ‰å¹³ï¼Œæ‰€ä»¥æš‚ä¸”ç§°ä¹‹ä¸ºraw dom, è¿™ä¸€è¿‡ç¨‹ä¸­è¦å¤„ç†ä¸€ç³»åˆ—é—®é¢˜ï¼Œå¦‚ï¼šè¯­æ³•é«˜äº®ã€é”šç‚¹ã€è§£æžemojiç­‰ å†å°†raw domè¿›è¡Œè‡ªå®šä¹‰åˆ†å±‚å¤„ç†ï¼ˆæ¯”å¦‚åœ¨è¯¥loaderä¸­æˆ‘æ˜¯åˆ©ç”¨h3æ¥è¿›è¡Œåˆ’åˆ†ï¼Œåœ¨å…¶å¤–åŒ…ä¸€ä¸ª&lt;div class=&quot;card&quot;&gt;&lt;/div&gt;ï¼‰ æœ€åŽåˆ™æ˜¯è¿”å›ž&lt;template&gt;&lt;/template&gt;ä¾›vue-loaderå¤„ç† å…·ä½“å®žçŽ° å°†.mdè½¬åŒ–ä¸ºå¯¹åº”çš„domç»“æž„æ–°å»ºindex.jsï¼š 123456789101112131415161718192021222324module.exports = function (source) &#123; let options = loaderUtils.getOptions(this) || &#123;&#125;; this.cacheable &amp;&amp; this.cacheable(); options = &#123; wrapper, ...options &#125;; // ä¸»è¦åˆ©ç”¨markdown-itè¿™ä¸ªåº“ï¼ŒåŒæ—¶ä½¿ç”¨äº†ç›¸å…³æ’ä»¶ const parser = new MarkdownIt(&#123; html: true, highlight &#125;).use(anchor, &#123; permalink: true, permalinkBefore: true, permalinkSymbol: options.linkSymbol || 'ðŸ‘‰ðŸ»', level: 1, slugify &#125;).use(emoji); // ç»è¿‡parser.render(source)å¤„ç†åŽä¼šç”Ÿæˆraw domï¼Œä¼ ç»™wrapperåšåˆ†å±‚å¤„ç† return options.wrapper(parser.render(source));&#125;; å°†raw domè¿›è¡Œè‡ªå®šä¹‰åˆ†å±‚å¤„ç† æ–°å»ºcard-wrapper.js:12345678910111213141516171819module.exports = function cardWrapper(html) &#123; // htmlå­—ç¬¦ä¸²è½¬æ¢ä¸º h2/h3åˆ†ç±»çš„æ•°ç»„ const DIVIDE_ID = ':::'; const DIVIDE_ID_H2 = DIVIDE_ID + '&lt;h2'; const DIVIDE_ID_H3 = DIVIDE_ID + '&lt;h3'; const group = html.replace(/&lt;h3/g, DIVIDE_ID_H3).replace(/&lt;h2/g, DIVIDE_ID_H2).split(DIVIDE_ID); return group .map(fragment =&gt; &#123; // ä»¥h3åˆ’åˆ†card // h3åŽçš„éžh2/h3èŠ‚ç‚¹éƒ½ä¼šæ”¾è¿›card if (fragment.indexOf('&lt;h3') !== -1) &#123; return `&lt;div class="card"&gt;$&#123;fragment&#125;&lt;/div&gt;`; &#125; return fragment; &#125;) .join('');&#125;; è¿”å›žvue-templateä¾›vue-loaderä½¿ç”¨ wrapperå‡½æ•°å¦‚ä¸‹ï¼š 1234567891011function wrapper(content) &#123; content = cardWrapper(content); content = encodeURIComponent(content); // ä½¿ç”¨v-onceä¿è¯å…¶åªæ¸²æŸ“ä¸€æ¬¡ return ` &lt;template&gt; &lt;section v-html="decodeURIComponent(\`$&#123;content&#125;\`)" v-once /&gt; &lt;/template&gt; `;&#125; å®žé™…ä¸Šåˆ°è¿™é‡Œloaderå°±å†™å®Œäº†ï¼Œä½¿ç”¨çš„è¯å°±å¾ˆç®€å•äº†ï¼š123456789&lt;template&gt; &lt;md /&gt;&lt;/template&gt;export default &#123; components: &#123; Md: () =&gt; import('./xxx.md') &#125;&#125;]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>webpack4</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŸºäºŽrustæž„å»ºä¸€ä¸ªwasmæ¨¡å—å¹¶ä¸”å‘å¸ƒåˆ°npm]]></title>
    <url>%2F2019%2F05%2F22%2Frust-wasm%2F</url>
    <content type="text"><![CDATA[ç›®çš„æœ¬æ–‡è¯•å›¾åŸºäºŽrustæž„å»ºä¸€ä¸ªwasmæ¨¡å—å¹¶ä¸”å‘å¸ƒåˆ°npmï¼ å·¥å…· åœ¨è¿™ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å®‰è£…å¥½å¿…è¦çš„å·¥å…· [x] å®‰è£…rust è¿™æ­¥ä¸å¤šè¯´äº†ï¼Œå®‰è£…åŽåœ¨ç»ˆç«¯è¾“å…¥rustc --versionå¦‚æžœå‡ºçŽ°ä»¥ä¸‹æç¤ºè¯´æ˜Žå®‰è£…æˆåŠŸ: 1rustc 1.34.1 (fc50f328b 2019-04-24) å®‰è£…rustçš„åŒæ—¶ä¹Ÿä¼šé»˜è®¤å®‰è£…cargoï¼Œè¿™æ˜¯rustå®˜æ–¹çš„åŒ…ç®¡ç†å·¥å…·ï¼Œç±»ä¼¼nodeä¸­çš„npm [x] å®‰è£…wasm-pack å®ƒä¼šå¸®åŠ©æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„ä»£ç ç¼–è¯‘æˆ WebAssembly å¹¶åˆ¶é€ å‡ºæ­£ç¡®çš„ npm åŒ… 1cargo install wasm-pack æ–°å»ºé¡¹ç›®1cargo new --lib hello_wasm æ‰§è¡Œä¸Šé¢å‘½ä»¤ä¼šåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œç›®å½•ç»“æž„å¾ˆç®€å•ï¼š123-- Cargo.toml-- src -- lib.rs Cargo.tomlå°±æ˜¯é¡¹ç›®é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å¢žåŠ ä¸€äº›é…ç½®ï¼š12345[lib]crate-type = ["cdylib"][dependencies]wasm-bindgen = "0.2" æˆ‘ä»¬éœ€è¦ä¾èµ–wasm-bindgenï¼Œå¹¶ä¸”æŒ‡å®šäº†ç‰ˆæœ¬å·ï¼ˆ0.2.xï¼‰ åŒæ—¶æŒ‡å®šäº†crate-type=[&quot;cdylib&quot;],æ„æ€æ˜¯ç¼–è¯‘æˆä¸€ä¸ªå¯ä»¥è¢«å…¶å®ƒè¯­è¨€åŠ è½½çš„åŠ¨æ€åº“ã€‚ æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ å†™ç‚¹ä»£ç åœ¨src/lib.rsä¸‹ï¼š123456789101112131415extern crate wasm_bindgen;use wasm_bindgen::prelude::*;// å‘Šè¯‰rustéœ€è¦å¯¼å…¥çš„jså‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬æ‹¿åˆ°äº†window.alert#[wasm_bindgen]extern &#123; pub fn alert(s: &amp;str);&#125;// å¯¼å‡ºå¯ä»¥è¢«jsè°ƒç”¨çš„å‡½æ•°greet()#[wasm_bindgen]pub fn greet(name: &amp;str) &#123; alert(&amp;format!("Hello, &#123;&#125;", name));&#125; æž„å»ºåŒ…1wasm-pack build --scope my_npm_username è¿è¡Œwasm-pack buildå¸®æˆ‘ä»¬åšäº†ä¸€ç³»åˆ—çš„äº‹æƒ…ï¼š å°†rustç¼–è¯‘æˆWebAssembly åœ¨ç”Ÿæˆçš„WebAssemblyä¸Šè¿è¡Œwasm-bindgen, ä»Žè€Œäº§ç”Ÿä¸€ä¸ªåŒ…è£…äº†WebAssemblyçš„npmæ¨¡å— åˆ›å»ºäº†ä¸€ä¸ªpkgæ–‡ä»¶å¤¹ï¼Œé‡Œé¢åŒ…å«äº†ç”Ÿæˆçš„.wasmå’Œ.jsæ–‡ä»¶ æ ¹æ®Cargo.tomlåœ¨pkgä¸‹ç”Ÿæˆå¯¹åº”çš„package.jsonæ–‡ä»¶ æ‹·è´ README.md (å¦‚æžœå­˜åœ¨) åˆ°pkgä¸‹ å‘å¸ƒåŒ…åˆ°npm123cd pkgnpm publish . åˆ°è¿™æ­¥ä»¥åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨npmä¸Šçœ‹åˆ°åˆšåˆšå‘å¸ƒçš„åŒ…äº†ï¼Œå¦‚æžœä½ åœ¨buildçš„æ—¶å€™æŒ‡å®šäº†scope, é‚£ä¹ˆåŒ…åå°±æ˜¯@my_npm_username/hello_wasm ä½¿ç”¨åŒ… æ–°å»ºä¸€ä¸ªå‰ç«¯å·¥ç¨‹ 12345678910111213141516171819&#123; "name": "wasm-test", "version": "1.0.0", "description": "", "main": "index.js", "scripts": &#123; "dev": "webpack-dev-server" &#125;, "author": "", "license": "ISC", "dependencies": &#123; "@tian0o0/hello_wasm": "^0.1.0" &#125;, "devDependencies": &#123; "webpack": "^4.31.0", "webpack-cli": "^3.3.2", "webpack-dev-server": "^3.3.1" &#125;&#125; 12345678910// webpack.config.jsconst path = require('path');module.exports = &#123; entry: "./index.js", output: &#123; path: path.resolve(__dirname, "dist"), filename: "index.js", &#125;, mode: "development"&#125;; 1234567891011&lt;!--index.html--&gt;&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;hello-wasm example&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;script src="./index.js"&gt;&lt;/script&gt; &lt;/body&gt;&lt;/html&gt; 1234// index.jsimport("@tian0o0/hello_wasm").then(module =&gt; &#123; module.greet("world");&#125;); å‰ç«¯ä»£ç å†™å¥½åŽï¼š12npm installnpm run dev æ‰“å¼€localhost:8080, çœ‹åˆ°å¼¹æ¡†æç¤ºHello, worldï¼Œè¯´æ˜Žå·²ç»æˆåŠŸäº†ã€‚ rust-webpack-templateå‰é¢æˆ‘ä»¬é€šè¿‡ä¸€ç³»åˆ—æ“ä½œå°†rustç¼–è¯‘æˆwasmå†å‘å¸ƒåˆ°npmæ‰èƒ½ä½¿ç”¨ï¼Œååˆ†ä¸æ–¹ä¾¿ï¼Œè¿˜å¥½rustwasmå®˜æ–¹ä¸ºæˆ‘ä»¬æä¾›äº†rust-webpack-template 1. è¿è¡Œä¸‹é¢å‘½ä»¤æ‹‰å–æ¨¡æ¿1npm init rust-webpack your_app_name è¯¥é¡¹ç›®çš„åˆå§‹ç»“æž„å¦‚ä¸‹ï¼š123456789101112131415â”œâ”€â”€ LICENSE-APACHEâ”œâ”€â”€ LICENSE-MITâ”œâ”€â”€ README.mdâ”œâ”€â”€ crateâ”‚ â”œâ”€â”€ Cargo.lockâ”‚ â”œâ”€â”€ Cargo.tomlâ”‚ â”œâ”€â”€ pkgâ”‚ â”œâ”€â”€ srcâ”‚ â””â”€â”€ targetâ”œâ”€â”€ index.htmlâ”œâ”€â”€ jsâ”‚ â””â”€â”€ index.jsâ”œâ”€â”€ package-lock.jsonâ”œâ”€â”€ package.jsonâ””â”€â”€ webpack.config.js æ‰§è¡Œ npm run buildå°†ç”Ÿäº§distç›®å½•ï¼š12345â”œâ”€â”€ distâ”‚ â”œâ”€â”€ 1.bundle.jsâ”‚ â”œâ”€â”€ 362e0215e53c5653c642.module.wasmâ”‚ â”œâ”€â”€ bundle.jsâ”‚ â””â”€â”€ index.html æ‰§è¡Œnpm startå°†é€šè¿‡webpack-dev-serverå¼€å¯æœ¬åœ°æœåŠ¡ï¼Œä¿®æ”¹srcä¸‹çš„rustä»£ç ï¼Œä¹Ÿå¯ä»¥èŽ·å¾—çƒ­æ›´æ–°çš„æ•ˆæžœï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆçŽ‡ã€‚ æ€»ç»“æœ¬æ–‡æ‰€åšçš„äº‹æƒ…ååˆ†ç®€å•ï¼Œäº‹å®žä¸Šï¼Œç›®å‰wasmé€‚ç”¨çš„åœºæ™¯å¹¶ä¸å¤šï¼Œæ¯”å¦‚ï¼šå›¾åƒå¤„ç†ã€éŸ³è§†é¢‘å¤„ç†ã€h5æ¸¸æˆç­‰éœ€è¦åœ¨å‰ç«¯è¿›è¡Œå¤æ‚è¿ç®—çš„åœºæ™¯ï¼Œå¸Œæœ›ä»¥åŽèƒ½æœ‰æœºä¼šåœ¨é¡¹ç›®ä¸­å®žæˆ˜ã€‚]]></content>
      <categories>
        <category>wasm</category>
      </categories>
      <tags>
        <tag>rust</tag>
        <tag>wasm</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åšä¸€ä¸ªchromeæ‰©å±•å§]]></title>
    <url>%2F2019%2F03%2F20%2Fchrome-extension%2F</url>
    <content type="text"><![CDATA[TO DOè¿˜æ²¡æœ‰å¥½çš„ç‚¹å­]]></content>
      <categories>
        <category>æ‚è°ˆ</category>
      </categories>
      <tags>
        <tag>chrome</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[webpackä¼˜åŒ–ä¹‹é“]]></title>
    <url>%2F2018%2F10%2F25%2Fwebpack%2F</url>
    <content type="text"><![CDATA[ä¼˜åŒ–1.ç¼©å°æ–‡ä»¶æœç´¢èŒƒå›´1.1ä¼˜åŒ–loaderé…ç½® ç”±äºŽ Loader å¯¹æ–‡ä»¶çš„è½¬æ¢æ“ä½œå¾ˆè€—æ—¶ï¼Œæ‰€ä»¥éœ€è¦è®©å°½å¯èƒ½å°‘çš„æ–‡ä»¶è¢« Loader ç†ã€‚ é€šè¿‡testã€includeã€excludeåŽ»ç¡®å®šå“ªäº›æ–‡ä»¶éœ€è¦è¢«å¤„ç†123456789101112//ä»¥babel-loaderä¸ºä¾‹ï¼šmodule.exports = &#123; module: &#123; rules: [ &#123; test: /.js$/, use: ['babel-loader?cacheDirectory'], include: path.resolve(__dirname, 'src') &#125; ] &#125;&#125; 1.2ä¼˜åŒ–resolve.modulesé…ç½® resolve.modulesç”¨äºŽé…ç½®webpackåŽ»å“ªäº›ç›®å½•å¯»æ‰¾ä¸‰æ–¹æ¨¡å— é»˜è®¤å€¼ä¸ºï¼š[â€˜node_modules]ã€‚ å«ä¹‰æ˜¯å…ˆåŽ»å½“å‰ç›®å½•çš„ node_modules ç›®å½•ä¸‹åŽ»æ‰¾æˆ‘ä»¬æƒ³æ‰¾çš„æ¨¡å—ï¼Œå¦‚æžœæ²¡æ‰¾åˆ° å°±åŽ»ä¸Šä¸€çº§ç›®å½•./node_modulesä¸­æ‰¾ï¼Œå†æ²¡æœ‰å°±åŽ» ../../node_modules ä¸­æ‰¾ï¼Œä»¥æ­¤ç±»æŽ¨ è¿™å’Œ node.js çš„æ¨¡å—å¯»æ‰¾æœºåˆ¶å¾ˆç›¸ä¼¼ã€‚ å½“å®‰è£… çš„ç¬¬ä¸‰æ–¹æ¨¡å—éƒ½æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ node modules ç›®å½•ä¸‹æ—¶ï¼Œå°±æ²¡æœ‰å¿…è¦æŒ‰ç…§é»˜è®¤ çš„æ–¹å¼åŽ»ä¸€å±‚å±‚åœ°å¯»æ‰¾ï¼Œå¯ä»¥æŒ‡æ˜Žå­˜æ”¾ç¬¬ä¸‰æ–¹æ¨¡å—çš„ç»å¯¹è·¯å¾„ï¼Œä»¥å‡å°‘å¯»æ‰¾12345module.exports = &#123; resolve: &#123; modules: [path.resolve(__dirname, 'node_modules')] &#125;&#125; 1.3ä¼˜åŒ–resolve.mainFieldé…ç½® åœ¨å®‰è£…çš„ç¬¬ä¸‰æ–¹æ¨¡å—ä¸­éƒ½ä¼šæœ‰ä¸€ä¸ª package.json æ–‡ä»¶ï¼Œç”¨äºŽæè¿°è¿™ä¸ªæ¨¡å—çš„å±žæ€§å…¶ä¸­çš„æŸäº›å­—æ®µç”¨äºŽæè¿°å…¥å£æ–‡ä»¶åœ¨å“ªé‡Œï¼Œ resolve.mainFieldsç”¨äºŽé…ç½®é‡‡ç”¨å“ªä¸ªå­—æ®µä½œä¸ºå…¥å£æ–‡ä»¶çš„æè¿° å¯ä»¥å­˜åœ¨å¤šä¸ªå­—æ®µæè¿°å…¥å£æ–‡ä»¶çš„åŽŸå› æ˜¯ï¼ŒæŸäº›æ¨¡å—å¯ä»¥åŒæ—¶ç”¨äºŽå¤šä¸ªçŽ¯å¢ƒä¸­ï¼Œé’ˆå¯¹ä¸åŒçš„è¿è¡ŒçŽ¯å¢ƒéœ€è¦ä½¿ç”¨ä¸åŒçš„ä»£ç ã€‚ä»¥ isomorphic-fetch ( https://github.corn/matthewandrews/isomorphic-fetchï¼‰ä¸ºä¾‹ï¼Œå®ƒæ˜¯ fetch API ( https://developer.mozilla.org/zh-CN/docs/Web/APl/Fetch_API) çš„ä¸€ä¸ªå®žçŽ°ï¼Œä½†å¯åŒæ—¶ç”¨äºŽæµè§ˆå™¨å’Œ Node.js çŽ¯å¢ƒ åœ¨å®ƒçš„ package. jsoÎ·ä¸­å°±æœ‰ä¸¤ä¸ªå…¥å£æ–‡ä»¶æè¿°å­—æ®µï¼š1234&#123;"browser":â€fetch-npm-browserify.jsâ€,"main":â€fetch-npm-node.js â€&#125; isomo hic-fetch åœ¨ä¸åŒçš„è¿è¡ŒçŽ¯å¢ƒä¸‹ä½¿ç”¨ä¸åŒçš„ä»£ç ï¼Œæ˜¯å› ä¸º fetch API çš„å®žçŽ°æœºåˆ¶ä¸æ ·ï¼Œåœ¨æµè§ˆå™¨ä¸­é€šè¿‡åŽŸç”Ÿçš„ fetch æˆ–è€… XMLHttpRequest å®žçŽ°ï¼Œåœ¨ Node. j é€šè¿‡http æ¨¡å—å®žçŽ°ã€‚ resolve.mainFields çš„é»˜è®¤å€¼å’Œå½“å‰çš„ target é…ç½®æœ‰å…³ç³»ï¼Œå¯¹åº”çš„å…³ç³»å¦‚ä¸‹ã€‚ target web æˆ–è€… webworker æ—¶ï¼Œå€¼æ˜¯ï¼»â€browser â€ï¼Œâ€ module â€ï¼Œâ€ma in ï¼½ã€‚ target ä¸ºå…¶ä»–æƒ…å†µæ—¶ï¼Œå€¼æ˜¯ï¼» â€œmodule â€ï¼Œâ€main â€ï¼½ã€‚ ä»¥target ç­‰äºŽ web ä¸ºä¾‹ï¼Œ Webpack ä¼šå…ˆé‡‡ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—ä¸­çš„ browser å®‡æ®µåŽ»å¯»æ‰¾æ¨¡å—çš„å…¥å£ æ–‡ä»¶ï¼Œå¦‚æžœä¸å­˜åœ¨ï¼Œå°±é‡‡ç”¨ module å­—æ®µï¼Œä»¥æ­¤ç±»æŽ¨ã€‚ä¸ºäº†å‡å°‘æœç´¢æ­¥éª¤ï¼Œåœ¨æ˜Žç¡®ç¬¬ æ–¹æ¨¡å—çš„å…¥å£æ–‡ä»¶æè¿°å­—æ®µæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†å®ƒè®¾ç½®å¾—å°½é‡å°‘ã€‚ ç”±äºŽå¤§å¤šæ•°ç¬¬ä¸‰æ–¹æ¨¡å—éƒ½é‡‡ç”¨ main å®‡æ®µåŽ»æè¿°å…¥å£æ–‡ä»¶çš„ä½ç½®ï¼Œæ‰€ä»¥å¯ä»¥è¿™æ ·é…ç½®:12345module.exports = &#123; resolve: &#123; mainFields: ['main'] &#125;&#125; 1.4ä¼˜åŒ–resolve.alias åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œ Webpack ä¼šä»Žå…¥å£æ–‡ä»¶./node_modules/vue/dist/vue.jså¼€å§‹é€’å½’è§£æžå’Œå¤„ç†ä¾èµ–çš„å‡ åä¸ªæ–‡ä»¶ï¼Œè¿™ä¼šæ˜¯ä¸€ä¸ªå¾ˆè€—æ—¶çš„æ“ä½œ é€šè¿‡é…ç½® resolve. alias,å¯ä»¥è®© Webpack åœ¨å¤„ç† vue æ—¶ï¼Œç›´æŽ¥ä½¿ç”¨å•ç‹¬ã€å®Œæ•´çš„ vue.esm.js æ–‡ä»¶ ï¼Œä»Žè€Œè·³è¿‡è€—æ—¶çš„é€’å½’è§£æžæ“ä½œ1234567module.exports = &#123; resolve: &#123; alias: &#123; 'vue$': path.resolve(__dirname, './node_modules/vue/dist/vue.runtime.esm.js') &#125; &#125;&#125; ä½†æ˜¯ï¼Œå¯¹æŸäº›åº“ä½¿ç”¨æœ¬ä¼˜åŒ–æ–¹æ³•åŽï¼Œä¼šå½±å“åˆ°åŽé¢è¦è®²çš„ä½¿ç”¨ Tree-Sharking åŽ»é™¤æ— æ•ˆä»£ç çš„ä¼˜åŒ–ï¼Œå› ä¸ºæ‰“åŒ…å¥½çš„å®Œæ•´æ–‡ä»¶ä¸­æœ‰éƒ¨åˆ†ä»£ç åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­å¯èƒ½æ°¸è¿œç”¨ä¸ä¸Šã€‚ä¸€èˆ¬å¯¹æ•´ä½“æ€§æ¯”è¾ƒå¼ºçš„åº“é‡‡ç”¨æœ¬æ–¹æ³•ä¼˜åŒ–ï¼Œå› ä¸ºå®Œæ•´æ–‡ä»¶ä¸­çš„ä»£ç æ˜¯ ä¸ªæ•´ä½“ï¼Œæ¯ è¡Œéƒ½æ˜¯ä¸å¯æˆ–ç¼ºçš„ ä½†æ˜¯å¯¹äºŽ äº›å·¥å…·ç±»çš„åº“å¦‚ lodash ï¼Œæˆ‘ä»¬çš„é¡¹ç›®ä¸­å¯èƒ½åªç”¨åˆ°äº†å…¶ä¸­å‡ ä¸ªå·¥å…·å‡½æ•°ï¼Œå°±ä¸èƒ½ä½¿ç”¨æœ¬æ–¹æ³•åŽ»ä¼˜åŒ–äº†ï¼Œå› ä¸ºè¿™ä¼šå¯¼è‡´åœ¨æˆ‘ä»¬ çš„è¾“å‡ºä»£ç ä¸­åŒ…å«å¾ˆå¤šæ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œçš„ä»£ç ã€‚ 1.5ä¼˜åŒ–resolve.extensionsä¾‹å¦‚ï¼š1extensions :[â€™ .js â€™,â€™.json â€™] ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“é‡åˆ° require ( â€˜. /data â€™ï¼‰ è¿™æ ·çš„å¯¼å…¥è¯­å¥ webpack ä¼šå…ˆåŽ»å¯»æ‰¾.ï¼ data.js æ–‡ä»¶ï¼Œå¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°±åŽ»å¯»æ‰¾ data.json æ–‡ä»¶ï¼Œå¦‚æžœè¿˜æ˜¯æ‰¾ä¸åˆ°å°±æŠ¥é”™ã€‚ å¦‚æžœè¿™ä¸ªåˆ—è¡¨è¶Šé•¿ï¼Œæˆ–è€…æ­£ç¡®çš„åŽç¼€è¶Šå¾€åŽï¼Œå°±ä¼šé€ æˆå°è¯•çš„æ¬¡æ•°è¶Šå¤šï¼Œæ‰€ä»¥resolve .extensions çš„é…ç½®ä¹Ÿä¼šå½±å“åˆ°æž„å»ºçš„æ€§èƒ½ åœ¨é…ç½® resolve.extensionsæ—¶éœ€è¦éµå®ˆ ä»¥ä¸‹å‡ ç‚¹ï¼Œä»¥åšåˆ°å°½å¯èƒ½åœ°ä¼˜åŒ–æž„å»ºæ€§èƒ½ã€‚ åŽç¼€å°è¯•åˆ—è¡¨è¦å°½å¯èƒ½å°ï¼Œä¸è¦å°†é¡¹ç›®ä¸­ä¸å¯èƒ½å­˜åœ¨çš„æƒ…å†µå†™åˆ°åŽç¼€å°è¯•åˆ—è¡¨ä¸­ã€‚ é¢‘çŽ‡å‡ºçŽ°æœ€é«˜çš„æ–‡ä»¶åŽç¼€è¦ä¼˜å…ˆæ”¾åœ¨æœ€å‰é¢ï¼Œä»¥åšåˆ°å°½å¿«é€€å‡ºå¯»æ‰¾è¿‡ç¨‹ã€‚ åœ¨æºç ä¸­å†™å¯¼å…¥è¯­å¥æ—¶ï¼Œè¦å°½å¯èƒ½å¸¦ä¸ŠåŽç¼€ ä»Žè€Œå¯ä»¥é¿å…å¯»æ‰¾è¿‡ç¨‹ã€‚ä¾‹å¦‚åœ¨ç¡®å®šçš„æƒ…å†µä¸‹å°† require ( â€™. /data â€™ï¼‰ å†™æˆ require ï¼ˆâ€™. data.jsonâ€™ï¼‰ 1.6ä¼˜åŒ–module.noParse module.noParse é…ç½®é¡¹å¯ Webpack å¿½ç•¥å¯¹éƒ¨åˆ†æ²¡é‡‡ç”¨æ¨¡å—åŒ–çš„æ–‡ä»¶çš„é€’å½’è§£æžå¤„ç†ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯èƒ½æé«˜æž„å»ºæ€§èƒ½ã€‚åŽŸå› æ˜¯ä¸€äº›åº“å¦‚ jQueryåºžå¤§åˆæ²¡æœ‰é‡‡ç”¨æ¨¡å—åŒ–æ ‡å‡†ï¼Œè®© Webpack è§£æžè¿™äº›æ–‡ä»¶æ—¢è€—æ—¶åˆæ²¡æœ‰æ„ä¹‰ã€‚ åœ¨å‰é¢è®²è§£ä¼˜åŒ– resolve.alias é…ç½®æ—¶è®²åˆ°ï¼Œå•ç‹¬ã€å®Œæ•´çš„ vue.esm.js æ–‡ä»¶æ²¡æœ‰é‡‡ç”¨æ¨¡å—åŒ–ï¼Œè®©æˆ‘ä»¬é€šè¿‡é…ç½® module.noParse å¿½ç•¥å¯¹å®ƒçš„é€’å½’è§£æžå¤„ç†ï¼Œç›¸å…³çš„ Webpack é…ç½®å¦‚ä¸‹ï¼š12345module.exports = &#123; module: &#123; noParse: [/vue\.runtime\.esm\.js$/] &#125;&#125; 2.ä½¿ç”¨DllPluginä¸ºwebé¡¹ç›®æŽ¥å…¥åŠ¨æ€é“¾æŽ¥åº“ï¼ˆdllï¼‰ 1.å°†ç½‘é¡µä¾èµ–çš„åŸºç¡€æ¨¡å—æŠ½ç¦»å‡ºæ¥ï¼Œæ‰“åŒ…åˆ°ä¸€ä¸ªä¸ªå•ç‹¬çš„åŠ¨æ€é“¾æŽ¥åº“ä¸­ ã€‚åœ¨ä¸€ä¸ªåŠ¨æ€é“¾æŽ¥åº“ä¸­å¯ä»¥åŒ…å«å¤šä¸ªæ¨¡å—ã€‚ 2.å½“éœ€è¦å¯¼å…¥çš„æ¨¡å—å­˜åœ¨äºŽæŸä¸ªåŠ¨æ€é“¾æŽ¥åº“ ä¸­æ—¶ï¼Œè¿™ä¸ªæ¨¡å—ä¸èƒ½è¢«å†æ¬¡æ‰“åŒ…ï¼Œè€Œæ˜¯åŽ»åŠ¨æ€é“¾æŽ¥åº“ä¸­èŽ·å–ã€‚ 3ç”±äºŽåŠ¨æ€é“¾æŽ¥åº“ä¸­å¤§å¤šæ•°åŒ…å«çš„æ˜¯å¸¸ç”¨çš„ç¬¬ æ–¹æ¨¡å—ï¼Œä¾‹å¦‚ vueã€vue-router ï¼Œæ‰€ä»¥åªè¦ä¸å‡çº§è¿™äº›æ¨¡å—çš„ç‰ˆæœ¬ï¼ŒåŠ¨æ€é“¾æŽ¥åº“å°±ä¸ç”¨é‡æ–°ç¼–è¯‘ã€‚ åœ¨webpackä¸­ï¼Œé€šè¿‡ä»¥ä¸‹ä¸¤ä¸ªæ’ä»¶å®žçŽ°dllï¼š DllPlugin: ç”¨äºŽæ‰“åŒ…å‡ºä¸€ä¸ªä¸ªå•ç‹¬çš„åŠ¨æ€é“¾æŽ¥åº“æ–‡ä»¶ DllReferencePlugin: ç”¨äºŽåœ¨ä¸»è¦çš„é…ç½®æ–‡ä»¶ä¸­å¼•å…¥ DllPlugin æ’ä»¶æ‰“åŒ…å¥½çš„åŠ¨æ€é“¾æŽ¥åº“æ–‡ä»¶ã€‚ å®žçŽ°è¿‡ç¨‹ï¼š 1ã€åŠ¨æ€é“¾æŽ¥åº“æ–‡ä»¶ç›¸å…³çš„æ–‡ä»¶éœ€è¦ç”± ä»½ç‹¬ç«‹çš„æž„å»ºè¾“å‡ºï¼Œç”¨äºŽä¸ºä¸»æž„å»ºä½¿ç”¨ã€‚æ–°å»ºwebpack.dll.conf.js12345678910111213141516171819202122232425262728293031const path = require('path')const DllPlugin = require('webpack/lib/DllPlugin')function resolve(dir) &#123; return path.join(__dirname, '..', dir)&#125;module.exports = &#123; entry: &#123; vue: ['vue/dist/vue.runtime.esm.js', 'vue-router', 'vuex'], // vant: ['vant'] &#125;, output: &#123; path: resolve('dist'), filename: '[name].dll.js', // å­˜æ”¾åŠ¨æ€é“¾æŽ¥åº“çš„å…¨å±€å˜é‡åç§°ï¼Œ_dll_vue library: '_dll_[name]' &#125;, plugins: [ new DllPlugin(&#123; /* *åŠ¨æ€é“¾æŽ¥åº“çš„å…¨å±€å˜é‡åç§°ï¼Œéœ€è¦å’Œ output.library ä¸­çš„ä¿æŒä¸€è‡´ *è¯¥å­—æ®µçš„å€¼ä¹Ÿå°±æ˜¯è¾“å‡ºçš„ manifest json æ–‡ä»¶ä¸­ name å­—æ®µçš„å€¼ *ä¾‹å¦‚åœ¨ react.manifest json ä¸­å°±æœ‰ â€nameâ€œï¼šâ€_dll_vue" */ name: '_dll_[name]', //æè¿°åŠ¨æ€é“¾æŽ¥åº“çš„ manifest json æ–‡ä»¶è¾“å‡ºæ—¶çš„è·¯å¾„ä»¥åŠæ–‡ä»¶åç§° path: resolve('dist/[name].manifest.json'), context: __dirname &#125;) ]&#125; 2ã€æ ¹æ®webpack.dll.conf.jsæž„å»ºåŠ¨æ€é“¾æŽ¥åº“æ–‡ä»¶åŠå…¶æè¿°æ–‡ä»¶ã€‚åˆ›å»ºbuild.dll.js123456789101112131415161718192021222324252627282930313233343536373839'use strict'require('./check-versions')()process.env.NODE_ENV = 'production'const ora = require('ora')const rm = require('rimraf')const path = require('path')const chalk = require('chalk')const webpack = require('webpack')const config = require('../config')const webpackConfig = require('./webpack.dll.conf')const spinner = ora('building for dll...')spinner.start()// rm(path.join(config.build.assetsRoot, config.build.assetsSubDirectory), err =&gt; &#123;// if (err) throw err // &#125;)webpack(webpackConfig, function (err, stats) &#123; spinner.stop() if (err) throw err process.stdout.write(stats.toString(&#123; colors: true, modules: false, children: false, chunks: false, chunkModules: false &#125;) + '\n\n') if (stats.hasErrors()) &#123; console.log(chalk.red(' Build failed with errors.\n')) process.exit(1) &#125; console.log(chalk.cyan(' Build complete.\n')) &#125;) è¿™æ­¥ä»¥åŽä¼šåœ¨distç›®å½•ä¸‹äº§ç”Ÿï¼š vue.dll.js vue.manifest.json (æè¿°vue.dll.jsä¸­åŒ…å«å“ªäº›æ¨¡å—) 3ã€ä¿®æ”¹webpack.prod.conf.jsï¼ŒåŠ å…¥DllReferencePlugin1234567891011const DllReferencePlugin = require('webpack/lib/DllReferencePlugin')//å‘Š Webpack ä½¿ç”¨äº†å“ªäº›åŠ¨æ€é“¾æŽ¥åº“new DllReferencePlugin(&#123;// æè¿°vueåŠ¨æ€é“¾æŽ¥åº“çš„æ–‡ä»¶å†…å®¹ manifest: require('../dist/vue.manifest.json'), context: __dirname&#125;),//å¦‚æžœæœ‰å¤šä¸ªåŠ¨æ€é“¾æŽ¥åº“æ–‡ä»¶// new DllReferencePlugin(&#123;// manifest: ...// &#125;), 4ã€åœ¨æ ¹ç›®å½•index.htmlä¸­å¼•å…¥vue.dll.js12345&lt;body&gt; &lt;div id="app"&gt;&lt;/div&gt; &lt;!-- built files will be auto injected --&gt; &lt;script src="./vue.dll.js"&gt;&lt;/script&gt;&lt;/body&gt; 5ã€npm run buildæ‰§è¡Œæž„å»ºï¼Œå¯ä»¥å‘çŽ°æž„å»ºé€Ÿåº¦æœ‰äº†æ˜Žæ˜¾çš„æå‡ 3.Tree Shaking è¦è®© Tree Shaking æ­£å¸¸å·¥ä½œçš„å‰ææ˜¯ï¼Œæäº¤ç»™ Webpack JavaScript ä»£ç å¿…é¡»é‡‡ç”¨äº† ES6 çš„æ¨¡å—åŒ–è¯­æ³•ã€‚ å› ä¸º ES6 æ¨¡å—åŒ–è¯­æ³•æ˜¯é™æ€çš„ï¼ˆåœ¨å¯¼å…¥ã€å¯¼å‡ºè¯­å¥ä¸­çš„è·¯å¾„æ˜¯é™æ€çš„å­—ç¬¦ä¸²ï¼Œè€Œä¸”ä¸èƒ½æ”¾å…¥å…¶ä»–ä»£ç å—ä¸­ï¼‰ï¼Œè¿™è®© Webpack å¯ä»¥ç®€å•åœ°åˆ†æžå‡ºå“ªäº›expo rt çš„è¢« import äº†ã€‚å¦‚æžœé‡‡ç”¨äº† S5 ä¸­çš„æ¨¡å—åŒ–ï¼Œä¾‹å¦‚ module.export={ â€¦ ï½ã€require (x+y ï¼‰ã€ if (x) {require ï¼ˆâ€™.ï¼ util â€™ï¼‰ï½ï¼Œåˆ™ Webpack æ— æ³•åˆ†æžå‡ºå¯ä»¥å‰”é™¤å“ªäº›ä»£ç  å®žçŽ°è¿‡ç¨‹: 1. ä¿®æ”¹.babelrc1234567&#123;"presets": [ ["env", &#123; "modules": false //å…³é—­ babel çš„æ¨¡å—è½¬æ¢åŠŸèƒ½ï¼Œä¿ç•™åŽŸæœ¬çš„ ES6è¯­æ³•ã€‚ &#125;] ]&#125; 2. ä»¥lodashåº“ä¸ºä¾‹ å¾€å¾€æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä½¿ç”¨lodashåªä¼šç”¨åˆ°å…¶æä¾›éƒ¨åˆ†æ–¹æ³•ï¼Œå¦‚æžœæˆ‘ä»¬è¦tree shaking lodashï¼Œåº”è¯¥å®‰è£…lodash-esè€Œä¸æ˜¯lodashï¼Œå› ä¸ºlodashåº“æœ¬èº«æ˜¯commonjsçš„æ¨¡å—ï¼Œä¸æ”¯æŒtree shaking.åŒæ—¶æƒ³è¦ä½¿tree shakingç”Ÿæ•ˆï¼Œè¿˜éœ€è¦ä¸¤ä¸ªæ’ä»¶ï¼š babel-plugin-lodash lodash-webpack-plugin 12345// webpack.prod.conf.jsconst LodashModuleReplacementPlugin = require('lodash-webpack-plugin');plugins: [ new LodashModuleReplacementPlugin()] åœ¨importæ—¶:12// import _ from 'lodash-es'import &#123; chunk &#125; from 'lodash-es' è¿™æ ·ä¸€æ¥åœ¨æž„å»ºä»¥åŽlodashå°±shakingåˆ°æ— å½±æ— è¸ªäº† 2. ä»¥vantç»„ä»¶åº“ä¸ºä¾‹æŸ¥çœ‹vantçš„package.json,å‘çŽ°ï¼š12"main": "lib/index.js", //commonjs"module": "es/index.js", //esm åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¤§é‡çš„ç¬¬ æ–¹åº“æ—¶ï¼Œæˆ‘ä»¬ä¼šå‘çŽ° Tree Shaking ä¼¼ä¹Žä¸ç”Ÿæ•ˆäº†ï¼ŒåŽŸå› æ˜¯å¤§éƒ¨åˆ†Npm ä¸­çš„ä»£ç éƒ½é‡‡ç”¨äº† CommonJS è¯­æ³•ï¼Œè¿™å¯¼è‡´ Tree shaking æ— æ³•æ­£å¸¸å·¥ä½œè€Œé™çº§å¤„ç†ã€‚ä½†å¹¸è¿çš„æ˜¯ï¼Œæœ‰äº›åº“è€ƒè™‘åˆ°äº†è¿™ ç‚¹ï¼Œè¿™äº›åº“åœ¨å‘å¸ƒåˆ° Npm ä¸Šæ—¶ä¼šåŒæ—¶æä¾›ä¸¤ä»½ä»£ç ï¼Œä¸€ä»½é‡‡ CommonJs æ¨¡å—åŒ–è¯­æ³•ï¼Œä¸€ä»½é‡‡ç”¨ ES6 æ¨¡å—åŒ–è¯­æ³•ã€‚å¹¶ä¸”åœ¨ package json æ–‡ä»¶ä¸­åˆ«æŒ‡å‡ºè¿™ä¸¤ä»½ä»£ç çš„å…¥å£ã€‚ ä¹‹å‰ä»‹ç»è¿‡ mainFields ç”¨äºŽé…ç½®é‡‡ç”¨å“ªä¸ªå­—æ®µä½œä¸ºæ¨¡å—çš„å…¥å£æè¿°ã€‚ä¸ºäº†Tree Shaking vant ç”Ÿæ•ˆï¼Œéœ€è¦é…ç½® Webpack çš„æ–‡ä»¶å¯»æ‰¾è§„ å¦‚ä¸‹:12345module.exports= &#123; resolve: &#123; mainFields: ['module', 'main', 'browser'] &#125;&#125; ä»¥ä¸Šé…ç½®çš„å«ä¹‰æ˜¯ä¼˜å…ˆä½¿ç”¨ module ä½œä¸ºå…¥å£ï¼Œå¦‚æžœä¸å­˜åœ¨ï¼Œå°±ä¼šé‡‡ç”¨ browser æˆ–è€… main å¹¶å°†å…¶ä½œä¸ºå…¥å£ ç¤¾åŒºçº¦å®šï¼šç”¨ jsnext:main ä½œä¸º ES6 æ¨¡å—åŒ–ä»£ç çš„å…¥å£ è¦å®žçŽ°æŒ‰éœ€å¯¼å…¥vantç»„ä»¶ï¼Œéœ€è¦ä¸€ä¸ªæ’ä»¶ï¼šbabel-plugin-importï¼ŒåŒæ—¶ä¿®æ”¹.babelrc:123456789&#123; "plugins": [ ["import": &#123; "libraryName": "vant", "libraryDirectory": "es", "style": true &#125;] ]&#125; è¿™æ ·ï¼ŒbuildåŽä¹Ÿèƒ½å¤ŸæŠŠvant tree shaking 4. ä½¿ç”¨ Scope Hoisting scope hoistingå‡å°ä»£ç æ‰“åŒ…åŽçš„ä½“ç§¯ï¼Œå¹¶ä¸”å‡å°‘å‡½æ•°ä½œç”¨åŸŸï¼Œå‡å°å¼€é”€(ç›®å‰æˆ‘æ„Ÿè§‰å¹¶æ²¡æœ‰èµ·ä½œç”¨ã€‚ã€‚ã€‚) new webpack.optimize.ModuleConcatenationPlugin(), å’Œtree shakingä¸€æ ·ï¼ŒScope Hoisting ä¾èµ–æºç æ—¶ éœ€é‡‡ç”¨ S6 æ¨¡å—åŒ–è¯­æ³•ï¼Œè¿˜éœ€è¦é…ç½®mainFields 5. ä½¿ç”¨compression-webpack-pluginå¼€å¯gzip åˆ©ç”¨è¯¥æ’ä»¶ç”Ÿæˆ.gzæ–‡ä»¶ï¼Œåœ¨æœåŠ¡å™¨å¼€å¯gzipçš„æƒ…å†µä¸‹ï¼Œä¼šä¼˜å…ˆè¿”å›ž.gzæ–‡ä»¶ ä»¥vue-cliä¸ºä¾‹ï¼š åœ¨config/index.jsä¸­ï¼š123456// Gzip off by default as many popular static hosts such as// Surge or Netlify already gzip all static assets for you.// Before setting to `true`, make sure to:// npm install --save-dev compression-webpack-pluginproductionGzip: true,productionGzipExtensions: ['js', 'css', 'png'], //ä½ æƒ³è¦gzipçš„æ–‡ä»¶ç±»åž‹ åœ¨webpack.prod.conf.jsä¸­å·²ç»æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š123456789101112131415if (config.build.productionGzip) &#123; const CompressionWebpackPlugin = require('compression-webpack-plugin') webpackConfig.plugins.push( new CompressionWebpackPlugin(&#123; asset: '[path].gz[query]', algorithm: 'gzip', test: new RegExp( '\\.(' + config.build.productionGzipExtensions.join('|') + ')$' ), threshold: 10240, //åªå¤„ç†å¤§äºŽæ­¤å¤§å°(10k)çš„èµ„äº§ã€‚ä»¥byteä¸ºå•ä½ é»˜è®¤ä¸º0ã€‚ minRatio: 0.8 //åªæœ‰åŽ‹ç¼©çŽ‡æ¯”è¿™ä¸ªå€¼å°çš„èµ„æºæ‰ä¼šè¢«å¤„ç† ã€‚é»˜è®¤ä¸º0.8. &#125;) )&#125; åœ¨buildåŽä¼šç”Ÿæˆå¯¹åº”çš„.gzæ–‡ä»¶ å€¼å¾—æ³¨æ„çš„æ˜¯å¹¶ä¸æ˜¯æ‰€æœ‰çš„æ–‡ä»¶éƒ½ä¼šç”Ÿæˆå¯¹åº”çš„gzipæ–‡ä»¶ï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®äº†threshold: 10240å’ŒminRatio: 0.8,æ–‡ä»¶å¤§å°å°äºŽ10kçš„ä¸ä¼šè¢«gzipï¼ŒåŒæ—¶åªæœ‰åŽ‹ç¼©çŽ‡æ¯”0.8å°çš„èµ„æºæ‰ä¼šè¢«å¤„ç†ï¼Œå¦åˆ™æ¯”èµ·ç›´æŽ¥ä½¿ç”¨æ²¡æœ‰gzipçš„æ–‡ä»¶ï¼Œæµè§ˆå™¨ä¼šèŠ±æ›´å¤šçš„æ—¶é—´ç”¨æ¥unzipè¿™äº›æ–‡ä»¶ï¼Œå¾—ä¸å¿å¤± æœªå®Œå¾…ç»­Â·Â·Â·]]></content>
      <categories>
        <category>Webpack</category>
      </categories>
      <tags>
        <tag>webpack4</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ€»ç»“ä¸€ä¸‹jsé‡Œæ“ä½œæ•°ç»„çš„æ–¹æ³•å§...]]></title>
    <url>%2F2018%2F07%2F05%2Farray%2F</url>
    <content type="text"><![CDATA[æ•°ç»„çš„æ ˆæ–¹æ³•å’Œé˜Ÿåˆ—æ–¹æ³•123456789101112131415let arr = [1,2,3,4,5];//--æ ˆæ–¹æ³•//push(a,b,..,z)æ–¹æ³•åœ¨æ•°ç»„æœ€åŽé¢è¿½åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œè¿”å›žä¿®æ”¹åŽæ•°ç»„çš„é•¿åº¦(6)arr.push(6);//æ­¤æ—¶æ•°ç»„ä¸º[1,2,3,4,5,6]//pop()æ–¹æ³•ï¼Œè¿”å›žå¹¶ç§»é™¤æ•°ç»„ä¸­çš„æœ€åŽä¸€ä¸ªå…ƒç´ çš„å€¼(6)arr.pop();//æ­¤æ—¶æ•°ç»„ä¸º[1,2,3,4,5]//--é˜Ÿåˆ—æ–¹æ³•//shift()æ–¹æ³•ï¼Œè¿”å›žå¹¶ç§»é™¤æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„å€¼(1)arr.shift();//æ­¤æ—¶æ•°ç»„ä¸º[2,3,4,5]//unshift(a,b,...,z)æ–¹æ³•åœ¨æ•°ç»„æœ€å‰é¢è¿½åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼Œè¿”å›žä¿®æ”¹åŽæ•°ç»„çš„é•¿åº¦(5)arr.unshift(6);//æ­¤æ—¶æ•°ç»„ä¸º[6,2,3,4,5] é‡æŽ’åºæ–¹æ³• reverse() sort() æ­£æ˜¯ç”±äºŽreverse()ä¸å¤Ÿçµæ´»ï¼Œæ‰€ä»¥å‡ºçŽ°äº†sort()ï¼Œä»–ä»¬å‡è¿”å›žé‡æ–°æŽ’åºåŽçš„æ•°ç»„ æ“ä½œæ–¹æ³• slice() //ä¸ä¼šå½±å“åŽŸæ•°ç»„ splice() //å¯ä»¥å¯¹æ•°ç»„è¿›è¡Œåˆ é™¤ã€æ’å…¥ã€æ›¿æ¢ï¼Œè¿”å›žä»ŽåŽŸæ•°ç»„ä¸­åˆ é™¤é¡¹ç»„æˆçš„æ•°ç»„,ä»–ä¼šå½±å“åŽŸæ•°ç»„ ä½ç½®æ–¹æ³• indexOf() lastIndexOf() è¿”å›žè¦æŸ¥æ‰¾é¡¹åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œæ‰¾ä¸åˆ°åˆ™è¿”å›ž-11234const arr = [1,2,3,4,5,4,3,2,1]arr.indexOf(4) //3arr.lastIndexOf(4) // 5arr.indexOf(0) // -1 æ•°ç»„çš„è¿­ä»£å™¨æ–¹æ³•ä¸ç”Ÿæˆæ–°æ•°ç»„çš„è¿­ä»£å™¨æ–¹æ³•123456789101112131415161718192021222324252627282930313233//1ã€forEachæ–¹æ³•ï¼ˆæŽ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼‰const nums = [1,2,3,4,5];nums.forEach(item =&gt; &#123; console.log(item * item)&#125;);//1ï¼Œ4ï¼Œ9ï¼Œ16ï¼Œ25//2ã€everyæ–¹æ³•ï¼ˆæŽ¥æ”¶ä¸€ä¸ªè¿”å›žå€¼ä¸ºå¸ƒå°”å€¼çš„å‡½æ•°ï¼Œå¯¹æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä½¿ç”¨è¯¥å‡½æ•°ï¼‰const evens=[2,4,6,8,10];const isAllEven = evens.every(item =&gt; &#123; return num % 2 === 0;&#125;); //å½“ä¸”ä»…å½“æ•°ç»„ä¸­çš„æ‰€æœ‰çš„å…ƒç´ è¿”å›žä¸ºçœŸï¼Œeveryå‡½æ•°æ‰ä¼šè¿”å›žä¸ºçœŸ//3ã€someæ–¹æ³•ï¼ˆåªè¦æ•°ç»„ä¸­æœ‰ä¸€ä¸ªå…ƒç´ ä½¿ç”¨æ–¹æ³•è¿”å›žä¸ºçœŸï¼Œsomeå‡½æ•°å°±ä¼šè¿”å›žçœŸï¼‰ const nums = [1,2,3,5,7,9]; nums.some(item =&gt; &#123; return num % 2 === 0; &#125;); //true //4.reduceæ–¹æ³• //ç”¨æ³•ä¸€ï¼šä¸ºæ•°ç»„ä¸­çš„å…ƒç´ æ±‚å’Œ function add (currentTotal,currentValue) &#123; return currentTotal+currentValue; &#125; const nums = [1,2,3,4,5]; nums.reduce(add);//15 //ç”¨æ³•äºŒï¼šå°†æ•°ç»„ä¸­çš„å…ƒç´ è¿žæŽ¥æˆä¸€ä¸ªé•¿çš„å­—ç¬¦ä¸² function linkStr (foreStr,currentStr) &#123; return foreStr + currentStr; &#125; const strings = [&quot;xietian&quot;,&quot;is&quot;,&quot;studying&quot;,&quot;javascript&quot;]; strings.reduce(linkStr); ç”Ÿæˆæ–°æ•°ç»„çš„è¿­ä»£å™¨æ–¹æ³•123456789101112131415//1.mapæ–¹æ³•ï¼ˆç±»ä¼¼äºŽä¸ç”Ÿæˆæ–°æ•°ç»„ä¸­çš„forEachæ–¹æ³•ï¼‰ //å–æ•°ç»„ä¸­æ¯ä¸ªå•è¯çš„ç¬¬ä¸€ä¸ªå­—æ¯ const words = [&quot;xietian&quot;,&quot;is&quot;,&quot;studying&quot;,&quot;javascript&quot;]; const firstAlphas = words.map(item =&gt; &#123; return word[0].toUpperCase(); &#125;); firstAlphas.join(&quot;&quot;); //ä½¿ç”¨joinå¯ä»¥åŽ»æŽ‰è¿žæŽ¥æ•°ç»„å…ƒç´ çš„é€—å· //2.filteræ–¹æ³•ï¼ˆç±»ä¼¼äºŽeveryæ–¹æ³•ï¼‰ //ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶ï¼ˆå³è¿”å›žå€¼ä¸ºtrueï¼‰çš„å…ƒç´  const nums=[1,2,4,6,8,10]; const evens = nums.filter(item =&gt; &#123; return num % 2 === 0; &#125;); å½’å¹¶æ–¹æ³• reduce() //ä»Žæ•°ç»„çš„ç¬¬ä¸€é¡¹å¼€å§‹éåŽ† reduceRight() //ä»Žæ•°ç»„çš„æœ€åŽä¸€é¡¹å¼€å§‹éåŽ† ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¿­ä»£æ•°ç»„çš„æ¯ä¸€é¡¹ï¼Œæž„å»ºä¸€ä¸ªæœ€ç»ˆçš„è¿”å›žå€¼ æœªå®Œå¾…ç»­Â·Â·Â·]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>array</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åŽŸç”ŸJavascriptå®žçŽ°å…¨å±æ»šåŠ¨æ•ˆæžœ]]></title>
    <url>%2F2018%2F06%2F18%2F%E5%85%A8%E5%B1%8F%E6%BB%9A%E5%8A%A8%2F</url>
    <content type="text"><![CDATA[åŽŸç†åŽŸç†å¾ˆç®€å•: é€šè¿‡jsè®¾ç½®å¤–å±‚div wrapper(#wrap)çš„é«˜åº¦ä¸ºæµè§ˆå™¨å¯è§†åŒºçš„é«˜åº¦ï¼Œå¹¶è®¾ç½®overflow:hidden; è®¾ç½®å†…å±‚div wrapper(#main)ä¸ºposition:relativeï¼Œç„¶åŽé€šè¿‡æ»šè½®äº‹ä»¶æ”¹å˜å…¶topå€¼ã€‚ HTMLç»“æž„é¦–å…ˆï¼ŒHTMLç»“æž„åº”è¯¥æ»¡è¶³ä¸‹é¢è¦æ±‚ 12345678&lt;div id="wrap"&gt; &lt;div id="main"&gt; &lt;div class="page page1"&gt;1&lt;/div&gt; &lt;div class="page page2"&gt;2&lt;/div&gt; &lt;div class="page page3"&gt;3&lt;/div&gt; &lt;div class="page page4"&gt;4&lt;/div&gt; &lt;/div&gt;&lt;/div&gt; CSS123456789101112131415161718192021222324#wrap &#123; overflow: hidden;&#125;#main &#123; position: relative; transition: all 1000ms ease;&#125;#page1 &#123; background: #E4E6CE;&#125;#page2 &#123; background: #6CE26C;&#125;#page3 &#123; background: #BF4938;&#125;#page4 &#123; background: #2932E1;&#125; æ»šè½®äº‹ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243var pages = document.getElementsByClassName("page");var wrap = document.getElementById("wrap");var main = document.getElementById("main");var len = document.documentElement.clientHeight;wrap.style.height = len + "px";for (var i = 0; i &lt; pages.length; i++) &#123; pages[i].style.height = len + "px";&#125; if (navigator.userAgent.toLowerCase().indexOf("firefox") != -1) &#123;//ç«ç‹ document.addEventListener("DOMMouseScroll", scrollFun); &#125; else if (document.addEventListener) &#123; document.addEventListener("mousewheel", scrollFun, false); &#125; else if (document.attachEvent) &#123;//IE document.attachEvent("onmousewheel", scrollFun); &#125; else &#123; document.onmousewheel = scrollFun; &#125; var startTime = 0; var endTime = 0; var now = 0; function scrollFun(e) &#123; startTime = new Date().getTime(); var event = e || window.event; var dir = event.detail || -event.wheelDelta; // &gt;0 å‘ä¸‹æ»šåŠ¨ //1så†…åªèƒ½æ»šåŠ¨ä¸€å± if (startTime - endTime &gt; 1000) &#123; console.log(startTime - endTime) if (dir &gt; 0 &amp;&amp; now &gt; -3 * len) &#123; now -= len; main.style.top = now + "px"; endTime = new Date().getTime(); &#125; else if (dir &lt; 0 &amp;&amp; now &lt; 0) &#123; now += len; main.style.top = now + "px"; endTime = new Date().getTime(); &#125; &#125; else &#123; console.log(startTime - endTime) event.preventDefault(); &#125; &#125;]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>fullpage</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[vueæœåŠ¡ç«¯æ¸²æŸ“]]></title>
    <url>%2F2018%2F05%2F20%2Fvue-ssr%2F</url>
    <content type="text"><![CDATA[å‰è¨€é‰´äºŽSPAçš„æ˜Žæ˜¾çš„ç¼ºç‚¹ï¼šé¦–å±ç™½å±æ—¶é—´è¾ƒé•¿ä»¥åŠSEOä¸å‹å¥½ï¼Œå› æ­¤åœ¨ä¸Šè¿°éœ€æ±‚ä¸‹ï¼ŒSSRååˆ†æœ‰å¿…è¦ã€‚ æ³¨æ„äº‹é¡¹ ç”±äºŽç”¨ä¾‹å’Œå¹³å° API çš„å·®å¼‚ï¼Œå½“è¿è¡Œåœ¨ä¸åŒçŽ¯å¢ƒä¸­æ—¶ï¼Œæˆ‘ä»¬çš„ä»£ç å°†ä¸ä¼šå®Œå…¨ç›¸åŒ æœåŠ¡å™¨ä¸Šçš„æ•°æ®å“åº” åœ¨çº¯å®¢æˆ·ç«¯åº”ç”¨ç¨‹åº(client-only app)ä¸­ï¼Œæ¯ä¸ªç”¨æˆ·ä¼šåœ¨ä»–ä»¬å„è‡ªçš„æµè§ˆå™¨ä¸­ä½¿ç”¨æ–°çš„åº”ç”¨ç¨‹åºå®žä¾‹ã€‚å¯¹äºŽæœåŠ¡å™¨ç«¯æ¸²æŸ“ï¼Œæˆ‘ä»¬ä¹Ÿå¸Œæœ›å¦‚æ­¤ï¼šæ¯ä¸ªè¯·æ±‚åº”è¯¥éƒ½æ˜¯å…¨æ–°çš„ã€ç‹¬ç«‹çš„åº”ç”¨ç¨‹åºå®žä¾‹ï¼Œä»¥ä¾¿ä¸ä¼šæœ‰äº¤å‰è¯·æ±‚é€ æˆçš„çŠ¶æ€æ±¡æŸ“(cross-request state pollution)ã€‚ å› ä¸ºå®žé™…çš„æ¸²æŸ“è¿‡ç¨‹éœ€è¦ç¡®å®šæ€§ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿå°†åœ¨æœåŠ¡å™¨ä¸Šâ€œé¢„å–â€æ•°æ®(â€œpre-fetchingâ€ data) - è¿™æ„å‘³ç€åœ¨æˆ‘ä»¬å¼€å§‹æ¸²æŸ“æ—¶ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±å·²ç»è§£æžå®Œæˆå…¶çŠ¶æ€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå°†æ•°æ®è¿›è¡Œå“åº”å¼çš„è¿‡ç¨‹åœ¨æœåŠ¡å™¨ä¸Šæ˜¯å¤šä½™çš„ï¼Œæ‰€ä»¥é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨ã€‚ç¦ç”¨å“åº”å¼æ•°æ®ï¼Œè¿˜å¯ä»¥é¿å…å°†ã€Œæ•°æ®ã€è½¬æ¢ä¸ºã€Œå“åº”å¼å¯¹è±¡ã€çš„æ€§èƒ½å¼€é”€ã€‚ ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•° ç”±äºŽæ²¡æœ‰åŠ¨æ€æ›´æ–°ï¼Œæ‰€æœ‰çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸­ï¼Œåªæœ‰ beforeCreate å’Œ created ä¼šåœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“(SSR)è¿‡ç¨‹ä¸­è¢«è°ƒç”¨ã€‚è¿™å°±æ˜¯è¯´ä»»ä½•å…¶ä»–ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸­çš„ä»£ç ï¼ˆä¾‹å¦‚ beforeMount æˆ– mountedï¼‰ï¼Œåªä¼šåœ¨å®¢æˆ·ç«¯æ‰§è¡Œã€‚ æ­¤å¤–è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä½ åº”è¯¥é¿å…åœ¨ beforeCreate å’Œ created ç”Ÿå‘½å‘¨æœŸæ—¶äº§ç”Ÿå…¨å±€å‰¯ä½œç”¨çš„ä»£ç ï¼Œä¾‹å¦‚åœ¨å…¶ä¸­ä½¿ç”¨ setInterval è®¾ç½® timerã€‚åœ¨çº¯å®¢æˆ·ç«¯(client-side only)çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ª timerï¼Œç„¶åŽåœ¨ beforeDestroy æˆ– destroyed ç”Ÿå‘½å‘¨æœŸæ—¶å°†å…¶é”€æ¯ã€‚ä½†æ˜¯ï¼Œç”±äºŽåœ¨ SSR æœŸé—´å¹¶ä¸ä¼šè°ƒç”¨é”€æ¯é’©å­å‡½æ•°ï¼Œæ‰€ä»¥ timer å°†æ°¸è¿œä¿ç•™ä¸‹æ¥ã€‚ä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œè¯·å°†å‰¯ä½œç”¨ä»£ç ç§»åŠ¨åˆ° beforeMount æˆ– mounted ç”Ÿå‘½å‘¨æœŸä¸­ã€‚ è®¿é—®ç‰¹å®šå¹³å°(Platform-Specific) API é€šç”¨ä»£ç ä¸å¯æŽ¥å—ç‰¹å®šå¹³å°çš„ APIï¼Œå› æ­¤å¦‚æžœä½ çš„ä»£ç ä¸­ï¼Œç›´æŽ¥ä½¿ç”¨äº†åƒ window æˆ– documentï¼Œè¿™ç§ä»…æµè§ˆå™¨å¯ç”¨çš„å…¨å±€å˜é‡ï¼Œåˆ™ä¼šåœ¨ Node.js ä¸­æ‰§è¡Œæ—¶æŠ›å‡ºé”™è¯¯ï¼Œåä¹‹ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ å¯¹äºŽå…±äº«äºŽæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ï¼Œä½†ç”¨äºŽä¸åŒå¹³å° API çš„ä»»åŠ¡(task)ï¼Œå»ºè®®å°†å¹³å°ç‰¹å®šå®žçŽ°åŒ…å«åœ¨é€šç”¨ API ä¸­ï¼Œæˆ–è€…ä½¿ç”¨ä¸ºä½ æ‰§è¡Œæ­¤æ“ä½œçš„ libraryã€‚ä¾‹å¦‚ï¼Œaxios æ˜¯ä¸€ä¸ª HTTP å®¢æˆ·ç«¯ï¼Œå¯ä»¥å‘æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½æš´éœ²ç›¸åŒçš„ APIã€‚ å¯¹äºŽä»…æµè§ˆå™¨å¯ç”¨çš„ APIï¼Œé€šå¸¸æ–¹å¼æ˜¯ï¼Œåœ¨ã€Œçº¯å®¢æˆ·ç«¯(client-only)ã€çš„ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ä¸­æƒ°æ€§è®¿é—®(lazily access)å®ƒä»¬ã€‚ è‡ªå®šä¹‰æŒ‡ä»¤å¤§å¤šæ•°è‡ªå®šä¹‰æŒ‡ä»¤ç›´æŽ¥æ“ä½œDOMï¼Œå› æ­¤ä¼šåœ¨æœåŠ¡å™¨ç«¯æ¸²æŸ“(SSR)è¿‡ç¨‹ä¸­å¯¼è‡´é”™è¯¯ã€‚æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š æŽ¨èä½¿ç”¨ç»„ä»¶ä½œä¸ºæŠ½è±¡æœºåˆ¶ï¼Œå¹¶è¿è¡Œåœ¨ã€Œè™šæ‹Ÿ DOM å±‚çº§(Virtual-DOM level)ã€ï¼ˆä¾‹å¦‚ï¼Œä½¿ç”¨æ¸²æŸ“å‡½æ•°(render function)ï¼‰ã€‚ å¦‚æžœä½ æœ‰ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤ï¼Œä½†æ˜¯ä¸æ˜¯å¾ˆå®¹æ˜“æ›¿æ¢ä¸ºç»„ä»¶ï¼Œåˆ™å¯ä»¥åœ¨åˆ›å»ºæœåŠ¡å™¨ renderer æ—¶ï¼Œä½¿ç”¨ directives é€‰é¡¹æ‰€æä¾›â€æœåŠ¡å™¨ç«¯ç‰ˆæœ¬(server-side version)â€ã€‚ Letâ€™s goæ­å»ºè„šæ‰‹æž¶12// åˆ©ç”¨webpack-simpleæ­å»ºä¸€ä¸ªç®€å•çš„è„šæ‰‹æž¶vue init webpack-simple vue-ssr srcç›®å½•å¯èƒ½éœ€è¦åƒä¸‹é¢è¿™æ ·ï¼š 12345678910srcâ”œâ”€â”€ componentsâ”‚ â”œâ”€â”€ Foo.vueâ”‚ â”œâ”€â”€ Bar.vueâ”‚ â””â”€â”€ Baz.vueâ”œâ”€â”€ index.template.html # SSRæ¨¡æ¿â”œâ”€â”€ App.vueâ”œâ”€â”€ app.js # é€šç”¨ entry(universal entry)â”œâ”€â”€ entry-client.js # ä»…è¿è¡ŒäºŽæµè§ˆå™¨â””â”€â”€ entry-server.js # ä»…è¿è¡ŒäºŽæœåŠ¡å™¨ å®¢æˆ·ç«¯ä¸ŽæœåŠ¡ç«¯é€šç”¨å…¥å£ï¼šapp.js123456789101112import Vue from 'vue'import App from './App.vue'// å¯¼å‡ºä¸€ä¸ªå·¥åŽ‚å‡½æ•°ï¼Œç”¨äºŽåˆ›å»ºæ–°çš„// åº”ç”¨ç¨‹åºã€router å’Œ store å®žä¾‹export function createApp () &#123; const app = new Vue(&#123; // æ ¹å®žä¾‹ç®€å•çš„æ¸²æŸ“åº”ç”¨ç¨‹åºç»„ä»¶ã€‚ render: h =&gt; h(App) &#125;) return &#123; app &#125;&#125; å®¢æˆ·ç«¯å…¥å£ï¼šentry-client.js å®¢æˆ·ç«¯ entry åªéœ€åˆ›å»ºåº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”å°†å…¶æŒ‚è½½åˆ° DOM ä¸­ 1234567import &#123; createApp &#125; from './app'const &#123; app &#125; = createApp()// è¿™é‡Œå‡å®š App.vue æ¨¡æ¿ä¸­æ ¹å…ƒç´ å…·æœ‰ `id="app"`app.$mount('#app') æœåŠ¡ç«¯å…¥å£ï¼šentry-server.js æœåŠ¡å™¨ entry ä½¿ç”¨ default export å¯¼å‡ºå‡½æ•°ï¼Œå¹¶åœ¨æ¯æ¬¡æ¸²æŸ“ä¸­é‡å¤è°ƒç”¨æ­¤å‡½æ•°ã€‚æ­¤æ—¶ï¼Œé™¤äº†åˆ›å»ºå’Œè¿”å›žåº”ç”¨ç¨‹åºå®žä¾‹ä¹‹å¤–ï¼Œå®ƒä¸ä¼šåšå¤ªå¤šäº‹æƒ… - ä½†æ˜¯ç¨åŽæˆ‘ä»¬å°†åœ¨æ­¤æ‰§è¡ŒæœåŠ¡å™¨ç«¯è·¯ç”±åŒ¹é…(server-side route matching)å’Œæ•°æ®é¢„å–é€»è¾‘(data pre-fetching logic) 123456import &#123; createApp &#125; from './app'export default context =&gt; &#123; const &#123; app &#125; = createApp() return app&#125; æž„å»ºé…ç½®ï¼ˆwebpackï¼‰å»ºè®®å°†é…ç½®åˆ†ä¸ºä¸‰ä¸ªæ–‡ä»¶ï¼š webpack.base.config.js: åŒ…å«åœ¨ä¸¤ä¸ªçŽ¯å¢ƒå…±äº«çš„é…ç½®ï¼Œä¾‹å¦‚ï¼Œè¾“å‡ºè·¯å¾„(output path)ï¼Œåˆ«å(alias)å’Œ loaderã€‚ webpack.client.config.js webpack.server.config.js webpack.client.config.jså’Œwebpack.server.config.jsï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨ webpack-merge æ¥ç®€å•åœ°æ‰©å±•webpack.base.config.js webpack.base.config.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106var path = require('path')var webpack = require('webpack')module.exports = &#123; output: &#123; path: path.resolve(__dirname, '../dist'), publicPath: '/dist/' &#125;, module: &#123; rules: [ &#123; test: /\.css$/, use: [ 'vue-style-loader', 'css-loader' ], &#125;, &#123; test: /\.scss$/, use: [ 'vue-style-loader', 'css-loader', 'sass-loader' ], &#125;, &#123; test: /\.sass$/, use: [ 'vue-style-loader', 'css-loader', 'sass-loader?indentedSyntax' ], &#125;, &#123; test: /\.vue$/, loader: 'vue-loader', options: &#123; loaders: &#123; // Since sass-loader (weirdly) has SCSS as its default parse mode, we map // the "scss" and "sass" values for the lang attribute to the right configs here. // other preprocessors should work out of the box, no loader config like this necessary. 'scss': [ 'vue-style-loader', 'css-loader', 'sass-loader' ], 'sass': [ 'vue-style-loader', 'css-loader', 'sass-loader?indentedSyntax' ] &#125; // other vue-loader options go here &#125; &#125;, &#123; test: /\.js$/, loader: 'babel-loader', exclude: /node_modules/ &#125;, &#123; test: /\.(png|jpg|gif|svg)$/, loader: 'file-loader', options: &#123; name: '[name].[ext]?[hash]' &#125; &#125; ] &#125;, resolve: &#123; alias: &#123; 'vue$': 'vue/dist/vue.esm.js' &#125;, extensions: ['*', '.js', '.vue', '.json'] &#125;, devServer: &#123; historyApiFallback: true, noInfo: true, overlay: true &#125;, performance: &#123; hints: false &#125;, devtool: '#eval-source-map'&#125;if (process.env.NODE_ENV === 'production') &#123; module.exports.devtool = '#source-map' // http://vue-loader.vuejs.org/en/workflow/production.html module.exports.plugins = (module.exports.plugins || []).concat([ new webpack.DefinePlugin(&#123; 'process.env': &#123; NODE_ENV: '"production"' &#125; &#125;), new webpack.optimize.UglifyJsPlugin(&#123; sourceMap: true, compress: &#123; warnings: false &#125; &#125;), new webpack.LoaderOptionsPlugin(&#123; minimize: true &#125;) ])&#125; webpack.client.config.js å¦‚æžœä½ ä½¿ç”¨ CommonsChunkPlugin(webpack4ä½¿ç”¨splitChunkPlugin)ï¼Œè¯·ç¡®ä¿ä»…åœ¨å®¢æˆ·ç«¯é…ç½®(client config)ä¸­ä½¿ç”¨ï¼Œå› ä¸ºæœåŠ¡å™¨åŒ…éœ€è¦å•ç‹¬çš„å…¥å£ chunk1234567891011121314151617181920212223const webpack = require('webpack')const merge = require('webpack-merge')const baseConfig = require('./webpack.base.config.js')const VueSSRClientPlugin = require('vue-server-renderer/client-plugin')module.exports = merge(baseConfig, &#123; entry: './src/entry-client.js', output: &#123; filename: '[name].client.js' &#125;, plugins: [ // é‡è¦ä¿¡æ¯ï¼šè¿™å°† webpack è¿è¡Œæ—¶åˆ†ç¦»åˆ°ä¸€ä¸ªå¼•å¯¼ chunk ä¸­ï¼Œ // ä»¥ä¾¿å¯ä»¥åœ¨ä¹‹åŽæ­£ç¡®æ³¨å…¥å¼‚æ­¥ chunkã€‚ // è¿™ä¹Ÿä¸ºä½ çš„ åº”ç”¨ç¨‹åº/vendor ä»£ç æä¾›äº†æ›´å¥½çš„ç¼“å­˜ã€‚ new webpack.optimize.CommonsChunkPlugin(&#123; name: "manifest", minChunks: Infinity &#125;), // æ­¤æ’ä»¶åœ¨è¾“å‡ºç›®å½•ä¸­ // ç”Ÿæˆ `vue-ssr-client-manifest.json`ã€‚ // new VueSSRClientPlugin() ]&#125;) webpack.client.config.js12345678910111213141516171819202122232425262728293031323334353637383940const merge = require('webpack-merge')const nodeExternals = require('webpack-node-externals')const baseConfig = require('./webpack.base.config.js')const VueSSRServerPlugin = require('vue-server-renderer/server-plugin')module.exports = merge(baseConfig, &#123; // å°† entry æŒ‡å‘åº”ç”¨ç¨‹åºçš„ server entry æ–‡ä»¶ entry: '/path/to/entry-server.js', // è¿™å…è®¸ webpack ä»¥ Node é€‚ç”¨æ–¹å¼(Node-appropriate fashion)å¤„ç†åŠ¨æ€å¯¼å…¥(dynamic import)ï¼Œ // å¹¶ä¸”è¿˜ä¼šåœ¨ç¼–è¯‘ Vue ç»„ä»¶æ—¶ï¼Œ // å‘ŠçŸ¥ `vue-loader` è¾“é€é¢å‘æœåŠ¡å™¨ä»£ç (server-oriented code)ã€‚ target: 'node', // å¯¹ bundle renderer æä¾› source map æ”¯æŒ devtool: 'source-map', // æ­¤å¤„å‘ŠçŸ¥ server bundle ä½¿ç”¨ Node é£Žæ ¼å¯¼å‡ºæ¨¡å—(Node-style exports) output: &#123; libraryTarget: 'commonjs2' &#125;, // https://webpack.js.org/configuration/externals/#function // https://github.com/liady/webpack-node-externals // å¤–ç½®åŒ–åº”ç”¨ç¨‹åºä¾èµ–æ¨¡å—ã€‚å¯ä»¥ä½¿æœåŠ¡å™¨æž„å»ºé€Ÿåº¦æ›´å¿«ï¼Œ // å¹¶ç”Ÿæˆè¾ƒå°çš„ bundle æ–‡ä»¶ã€‚ externals: nodeExternals(&#123; // ä¸è¦å¤–ç½®åŒ– webpack éœ€è¦å¤„ç†çš„ä¾èµ–æ¨¡å—ã€‚ // ä½ å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ›´å¤šçš„æ–‡ä»¶ç±»åž‹ã€‚ä¾‹å¦‚ï¼Œæœªå¤„ç† *.vue åŽŸå§‹æ–‡ä»¶ï¼Œ // ä½ è¿˜åº”è¯¥å°†ä¿®æ”¹ `global`ï¼ˆä¾‹å¦‚ polyfillï¼‰çš„ä¾èµ–æ¨¡å—åˆ—å…¥ç™½åå• whitelist: /\.css$/ &#125;), // è¿™æ˜¯å°†æœåŠ¡å™¨çš„æ•´ä¸ªè¾“å‡º // æž„å»ºä¸ºå•ä¸ª JSON æ–‡ä»¶çš„æ’ä»¶ã€‚ // é»˜è®¤æ–‡ä»¶åä¸º `vue-ssr-server-bundle.json` plugins: [ // new VueSSRServerPlugin() ]&#125;) æ‰“åŒ…1.æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š12//ç”Ÿæˆå®¢æˆ·ç«¯æ‰“åŒ…æ–‡ä»¶webpack --config ./build/webpack.client.config.js ä¼šåœ¨distç›®å½•ä¸‹ç”Ÿæˆï¼š main.client.js manifest.client.js 2.æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š12//ç”ŸæˆæœåŠ¡ç«¯æ‰“åŒ…æ–‡ä»¶webpack --config ./build/webpack.server.config.js ä¼šåœ¨distç›®å½•ä¸‹ç”Ÿæˆï¼š main.server.js ä¿®æ”¹server.js12345678910111213141516171819202122232425262728293031323334353637383940const Vue = require('vue')const express = require('express')const server = express()const renderer = require('vue-server-renderer').createRenderer(&#123; template: require('fs').readFileSync('./src/index.template.html', 'utf-8')&#125;)// const createApp = require('./src/app.js')// é€šè¿‡æœåŠ¡ç«¯æ‰“åŒ…æ–‡ä»¶main.server.jsæ¥åˆ›å»ºappå®žä¾‹const createApp = require('./dist/main.server.js').default// å°†distæ–‡ä»¶å¤¹ä½œä¸ºé™æ€èµ„æºç›®å½•server.use('/dist', express.static('./dist'))server.get('*', (req, res) =&gt; &#123; const context = &#123; title: 'hello', meta: ` &lt;meta charset="utf-8"&gt; `, url: req.url &#125; // const app = new Vue(&#123; // data: &#123; // url: req.url // &#125;, // template: `&lt;div&gt;è®¿é—®çš„ URL æ˜¯ï¼š &#123;&#123; url &#125;&#125;&lt;/div&gt;` // &#125;) // ä¸åº”è¯¥ç›´æŽ¥åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºå®žä¾‹ï¼Œè€Œæ˜¯åº”è¯¥æš´éœ²ä¸€ä¸ªå¯ä»¥é‡å¤æ‰§è¡Œçš„å·¥åŽ‚å‡½æ•°ï¼Œä¸ºæ¯ä¸ªè¯·æ±‚åˆ›å»ºæ–°çš„åº”ç”¨ç¨‹åºå®žä¾‹ const app = createApp(context) renderer.renderToString(app, context).then(html =&gt; &#123; res.end(html) &#125;).catch(e =&gt; &#123; res.status(500).end('Internal Server Error') &#125;)&#125;)server.listen(8081) index.template.htmlä¸­å¼•å…¥clientç«¯æ‰“åŒ…æ–‡ä»¶123456789101112131415&lt;!DOCTYPE html&gt;&lt;html lang="zh"&gt;&lt;head&gt; &lt;title&gt;&#123;&#123;title&#125;&#125;&lt;/title&gt; &#123;&#123;&#123;meta&#125;&#125;&#125;&lt;/head&gt;&lt;body&gt; &lt;!--vue-ssr-outlet--&gt; &lt;script src="/dist/manifest.client.js"&gt;&lt;/script&gt; &lt;script src="/dist/main.client.js"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š12node server# supervisor server å°±å¯ä»¥æˆåŠŸè®¿é—®åˆ°vueæ¬¢è¿Žé¡µé¢äº† è·¯ç”±å’Œä»£ç åˆ†å‰²åœ¨srcç›®å½•ä¸‹åˆ›å»ºrouter.js1234567891011121314151617import Vue from 'vue'import Router from 'vue-router'Vue.use(Router)export function createRouter () &#123; return new Router(&#123; mode: 'history', routes: [ &#123; path: '/hello/:id', // åŠ¨æ€å¯¼å…¥ç»„ä»¶ï¼Œéœ€è¦å®‰è£…babel-preset-stage-2 component: () =&gt; import('./components/hello') &#125; ] &#125;)&#125; ä¿®æ”¹é€šç”¨å…¥å£app.js1234567891011121314151617import Vue from 'vue'import App from './App.vue'import &#123;createRouter&#125; from './router'// å¯¼å‡ºä¸€ä¸ªå·¥åŽ‚å‡½æ•°ï¼Œç”¨äºŽåˆ›å»ºæ–°çš„// åº”ç”¨ç¨‹åºã€router å’Œ store å®žä¾‹export function createApp () &#123; const app = new Vue(&#123; // æ ¹å®žä¾‹ç®€å•çš„æ¸²æŸ“åº”ç”¨ç¨‹åºç»„ä»¶ã€‚ render: h =&gt; h(App), router &#125;) const router = createRouter() return &#123; app, router &#125;&#125; ä¿®æ”¹entry-client.js12345//æŒ‚è½½ app ä¹‹å‰è°ƒç”¨ router.onReady//å› ä¸ºè·¯ç”±å™¨å¿…é¡»è¦æå‰è§£æžè·¯ç”±é…ç½®ä¸­çš„å¼‚æ­¥ç»„ä»¶ï¼Œæ‰èƒ½æ­£ç¡®åœ°è°ƒç”¨ç»„ä»¶ä¸­å¯èƒ½å­˜åœ¨çš„è·¯ç”±é’©å­router.onReady(() =&gt; &#123; app.$mount('#app')&#125;) åœ¨ entry-server.js ä¸­å®žçŽ°æœåŠ¡å™¨ç«¯è·¯ç”±é€»è¾‘123456789101112131415161718192021222324import &#123; createApp &#125; from './app'export default context =&gt; &#123; // å› ä¸ºæœ‰å¯èƒ½ä¼šæ˜¯å¼‚æ­¥è·¯ç”±é’©å­å‡½æ•°æˆ–ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†è¿”å›žä¸€ä¸ª Promiseï¼Œ // ä»¥ä¾¿æœåŠ¡å™¨èƒ½å¤Ÿç­‰å¾…æ‰€æœ‰çš„å†…å®¹åœ¨æ¸²æŸ“å‰å°±å·²ç»å‡†å¤‡å°±ç»ªã€‚ return new Promise((resolve, reject) =&gt; &#123; const &#123; app, router &#125; = createApp() // è®¾ç½®æœåŠ¡å™¨ç«¯ router çš„ä½ç½® router.push(context.url) // ç­‰åˆ° router å°†å¯èƒ½çš„å¼‚æ­¥ç»„ä»¶å’Œé’©å­å‡½æ•°è§£æžå®Œ router.onReady(() =&gt; &#123; const matchedComponents = router.getMatchedComponents() // åŒ¹é…ä¸åˆ°çš„è·¯ç”±ï¼Œæ‰§è¡Œ reject å‡½æ•°ï¼Œå¹¶è¿”å›ž 404 if (!matchedComponents.length) &#123; return reject(&#123; code: 404 &#125;) &#125; // Promise åº”è¯¥ resolve åº”ç”¨ç¨‹åºå®žä¾‹ï¼Œä»¥ä¾¿å®ƒå¯ä»¥æ¸²æŸ“ resolve(app) &#125;, reject) &#125;)&#125; ä¿®æ”¹server.js12345678910111213141516171819202122232425262728293031server.get('*', (req, res) =&gt; &#123; const context = &#123; title: 'hello', meta: ` &lt;meta charset="utf-8"&gt; `, url: req.url &#125; // const app = createApp(context) // renderer.renderToString(app, context).then(html =&gt; &#123; // res.end(html) // &#125;).catch(e =&gt; &#123; // res.status(500).end('Internal Server Error') // &#125;) createApp(context).then(app =&gt; &#123; renderer.renderToString(app, (err, html) =&gt; &#123; if (err) &#123; if (err.code === 404) &#123; res.status(404).end('Page not found') &#125; else &#123; res.status(500).end('Internal Server Error') &#125; &#125; else &#123; res.end(html) &#125; &#125;) &#125;)&#125;) å†æ¬¡æ‰“åŒ…1.æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š12//ç”Ÿæˆå®¢æˆ·ç«¯æ‰“åŒ…æ–‡ä»¶webpack --config ./build/webpack.client.config.js ä¼šåœ¨distç›®å½•ä¸‹ç”Ÿæˆï¼š 0.client.js main.client.js manifest.client.js 2.æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š12//ç”ŸæˆæœåŠ¡ç«¯æ‰“åŒ…æ–‡ä»¶webpack --config ./build/webpack.server.config.js ä¼šåœ¨distç›®å½•ä¸‹ç”Ÿæˆï¼š 0.server.js main.server.js ä¸Šé¢çš„0.client.jså’Œ0.server.jså°±æ˜¯åŠ¨æ€åŠ è½½çš„ç»„ä»¶hello.vueæ‰€æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æŒ‰éœ€å¼•ç”¨ æ€»ç»“ä¸Šé¢çš„ä»£ç åªæ˜¯å®Œæˆäº†å¾ˆå°çš„ä¸€éƒ¨åˆ†ï¼ŒçœŸæ­£æƒ³è¦æŠ•å…¥åˆ°ç”Ÿäº§å·¥ä½œé‡æ¯”è¿™ä¸ªå¤§å¤ªå¤šï¼Œå› æ­¤å¦‚æžœä¸æ˜¯å¿…è¦ï¼ŒæŽ¨èä½¿ç”¨çŽ°æœ‰çš„æœåŠ¡ç«¯æ¸²æŸ“æ¡†æž¶ï¼šnext.js/nuxt.jsdç­‰ã€‚]]></content>
      <categories>
        <category>Vue</category>
      </categories>
      <tags>
        <tag>ssr</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åº]]></title>
    <url>%2F2018%2F04%2F22%2Fjs-sort%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å‰è¨€æœ¬æ–‡æ•´ç†äº†å‡ ç§jsæŽ’åºæ–¹æ³• sort() å¿«é€ŸæŽ’åº å†’æ³¡æŽ’åº äºŒã€sort()åˆ©ç”¨sort function å¯ä»¥å®Œæˆä¸€äº›ç®€å•çš„æ•°ç»„æŽ’åº å¯¹æ•°ç»„æŽ’åº1234567var arr = [3,55,7];arr.sort();arr.sort(function(a,b) &#123; return a - b;&#125;);console.log(arr);//è¾“å‡ºç»“æžœ[3,7,55] æ ¹æ®æ•°ç»„å¯¹è±¡çš„æŸä¸€å±žæ€§æŽ’åº123456789101112131415var arr= [ &#123; 'rank': 2&#125;, &#123; 'rank': 1&#125;, &#123; 'rank': 5&#125;, &#123; 'rank': 6&#125;];arr.sort(function(a, b) &#123; return a.rank - b.rank;&#125;);console.log(arr);//è¾“å‡ºç»“æžœ&#123; 'rank': 1&#125;,&#123; 'rank': 2&#125;,&#123; 'rank': 5&#125;,&#123; 'rank': 6&#125; ä¸‰ã€å¿«é€ŸæŽ’åº1234567891011121314151617function quickSort(arr) &#123; let len = arr.length if(len &lt;= 1) &#123; return arr &#125; let i = Math.floor(len / 2) let num = arr.splice(i, 1) let left = [], right = [] for(let i = 0; i &lt; arr.length; i++) &#123; if(arr[i] &lt; num) &#123; left.push(arr[i]) &#125;else &#123; right.push(arr[i]) &#125; &#125; return quickSort(left).concat(num, quickSort(right))&#125;console.log(quickSort([1,11,2,2,6]))//[1,2,2,6,11] å¯ä»¥çœ‹å‡ºï¼Œè™½ç„¶æŽ’åºæ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æ— æ³•å–å‡ºé‡å¤å…ƒç´ 2ï¼Œè¦å®žçŽ°åŽ»é‡çš„è¯ç”¨ES6çš„Setæ•°æ®ç»“æž„å¯ä»¥æ–¹ä¾¿çš„åšåˆ°ï¼š 1234const arr = [1,11,2,2,6]const newArr = [...new Set(arr)]//or//const newArr = Array.from(new Set(arr)) å››ã€å†’æ³¡æŽ’åº åˆ©ç”¨åŒå±‚å¾ªçŽ¯æ¥é€ä¸ªæ¯”è¾ƒæ•°ç»„çš„æ¯ä¸ªå€¼ 12345678910111213141516171819function bubbleSort(arr) &#123; for(let i = 0; i &lt; arr.length; i++) &#123; for(let j = i + 1; j &lt; arr.length; j++) &#123; //let n = 0 //if(arr[i] &gt; arr[j]) &#123; //n = arr[i] //arr[i] = arr[j] //arr[j] = n //&#125; //æœ‰äº†ES6çš„ç»“æž„èµ‹å€¼ï¼Œäº¤æ¢æ•°å€¼åªè¦ä¸€å¥è¯ if(arr[i] &gt; arr[j]) &#123; [arr[i], arr[j]] = [arr[j], arr[i]] &#125; &#125; &#125; return arr&#125;console.log(bubbleSort([1,11,2,7]))//[1,2,7,11]]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>æŽ’åº</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åšä¸€ä¸ªè‡ªå®šä¹‰æ»šåŠ¨æ¡]]></title>
    <url>%2F2018%2F03%2F17%2Fv-custom%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å‰è¨€æœ€è¿‘åœ¨åšçš„é¡¹ç›®éœ€è¦ç”¨åˆ°è‡ªå®šä¹‰æ»šåŠ¨æ¡ï¼Œæ—¢ç„¶æ—¶é—´å……è£•ï¼Œå°±è‡ªå·±åšäº†ä¸ªã€‚æˆ‘å°†å…¶åšæˆäº†Vueçš„å…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤ï¼Œåªè¦æ»¡è¶³å¯¹åº”çš„HTMLç»“æž„å°±å¯ä»¥åœ¨ä»»æ„åœ°æ–¹è°ƒç”¨ï¼Œç›¸å¯¹æ¥è¯´ä¹Ÿæ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚ äºŒã€åŽŸç†ï¼ˆä»¥ä¸‹é»˜è®¤å†…å®¹é«˜åº¦è¶…å‡ºå®¹å™¨é«˜åº¦ã€‚ï¼‰ 2.1 ç»“æž„éœ€è¦æ»¡è¶³ä»¥ä¸‹HTMLç»“æž„ï¼š 12345678910&lt;div class="wrapper"&gt; &lt;div class="content-wrapper" v-mousewheel&gt; &lt;div class="content"&gt; &lt;!--æ»šåŠ¨å†…å®¹--&gt; &lt;/div&gt; &lt;/div&gt; &lt;div class="scroll-bar"&gt; &lt;div class="scroll-block" v-scrollY&gt;&lt;/div&gt; &lt;/div&gt;&lt;/div&gt; 2.2åŽŸç† é€šè¿‡æ‹–æ‹½äº‹ä»¶å’Œæ»šè½®äº‹ä»¶åŠ¨æ€æ”¹å˜å†…å®¹åŒºåŸŸçš„topå€¼ å› æ­¤éœ€è¦: è®¾ç½®å®¹å™¨content-wrapperå±žæ€§ï¼šoverflow: hidden; è®¾ç½®å†…å®¹contentå±žæ€§ï¼šposition: absolute; è¿™æ ·ï¼ŒåŸºç¡€å·¥ä½œå°±å·²ç»okäº†ï¼Œå¼€å§‹å†™äº¤äº’äº‹ä»¶ã€‚ ä¸‰ã€ä»£ç 3.1 æ‹–æ‹½äº‹ä»¶å¤§çš„æ–¹å‘ä¸Šæ²¡ä»€ä¹ˆé—®é¢˜ï¼Œä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‹–åŠ¨æ»‘å—æ—¶å¦‚æžœä¸åšå¤„ç†ï¼Œä¼šå‡ºçŽ°æŠ–åŠ¨çŽ°è±¡ï¼Œè¿™æ˜¯å› ä¸ºæ‹–åŠ¨æ—¶onmousemoveäº‹ä»¶é¢‘ç¹è§¦å‘å¯¼è‡´ï¼Œå› æ­¤åŠ å…¥é˜²æŠ–åŠŸèƒ½å³å¯ï¼š åŠ ä¸ªå®šæ—¶å™¨ï¼Œæ¯æ¬¡æ‰§è¡Œonmousemoveæ—¶æ¸…é™¤å®šæ—¶å™¨é˜²æ­¢å¤šæ¬¡è§¦å‘ï¼Œå®šæ—¶å™¨äº‹ä»¶è®¾ç½®ä¸º20msæ˜¯å› ä¸ºæµè§ˆå™¨çš„æœ€å¤§åˆ·æ–°é¢‘çŽ‡ä¸º16.7ms/æ¬¡ã€‚ è¿™æ ·ï¼Œåœ¨æ»‘å—scroll-blockä¸ŠåŠ ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤v-scrollY,å°±å¯ä»¥å®žçŽ°æ‹–æ‹½æ•ˆæžœå•¦~ 12345678910111213141516171819202122232425262728Vue.directive('scrollY', &#123; bind (el, binding) &#123; let $el = el $el.onmousedown = function(e) &#123; let disY = e.clientY - $el.offsetTop let $content = $el.parentNode.parentNode.firstChild let contentH = $content.clientHeight document.onmousemove = function(e) &#123; clearTimeout(timer) let timer = setTimeout(() =&gt; &#123; // æ»šåŠ¨æ»‘å—æ»šåŠ¨è·ç¦» let top = Math.min(Math.max(e.clientY - disY, 0), 306) // å†…å®¹åŒºåŸŸæ»šåŠ¨è·ç¦» let topC = top * (contentH - 600) / 306 $el.style.top = top + 'px' $content.style.top = -topC +'px' &#125;, 20) $el.style.backgroundColor = '#acaaaa' &#125; document.onmouseup = function(e) &#123; document.onmousemove = null document.onmouseup =null $el.style.backgroundColor = '#e9e9e9' &#125; &#125; &#125;&#125;) 3.2 æ»šè½®äº‹ä»¶æ»šè½®äº‹ä»¶ç›¸å¯¹æ¥è¯´æ¯”è¾ƒéº»çƒ¦ï¼Œè¿™æ˜¯å› ä¸ºï¼šfirefoxå’Œå…¶ä»–æµè§ˆå™¨çš„æ»šè½®äº‹ä»¶ä¸ä¸€æ ·ã€‚ åœ¨firefoxä¸­æ˜¯DOMMouseScroll ,å…¶ä»–æµè§ˆå™¨ä¸­åˆ™æ˜¯mousewheel åœ¨firefoxä¸­é€šè¿‡e.detailçš„æ­£è´Ÿå€¼æ¥åˆ¤æ–­ä¸Šä¸‹æ»šåŠ¨ï¼Œå…¶ä»–æµè§ˆå™¨ä¸­åˆ™æ˜¯é€šè¿‡e.wheelDetlaæ¥åˆ¤æ–­ä¸Šä¸‹æ»šåŠ¨ - firefox å…¶å®ƒæµè§ˆå™¨ ä¸Šæ»š e.detail &lt; 0 e.wheelDetla &gt; 0 ä¸‹æ»š e.detail &gt; 0 e.wheelDetla &lt; 0 å…¶å®ƒæœ‰å‡ ç‚¹å€¼å¾—è¯´ä¸€ä¸‹ï¼š æ»šåŠ¨æ—¶éœ€è¦é˜»å€¼é»˜è®¤äº‹ä»¶ï¼Œé˜²æ­¢åœ¨å­æ»šåŠ¨åŒºæ»šåŠ¨æ—¶ä½¿çˆ¶æ»šåŠ¨åŒºè·Ÿç€æ»šåŠ¨ï¼› æ»šåŠ¨åŒºå†…å®¹è®¾ç½®ï¼šuser-select: none;å› ä¸ºæˆ‘å‘çŽ°åœ¨æ‹–æ‹½çš„æ—¶å€™é¼ æ ‡ç¦»å¼€æ»šåŠ¨æ»‘å—ä¼šé€‰ä¸­æ»šåŠ¨å†…å®¹åŒºæ–‡å­—ã€‚ æ³¨æ„ä¸Šé¢å‡ ç‚¹åº”è¯¥å°±æ²¡é—®é¢˜äº†ï¼Œç„¶åŽåœ¨å®¹å™¨content-wrapperä¸Šæ·»åŠ v-mousewheelå°±å¯ä»¥æ»šåŠ¨å•¦ï½ž123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354Vue.directive('mousewheel', &#123; bind( el, biding ) &#123; let num = 0 let $el = el function addEvent(obj, type, fn, capture) &#123; if (obj.addEventListener) &#123; if( !capture ) &#123;capture = false&#125; obj.addEventListener(type, fn, capture) &#125; else if (obj.attachEvent) &#123; obj.attachEvent("on" + type, fn) &#125; &#125; function scrollDown() &#123; let $block = $el.parentNode.children[1].children[0] let dis = Math.min(20 * (num--), $el.clientHeight - 600) $el.style.top = Math.min(0, -dis) + 'px' let topB = Math.max(0, dis) * 306 / ($el.clientHeight - 600) $block.style.top = topB + 'px' &#125; function scrollUp() &#123; let $block = $el.parentNode.children[1].children[0] let dis = Math.min(20 * (num++), $el.clientHeight - 600) $el.style.top = Math.min(0, -dis) + 'px' let topB = Math.min(0, -dis) * 306 / ($el.clientHeight - 600) $block.style.top = -topB + 'px' &#125; function customScroll(e) &#123; if( e.wheelDelta ) &#123; if (e.wheelDelta &gt; 0) &#123; //ä¸‹æ»š scrollDown() &#125; else &#123; //ä¸Šæ»š scrollUp() &#125; &#125;else if ( e.detail ) &#123; //å…¼å®¹ç«ç‹ if (e.detail &lt; 0) &#123; //ä¸‹æ»š scrollDown() &#125; else &#123; //ä¸Šæ»š scrollUp() &#125; &#125; &#125; addEvent($el, 'mousewheel', (e) =&gt; &#123; let ev = e || window.event ev.preventDefault ? ev.preventDefault() : ev.returnvalue = false customScroll(e) &#125;) // å…¼å®¹firefox addEvent($el, 'DOMMouseScroll', (e) =&gt; &#123; let ev = e || window.event ev.preventDefault ? ev.preventDefault() : ev.returnvalue = false customScroll(e) &#125;) &#125;&#125;) å››ã€å°ç»“è€ƒè™‘åˆ°æ»šè½®äº‹ä»¶åœ¨ä¸åŒæµè§ˆå™¨ä¸­çš„è¡¨çŽ°ä¸åŒï¼Œå¤„ç†å¥½å…¼å®¹æ€§çš„é—®é¢˜æ˜¯è‡³å…³é‡è¦çš„ã€‚]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>è‡ªå®šä¹‰æ»šåŠ¨æ¡</tag>
        <tag>è‡ªå®šä¹‰æŒ‡ä»¤</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Promiseä¹‹ä¸å®Œå…¨è§£è¯»]]></title>
    <url>%2F2018%2F03%2F07%2Fpromise%2F</url>
    <content type="text"><![CDATA[ä¸€ã€å‰è¨€1.ä»€ä¹ˆæ˜¯promiseï¼Ÿ 2.promiseæœ‰ä»€ä¹ˆç”¨ï¼Ÿ 3.ä»€ä¹ˆæ—¶å€™ç”¨promiseï¼Ÿ MDNçš„å®˜æ–¹è§£é‡Šæ˜¯ï¼š Promise å¯¹è±¡ç”¨äºŽè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„æœ€ç»ˆçŠ¶æ€ï¼ˆå®Œæˆæˆ–å¤±è´¥ï¼‰ï¼Œä»¥åŠå…¶è¿”å›žçš„å€¼ æ–°å­¦ä¸€ä¸ªæ–°çš„æ¦‚å¿µçš„æ—¶å€™å…‰ä»Žå­—é¢ä¸Šå…¶å®žæ— æ³•å¾ˆå¥½çš„ç†è§£å…¶å«ä¹‰ï¼Œæ€»ä¹‹è®©æˆ‘ä»¬å¸¦ç€è¿™ä¸‰ä¸ªé—®é¢˜ï¼Œä¸€æ­¥æ­¥æŠ½ä¸å‰¥èŒ§ï¼Œé“å‡ºå®ƒçš„çœŸé¢ç›® æ‰€è°“promiseï¼Œç¿»è¯‘æˆä¸­æ–‡å°±æ˜¯ï¼šè®¸è¯ºã€æ‰¿è¯ºçš„æ„æ€ï¼Œè¡¨ç¤ºä¸€ç§å°†æ¥çš„çŠ¶æ€ã€‚ å®ƒåœ¨å¼‚æ­¥è®¡ç®—ä¸­æ‰®æ¼”è€…é‡è¦çš„è§’è‰²ï¼šå®ƒå¯ä»¥å°†å¼‚æ­¥æ“ä½œé˜Ÿåˆ—åŒ–ï¼ŒæŒ‰ç…§æˆ‘ä»¬æƒ³è¦çš„é¡ºåºè¿›è¡Œæ‰§è¡Œï¼Œå¹¶ä¸”è¿”å›žç¬¦åˆé¢„æœŸçš„ç»“æžœ æˆ‘ä»¬å¯ä»¥åœ¨å¯¹è±¡ä¹‹é—´ä¼ é€’å’Œæ“ä½œpromiseï¼Œå¸®åŠ©æˆ‘ä»¬å¤„ç†é˜Ÿåˆ— äºŒã€åŽ†å²å¦‚æžœäº†è§£JavaScriptçš„åŽ†å²ï¼Œå¯èƒ½ä¼šå¸®åŠ©æˆ‘ä»¬æ›´å¥½çš„è®¤è¯†promiseã€‚ ä¸ºæ£€æŸ¥è¡¨å•è€Œç”Ÿçš„JavaScript åœ¨JavaScriptå‡ºçŽ°ä»¥å‰ï¼Œç”¨æˆ·åœ¨å¡«å†™è¡¨å•æ—¶ç¨æœ‰ä¸æ…Žå°±å¾—é‡æ–°å¡«å†™ä¸€éï¼Œæ¯«æ— ç”¨æˆ·ä½“éªŒã€‚è¿™æ—¶å°±å‡ºçŽ°äº†JavaScriptï¼Œä»–å¤©ç”Ÿå°±æ˜¯ç”¨æ¥æ£€æŸ¥è¡¨å•çš„ã€‚é‚£ä¹ˆä½œä¸ºä¸€é—¨æµè§ˆå™¨ç«¯çš„è¯­è¨€ï¼Œå°±æ³¨å®šäº†å®ƒå¼‚æ­¥çš„å‘½è¿ï¼šå®ƒçš„æ‰§è¡Œä¸èƒ½ä½¿é¡µé¢å†»ç»“ã€‚ å…¶å®žåœ¨JavaScripté‡Œé¢å¼‚æ­¥çš„é—®é¢˜è¿˜ä¸æ˜¯ç‰¹åˆ«ä¸¥é‡ï¼Œå› ä¸ºJavaScripté‡Œçš„å¼‚æ­¥ä¸»è¦ä»¥DOMæ“ä½œä¸ºä¸»ï¼Œä½†æ˜¯è‡ªä»Žå‡ºçŽ°äº†Nodejsä»¥åŽï¼Œå®ƒå¯¹å¼‚æ­¥çš„ä¾èµ–è¿›ä¸€æ­¥åŠ å‰§ã€‚ ä¸‰ã€promiseçš„åŸºæœ¬æ¦‚å¿µä½¿ç”¨promiseçš„åŸºæœ¬æ–¹æ³•ï¼š12345678910111213new Promise( (resolve, reject) =&gt; &#123; resolve() //or reject()&#125; ).then(//å¯ä»¥è¿”å›žä¸€ä¸ªæ–°çš„promiseå¯¹è±¡//å¯ä»¥è¿”å›žä¸€ä¸ªåŒæ­¥çš„å€¼//å¯ä»¥æŠ›å‡ºä¸€ä¸ªåŒæ­¥çš„å¼‚å¸¸).catch(//æ•èŽ·é”™è¯¯) promiseæœ‰ä¸‰ç§çŠ¶æ€ï¼š pendingï¼šè¿›è¡Œä¸­ fulfilledï¼šæˆåŠŸ rejectedï¼šå¤±è´¥ è€Œä¸”ä¸€æ—¦å…¶çŠ¶æ€å˜ä¸ºfulfillæˆ–rejectï¼Œå°±ä¸å¯ç»§ç»­æ”¹å˜çŠ¶æ€ promiseé€šè¿‡å¼•å…¥ä»…ä»…ä¸€ä¸ªå›žè°ƒå‡½æ•°æ¥é¿å…æ‰€è°“çš„å›žè°ƒåœ°ç‹±ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨.then()é‡Œé¢ä¸åº”è¯¥å‡ºçŽ°æ–°çš„å›žè°ƒã€‚æ­£ç¡®çš„åšæ³•æ˜¯ï¼šè¿”å›žä¸€ä¸ªæ–°çš„promiseå¯¹è±¡æ¥å®žçŽ°.then()çš„é“¾å¼è°ƒç”¨ã€‚ å››ã€promiseé™·é˜±ï¼ˆpromiseç©¿é€ï¼‰çº¸ä¸Šå¾—æ¥ç»ˆè§‰æµ…ï¼Œç›´æŽ¥ä¸Šä»£ç å§ï¼š 1234567891011121314151617181920212223//åœ¨promiseé‡Œé¢ä¸è¿”å›žä»»ä½•å€¼æˆ–è€…è¿”å›žfalseï¼Œä¼šæœ‰ä»€ä¹ˆç»“æžœï¼Ÿconsole.log('1');new Promise(resolve =&gt; &#123; setTimeout( () =&gt; &#123; resolve('2'); &#125;, 2000);&#125;) .then( value =&gt; &#123; console.log(value); console.log('3'); (function () &#123; return new Promise(resolve =&gt; &#123; setTimeout(() =&gt; &#123; console.log('4'); resolve('5'); &#125;, 2000); &#125;); &#125;()); return false; &#125;) .then( value =&gt; &#123; console.log(value + '6'); &#125;); æ‰§è¡Œé¡ºåºï¼š1-2-3-false6-4 è§£é‡Šï¼šåœ¨promiseé‡Œé¢ä¸è¿”å›žä»»ä½•å€¼æˆ–è€…è¿”å›žfalseï¼Œä»–ä¼šç«‹åˆ»å¾€ä¸‹æ‰§è¡Œã€‚åŒç†ï¼Œå¦‚æžœåŽ»æŽ‰return false,ç»“æžœå°±æ˜¯ 1-2-3-undefined6-4 ï¼ˆæ³¨æ„ï¼šé‚£ä¸ªç«‹å³æ‰§è¡Œå‡½æ•°ç”±äºŽä¸å†.then()çš„ç›´æŽ¥å›žè°ƒé‡Œé¢ï¼Œå› æ­¤å®ƒä¸Ž.then()çš„å›žè°ƒä¸å¤„äºŽåŒä¸€æ‰§è¡Œæ ˆï¼‰ å†™å‡ºç®€æ´çš„promise 1234new Promise( (resolve, reject) =&gt; &#123; resolve(something)&#125;).then(/*```*/) å…¶å®žå†™æˆä¸‹é¢è¿™ç§æ–¹å¼æ›´åŠ å¥½çœ‹ 1Promise.resolve(something).then(/*```*/) é‚£ä¹ˆï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š 12345Promise.resolve('foo').then(Promise.resolve('bar')).then((res) =&gt; &#123; consoe.log(res) // foo&#125;) ç»“æžœå±…ç„¶ä¸æ˜¯â€˜barâ€™è€Œæ˜¯â€˜fooâ€™ï¼Œå®žé™…ä¸Šè¿™å’Œå‰é¢çš„ä¾‹å­å¾ˆç›¸ä¼¼ï¼Œå¦‚æžœç»™.then()ä¼ é€’çš„ä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå›žç›´æŽ¥è§£æžä¸º.then(null)ï¼Œå¯¼è‡´ç«‹å³æ‰§è¡Œä¸‹ä¸€ä¸ª.then(),å‘ç”Ÿæ‰€è°“çš„promiseç©¿é€ å¦‚æžœæƒ³è¦å¾—åˆ°â€˜barâ€™,å¯ä»¥è¿™ä¹ˆå†™ï¼š 1234567Promise.resolve('foo').then( () =&gt; &#123; return Promise.resolve('bar')&#125;).then( (res) =&gt; &#123; consoe.log(res) // bar&#125;) æœ€åŽï¼ŒæŽ¨èè¿™ç¯‡æ–‡ç« ï¼šwe have a problem with promises]]></content>
      <categories>
        <category>Javascript</category>
      </categories>
      <tags>
        <tag>ES6</tag>
        <tag>promise</tag>
      </tags>
  </entry>
</search>
